# -*- coding: utf-8
#+OPTIONS: ^:{}
#+TITLE: SUK å˜… EMACS é…ç½®
#+STARTUP: showeverything
#+PROPERTY: header-args:emacs-lisp+   :tangle yes :results silent :exports code :eval never-export
#+FILETAGS: :emacs:
#+LANGUAGE: zh-CN
#+DATE: {{{time(%Y å¹´%0m æœˆ%d æ—¥)}}}
#+AUTHOR: Suk
#+EMAIL:  bruceasu@gmail.com

* å‰è¨€
:PROPERTIES:
:CUSTOM_ID: babel-init
:END:
<<babel-init>>


å‘¢ä¸ªä¿‚æˆ‘ä¸ªäººå˜…é…ç½®ã€‚å…¶å®å¥½é•¿ï¼Œä½†éƒ¨åˆ†åŸå› ç³»æˆ‘æœ‰æ—¶ä¼šå°†åšå®¢æ–‡ç« ç•™è¿”å–ºåº¦åš
æ³¨é‡Šï¼Œä»²æœ‰å› ä¸ºæˆ‘æœ‰å¥½å¤šç»†èŠ‚å˜…è‡ªå®šä¹‰ï¼Œå¯èƒ½æˆ‘è‡ªå·±éƒ½å””è®°å¾—æ™’ã€‚ å¦‚æœä½ å•±å•±
æ¥è§¦ Emacs Lispï¼Œä½ å¯èƒ½å””æƒ³ç›´æ¥å¤åˆ¶ç²˜è´´å’å¤šä»£ç å—ã€‚ç›¸åï¼Œä½ å¯ä»¥å¤åˆ¶å•²
å°éƒ¨åˆ†ï¼ˆè®°ä½æ¯æ¬¡å¤åˆ¶æ—¶è¦ç¡®ä¿æ‹¬å·æˆå¯¹ï¼‰æ”¾å…¥ä½ å˜… ~*scratch*~ buffer æˆ–è€…å…¶
ä»– ~emacs-lisp-mode~ å˜… buffer å…¥é¢ã€‚ç”¨ ~M-x eval-buffer~ æ¥æ‰§è¡Œå•²ä»£ç ï¼Œç‡
ä¸‹ Emacs å˜…è¡¨ç°ä½ é’Ÿå””é’Ÿæ„ã€‚

æˆ‘å®‰è£…å’—å¥½å¤šè½¯ä»¶åŒ…ã€‚å½“ä½ è§åˆ° ~use-package~ åŒæŸä¸ªåŒ…åï¼Œä½ å¯ä»¥ç”¨ ~M-x
package-install~ æ¥å®‰è£…å—°ä¸ªåŒ…ã€‚

å¦‚æœä½ å–ºç‡ Org æ–‡ä»¶ã€‚ä½ å¯ä»¥å°†æºä»£ç å—ï¼ˆå³ç³» ~begin_src~ å…¥é¢å˜…å†…å®¹ï¼‰æ‰“å¼€
å–ºç‹¬ç«‹å˜… bufferã€‚åªéœ€è¦å°†å…‰æ ‡ç§»å…¥ä»£ç å—ï¼Œç„¶åæŒ‰ ~C-c '~
(~org-edit-special~)ã€‚å’æ ·ä¼šå¼€ä¸€ä¸ªæ–°å˜… buffer ç”¨ =emacs-lisp-mode= ï¼Œä½ å¯
ä»¥ç”¨ =M-x eval-buffer= æ¥åŠ è½½ä¿®æ”¹ã€‚æƒ³æ·±å…¥äº†è§£å‡½æ•°ç‚¹æ ·è¿ä½œï¼Œå¯ä»¥ç”¨ =M-x
edebug-defun= æ¥è°ƒè¯•ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨ä½¢ã€‚ä½ å¯ä»¥å–º [[http://www.gnu.org/software/emacs/manual/html_node/elisp/Edebug.html][Emacs Lisp]] æ‰‹å†Œäº†è§£æ›´å¤šã€‚
<<starting-up>>

#+begin_src emacs-lisp :tangle early-init.el :eval never-export
  ;;; early-init.el --- Early Init File -*- lexical-binding: t; no-byte-compile: t -*-
  ;; NOTE: early-init.el is now generated from readme.org.  Please edit that file instead

  ;; å°†åƒåœ¾æ”¶é›†æ¨è¿Ÿåˆ°å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ›´åé¢ã€‚
  (setq gc-cons-threshold most-positive-fixnum gc-cons-percentage 0.8)
  (setq inhibit-startup-message t)

  ;; å–º Emacs 27 åŠä¹‹åç‰ˆæœ¬ï¼Œè½¯ä»¶åŒ…åˆå§‹åŒ–ä¼šå–º `user-init-file` åŠ è½½ä¹‹
  ;; å‰è¿›è¡Œï¼Œä½†ç³»ä¼šå–º `early-init-file` ä¹‹åè¿›è¡Œã€‚æˆ‘å“‹å¿…é¡»é˜»æ­¢ Emacs
  ;; æå‰åšå‘¢ä¸ªæ“ä½œï¼
  (setq package-enable-at-startup nil)
  ;;å””å¥½å…è®¸ä»è½¯ä»¶åŒ…ç¼“å­˜åŠ è½½ï¼ˆåŸå› ä¸€æ ·ï¼‰ã€‚
  (setq package-quickstart nil)
  ;; `use-package` å–º 29 ç‰ˆæœ¬å¼€å§‹å†…ç½®ã€‚å®ƒå¿…é¡»å–ºåŠ è½½ `use-package` ä¹‹
  ;; å‰è®¾ç½®ã€‚
  (setq use-package-enable-imenu-support t)
  ;; ç³»ç»Ÿé»˜è®¤ç¼–ç 
  (set-language-environment 'utf-8)
  ;; æ›´å¹²å‡€å˜… GUI
  ;; é€šè¿‡å°½æ—©ç¦ç”¨å‘¢å•² UI å…ƒç´ ï¼Œé¿å…å‡ºç°æœªåŠ æ ·å¼å˜… Emacs ç¬é—´æ˜¾ç¤ºã€‚
  (push '(menu-bar-lines . 0) default-frame-alist)
  (push '(tool-bar-lines . 0) default-frame-alist)
  (push '(vertical-scroll-bars) default-frame-alist)

  ;; è°ƒæ•´ Emacs çª—å£å¤§å°å¯èƒ½ç³»æ›´æ”¹å­—ä½“æ—¶éå¸¸æ˜‚è´µå˜…æ“ä½œã€‚
  ;; é€šè¿‡ç¦ç”¨å‘¢ä¸ªæ“ä½œï¼Œå½“å­—ä½“å¤§è¿‡ç³»ç»Ÿé»˜è®¤å­—ä½“æ—¶ï¼Œæˆ‘å“‹å¯ä»¥è½»æ¾å°†å¯åŠ¨æ—¶é—´å‡å°‘ä¸€åŠã€‚
  (setq frame-inhibit-implied-resize t)
  (setq default-frame-alist
        (append '((width                . 140)  ; Frameå¹…
                  (height               . 40 )  ; Frameé«˜
                  (left                 . 170 ) ; é…ç½®å·¦ä½ç½®
                  (top                  . 30 )  ; é…ç½®ä¸Šä½ç½®
                  (line-spacing         . 0  )  ; æ–‡å­—é–“éš”
                  (left-fringe          . 12 )  ; å·¦fringeå¹…
                  (right-fringe         . 12 )  ; å³fringeå¹…
                  (menu-bar-lines       . 1  )  ; èœå•è¡Œ
                  (cursor-type          . bar)  ; å…‰æ ‡ç¨®åˆ¥
                  (alpha                . 100)  ; é€æ˜åº¦
                  )
                default-frame-alist))
  (setq initial-frame-alist default-frame-alist)

  ;; å…ƒç´ ä¸€éƒ¨åˆ†ç¦ç”¨
  (when (fboundp 'menu-bar-mode) (menu-bar-mode -1)) ; keep the menu is better.
  (when (fboundp 'tool-bar-mode) (tool-bar-mode -1))
  (when (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))
  (toggle-frame-maximized)
  ;; ç·©è¡å€ï¼Œæ— ä»¤ç«‹æ®ºä¹‹ã€‚
  (setq kill-buffer-query-functions (delq 'process-kill-buffer-query-function kill-buffer-query-functions))
  (setq find-file-visit-truename t)
  (provide 'early-init)
  ;;(global-unset-key (kbd "C-SPC"))

  ;;; early-init.el ends here
#+end_src

** å‘¢ä¸ªä¿‚æˆ‘å˜… init.el :
:PROPERTIES:
:CUSTOM_ID: init
:END:
<<init>>


#+BEGIN_SRC emacs-lisp :tangle init.el :eval never-export
  (provide 'init);; å®šä¹‰ä¸€å°ç›®å½•ï¼Œæ–¹ä¾¿æ—¥åè¿ç§»ã€‚user-emacs-directory é€šå¸¸ä¿‚ ~/.emacs.d
  ;; windows ä¸‹, ~/ é€šå¸¸ä¿‚ $EMACS_INSTALL_DIR, æˆ–è€… EMACS æµ‹å®šå˜… `HOME`
  ;; å˜é‡ã€‚
  (defvar suk-emacs-root-dir      (file-truename user-emacs-directory))
  (defvar suk-emacs-config-dir    (expand-file-name "etc" suk-emacs-root-dir))
  (defvar suk-emacs-extension-dir (expand-file-name "extensions" suk-emacs-root-dir))
  (defvar suk-emacs-share-dir     (expand-file-name "share" suk-emacs-root-dir))
  (defvar suk-emacs-themes-dir    (expand-file-name "themes" suk-emacs-share-dir))
  (defvar suk-emacs-var-dir       (expand-file-name "var" suk-emacs-root-dir))
  (defvar suk-emacs-tmp-dir       (expand-file-name "tmp" suk-emacs-var-dir))
  (defvar suk-emacs-backup-dir    (expand-file-name "backup" suk-emacs-tmp-dir))

  ;; OS å˜… HOME ç›®å½•ã€‚
  (defvar user-home-dir (getenv "HOME"))
  (if (eq system-type 'windows-nt) (defvar user-home-dir (getenv "USERPROFILE")))
  ;; blink search
  (setq blink-search-db-path (expand-file-name "blink-search.db" suk-emacs-tmp-dir))
  ;; å†å²
  (setq savehist-file (concat suk-emacs-var-dir "/history"))
  ;; Amx
  (setq amx-save-file (concat suk-emacs-var-dir "/amx-items"))
  ;; è‡ªåŠ¨ä¿å­˜
  (setq auto-save-list-file-prefix (concat suk-emacs-var-dir "/auto-save-list/.saves-"))
  ;; Eshell
  (setq eshell-directory-name (concat suk-emacs-var-dir "/eschell"))
  (setq eshell-history-file-name (concat eshell-directory-name "/history"))
  ;; projectitle-bookmarks
  (setq projectile-known-projects-file (concat suk-emacs-var-dir "/projectile-bookmarks.eld"))
  (setq backup-directory-alist `(("" . ,suk-emacs-tmp-dir)))
  ;; Bookmark
  (setq bookmark-default-file (concat suk-emacs-var-dir "/emacs.bmk"))
  ;; Diary
  (setq diary-file (concat user-home-dir "/diary"))
  ;; server æ— æ•ˆ
  (require 'server)
  ;;(setq server-socket-dir suk-emacs-var-dir)

  ;; Clear to avoid analyzing files when loading remote files.
  (setq file-name-handler-alist nil)
  ;; Don't pass case-insensitive to `auto-mode-alist'
  (setq auto-mode-case-fold nil)


   (unless (file-exists-p suk-emacs-var-dir)
    (make-directory cache-dir t))
   (setq projectile-cache-file (expand-file-name "projectile.cache" suk-emacs-var-dir))

#+END_SRC

*** åŠ è½½ç›®å½•å‡½æ•°ï¼šé€’å½’  Emacs åŒåŸ‹æ’ä»¶å˜…è®¾å®šç›®å½•åˆ° `load-path`
:PROPERTIES:
:CUSTOM_ID: load-path-settings
:END:
<<load-path-settings>>

#+BEGIN_SRC emacs-lisp :tangle init.el  :eval never-export
  ;; Ignore `cl` expiration warnings
  (setq byte-compile-warnings '(cl-function))

  ;; original version
  ;;(defun add-subdirs-to-load-path (dir)
  ;;  "Recursive add directories to `load-path'."
  ;;  (let ((default-directory (file-name-as-directory dir)))
  ;;     (add-to-list 'load-path dir)
  ;;     (normal-top-level-add-subdirs-to-load-path)))

  ;; ç‹å‹‡çš„ç‰ˆæœ¬ https://manateelazycat.github.io/emacs/2022/03/02/emacs-load-directory-recursively.html
  (require 'cl-lib)
  (defun add-subdirs-to-load-path (search-dir isFirst)
    (interactive)
    (when isFirst
      ;; The original version did not add the first search-dir itself to
      ;; the `load path`. The recursive search-dir was added before the
      ;; recursion.
      (add-to-list 'load-path search-dir))
    (let* ((dir (file-name-as-directory search-dir)))
      (dolist (subdir
               ;; goleui bat bityiu ge mukluk, taising Emacs kaidung cudou.
               (cl-remove-if
                #'(lambda (subdir)
                    (or
                     ;; m hai mangin
                     (not (file-directory-p (concat dir subdir)))
                     ;; yiceui haamin ge mukluk
                     (member subdir '("." ".." ; Linux/Uniux haitung ge  dongcin mukluk tungmaai fu mukluk
                                      "dist" "node_modules" "__pycache__" ; takding ge yÃ¼yin seunggwaan ge mukluk
                                      "RCS" "CVS" "rcs" "cvs" ".git" ".github")))) ; baanbun hungjai mukluk
                (directory-files dir)))
        (let ((subdir-path (concat dir (file-name-as-directory subdir))))
          ;; mukluk bauhaam  .el .so .dll ge mangin di louging sinji gaa dou `load-path` binleung
          (when (cl-some #'(lambda (subdir-file)
                             (and (file-regular-p (concat subdir-path subdir-file))
                                  ;; .so .dll æ–‡ä»¶æŒ‡éElispè¯­è¨€ç¼–å†™çš„EmacsåŠ¨æ€åº“
                                  (member (file-name-extension subdir-file) '("el" "so" "dll"))))
                         (directory-files subdir-path))

            ;; jÃ¼yi: add-to-list ge daisaam go caamsou bitseuiwai t, timgaa dou meibou,
            ;; kokbou gwongdou yausin
            (add-to-list 'load-path subdir-path t))

          ;; geieuuk daigwai sausok ji mukluk.
          (add-subdirs-to-load-path subdir-path nil)))))

  ;; åŠ è½½å®šä¹‰çš„ç›®å½•
  (add-subdirs-to-load-path suk-emacs-config-dir t)
  (add-subdirs-to-load-path suk-emacs-extension-dir t)
  (add-subdirs-to-load-path suk-emacs-themes-dir t)

  ;; (add-to-list 'load-path "/usr/local/share/emacs/site-lisp")
  ;; (add-to-list 'load-path "~/vendor/org-mode/lisp")
  ;; (add-to-list 'load-path "~/vendor/org-mode/contrib/lisp")
  ;; (setq custom-file "~/.config/emacs/custom-settings.el")
  ;; (load custom-file t)
#+END_SRC

*** è®¾ç½® GC
:PROPERTIES:
:CUSTOM_ID: gc-settings
:END:
<<gc-settings>>

#+begin_src emacs-lisp :tangle init.el :eavl never-export

  (setq gc-cons-threshold most-positive-fixnum)
  (setq gc-cons-percentage 0.8)
  ;; Reset the GC setting
  (add-hook 'emacs-startup-hook
            (lambda ()
              ;; é»˜è®¤ä¿‚ 0.8MB
              ;;(setq gc-cons-threshold 80000000)
              (message "Emacs ready in %s with %d garbage collections."
                       (format "%.2f seconds"
                               (float-time
                                (time-subtract after-init-time before-init-time)))
                       gcs-done)
              (defun my-cleanup-gc ()
                "Clean up gc."
                (setq gc-cons-threshold  67108864) ; 64M
                (setq gc-cons-percentage 0.1) ; original value
                (garbage-collect))
              (run-with-idle-timer 4 nil #'my-cleanup-gc)
              (add-hook 'focus-out-hook 'garbage-collect)))


#+end_src

*** å¸¸é‡å®šä¹‰
:PROPERTIES:
:CUSTOM_ID: const
:END:
<<const>>

#+begin_src emacs-lisp :tangle init.el :eval never-export
  (defconst sys/win32p
    (eq system-type 'windows-nt)
    "Are we running on a WinTel system?")

  (defconst sys/linuxp
    (eq system-type 'gnu/linux)
    "Are we running on a GNU/Linux system?")

  (defconst sys/macp
    (eq system-type 'darwin)
    "Are we running on a Mac system?")

  (defconst sys/mac-x-p
    (and (display-graphic-p) sys/macp)
    "Are we running under X on a Mac system?")

  (defconst sys/linux-x-p
    (and (display-graphic-p) sys/linuxp)
    "Are we running under X on a GNU/Linux system?")

  (defconst sys/cygwinp
    (eq system-type 'cygwin)
    "Are we running on a Cygwin system?")

  (defconst sys/rootp
    (string-equal "root" (getenv "USER"))
    "Are you using ROOT user?")

  (defconst emacs/>=25p
    (>= emacs-major-version 25)
    "Emacs is 25 or above.")

  (defconst emacs/>=26p
    (>= emacs-major-version 26)
    "Emacs is 26 or above.")

  (defconst emacs/>=27p
    (>= emacs-major-version 27)
    "Emacs is 27 or above.")

  (defconst emacs/>=28p
    (>= emacs-major-version 28)
    "Emacs is 28 or above.")

  (defconst emacs/>=29p
    (>= emacs-major-version 29)
    "Emacs is 29 or above.")

  (defconst emacs/>=30p
    (>= emacs-major-version 30)
    "Emacs is 30 or above.")
#+end_src

*** è¼‰å…¥è‡ªè¨‚è¨­å®š
:PROPERTIES:
:CUSTOM_ID: setup-custom
:END:
<<setup-custom>>

#+begin_src emacs-lisp :tangle init.el :eval never-export
  ;; set const
  (defconst custom-template-file
    (expand-file-name "custom-template.el" user-emacs-directory)
    "Custom template file of Suk's Emacs.")

  (defconst suk-homepage
    "https://github.com/bruceasu/.emacs.d"
    "The Github page of this Emacs config.")


  (defgroup suk nil
    "suk Emacs customizations."
    :group 'convenience
    :link '(url-link :tag "Homepage" "https://github.com/bruceasu/.emacs.d"))

  (defcustom suk-icon t
    "Display icons or not."
    :group 'suk
    :type 'boolean)

  (defcustom org-roam-directory (expand-file-name "RoamNotes" user-home-dir)
    "The org roam directory."
    :group 'suk
    :type 'string)

  (defcustom org-files-directory (expand-file-name "org" user-home-dir)
    "The org roam directory."
    :group 'suk
    :type 'string)

  (defcustom my-org-inline-css-file "~/.emacs.d/share/my-org-style-min.css"
    "The org css style file."
    :group 'suk
    :type 'string)



  (defcustom suk-prettify-symbols-alist
    '(("lambda" . ?Î»)
      ("<-"     . ?â†)
      ("->"     . ?â†’)
      ("->>"    . ?â† )
      ("=>"     . ?â‡’)
      ("map"    . ?â†¦)
      ("/="     . ?â‰ )
      ("!="     . ?â‰ )
      ("=="     . ?â‰¡)
      ("<="     . ?â‰¤)
      (">="     . ?â‰¥)
      ("=<<"    . (?= (Br . Bl) ?â‰ª))
      (">>="    . (?â‰« (Br . Bl) ?=))
      ("<=<"    . ?â†¢)
      (">=>"    . ?â†£)
      ("&&"     . ?âˆ§)
      ("||"     . ?âˆ¨)
      ("not"    . ?Â¬))
    "A list of symbol prettifications. Nil to use font supports ligatures."
    :group 'suk
    :type '(alist :key-type string :value-type (choice character sexp)))

  (defcustom suk-prettify-org-symbols-alist
    '(("[ ]"            . ?ï‚–)
      ("[-]"            . ?ï…‡)
      ("[X]"            . ?ï†)

      ;; (":PROPERTIES:"   . ?ï€‹)
      ;; (":ID:"           . ?ğŸªª)
      ;; (":END:"          . ?ğŸ”š)

      ;; ("#+ARCHIVE:"     . ?ğŸ“¦)
      ;; ("#+AUTHOR:"      . ?ğŸ‘¤)
      ;; ("#+CREATOR:"     . ?ğŸ’)
      ;; ("#+DATE:"        . ?ğŸ“†)
      ;; ("#+DESCRIPTION:" . ?â¸™)
      ;; ("#+EMAIL:"       . ?ğŸ“§)
      ;; ("#+HEADERS"      . ?â˜°)
      ;; ("#+OPTIONS:"     . ?âš™)
      ;; ("#+SETUPFILE:"   . ?âš’)
      ("#+TAGS:"        . ?ğŸ·)
      ("#+TITLE:"       . ?ğŸ““)

      ("#+BEGIN_SRC"    . ?âœ)
      ("#+END_SRC"      . ?â–¡)
      ("#+BEGIN_QUOTE"  . ?Â«)
      ("#+END_QUOTE"    . ?Â»)
      ("#+RESULTS:"     . ?ğŸ’»)
      )
    "A list of symbol prettifications for `org-mode'."
    :group 'suk
    :type '(alist :key-type string :value-type (choice character sexp)))


   (defcustom suk-rime t
    "Display use emacs rime or not."
    :group 'suk
    :type 'boolean)
  
   (defcustom suk-copilot-enable nil
     "Enable copilot mode"
     :group 'suk
     :type 'boolean)

  (defcustom  suk-eglot-enable nil
    "Enable eglot mode"
    :group 'suk
    :type 'boolean)

  ;; Load `custom-file'
  ;; If it doesn't exist, copy from the template, then load it.
  (setq custom-file (expand-file-name "custom.el" user-emacs-directory))

  (let ((custom-template-file
         (expand-file-name "custom-template.el" user-emacs-directory)))
    (if (and (file-exists-p custom-template-file)
             (not (file-exists-p custom-file)))
        (copy-file custom-template-file custom-file)))

  (load-file custom-file)
  ;;(if (file-exists-p custom-file)
  ;;    (load custom-file))

  ;; Load `custom-post.el'
  ;; Put personal configurations to override defaults here.
  (add-hook 'after-init-hook
            (lambda ()
              (let ((file
                     (expand-file-name "custom-post.el" user-emacs-directory)))
                (if (file-exists-p file)
                    (load file)))))
#+end_src

*** é€šç”¨å‡½æ•°
:PROPERTIES:
:CUSTOM_ID: setup-common-functions
:END:
<<setup-coommon-functions>>

#+begin_src emacs-lisp :tangle suk.el :eval never-export
 (require 'basic-function)
#+end_src
*** Emacs Package åˆå§‹åŒ–
:PROPERTIES:
:CUSTOM_ID: setup-package
:END:
<<setup-package>>

#+begin_src emacs-lisp :tangle init.el :eval never-export
  ;; This sets up the load path so that we can override it
  (setq warning-suppress-log-types '((package reinitialization)))
  ;; æŒ‡å®šELPAç›®å½•
  (setq package-user-dir (expand-file-name "elpa" "~/.local/share"))
  (add-subdirs-to-load-path package-user-dir t)

  ;; HACK: DO NOT copy package-selected-packages to init/custom file forcibly.
  ;; https://github.com/jwiegley/use-package/issues/383#issuecomment-247801751
  (defun my-save-selected-packages (&optional value)
    "Set `package-selected-packages' to VALUE but don't save to `custom-file'."
    (when value
      (setq package-selected-packages value)))

  (advice-add 'package--save-selected-packages :override #'my-save-selected-packages)

  (require 'package)
  ;;(setq package-archives '(("melpa" . "http://melpa.org/packages/")
  ;;                         ("gnu" . "http://elpa.gnu.org/packages/")
  ;;                         ("nongnu" . "https://elpa.nongnu.org/nongnu/"))

  (add-to-list 'package-archives
               '("melpa" . "https://melpa.org/packages/"))
  ;; (add-to-list 'package-archives
  ;;              '("melpa-stable" . "https://stable.melpa.org/packages/"))
  (add-to-list 'package-archives
               '("org" . "https://orgmode.org/elpa/"))
  (add-to-list 'package-archives
               '("gnu" . "https://elpa.gnu.org/packages/"))
  (add-to-list 'package-archives
               '("nongnu" . "https://elpa.nongnu.org/nongnu/"))


  ;; è‹¥éµå¾ªã€Œå¤§é“è‡³ç®€ç­–å®‰è£ç©©å®šç‰ˆã€ï¼Œè«‹æ¶ˆæ³¨ä¸‹è¡Œã€‚
  ;; (setq package-archives '(("myelpa" . "~/myelpa/"))) 

  (setq package-check-signature nil) ; ä¸ªåˆ«æ—¶å€™ä¼šå‡ºç°ç­¾åæ ¡éªŒå¤±è´¥

  ;; åˆç½®åŒ…å®˜
  ;; (unless (bound-and-true-p package--initialized) ; To avoid warnings in 27
  ;;   (setq package-enable-at-startup nil)          ; To prevent initializing twice
  ;;   (package-initialize))

  (unless (bound-and-true-p package--initialized)
    (package-initialize))

  ;; Should set before loading `use-package'
  ;; make use-package default behavior better
  ;; with `use-package-always-ensure' you won't need ":ensure t" all the time
  ;; with `use-package-always-defer' you won't need ":defer t" all the time
  (setq use-package-always-ensure t
        use-package-always-defer t
        use-package-enable-imenu-support t
        use-package-expand-minimally t)

  ;; Setup `use-package'
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package)
    )

  (require 'use-package)


  (defun load-if-exists (f)
  "load the elisp file only if it exists and is readable"
  (if (file-readable-p f)
      (load-file f)))

      ;;;###autoload
  (defun my-ensure (feature)
    "Make sure FEATURE is required."
    (unless (featurep feature)
      (condition-case nil
          (require feature)
        (error nil))))

  ;; On-demand installation of packages
  (defun require-package (&rest packages)
    "Ensure PACKAGES are installed.
   If a package is not installed, it will be installed automatically."
    (dolist (package packages)
      (unless (package-installed-p package)
        (package-install package)))
    (use-package package)
    )

  ;; Compatibility
  (use-package compat :demand t)
#+end_src

*** åŠ è½½ç‰¹å®šå˜…è®¾å®šæ–‡ä»¶
:PROPERTIES:
:CUSTOM_ID: load-file-settings
:END:
<<load-file-settings>>

=suk.el= ä¿‚ç”± =M-x org-babel-tangle= (=C-c C-v t=) å‘½ä»¤ç”Ÿæˆå˜…ã€‚

*å…³äº Org æ›´æ–°å˜…è´´å£«:* æˆ‘é¾æ„å¾å·²æª¢å‡ºçš„æºä»£ç¢¼é‹è¡Œ Org Modeï¼Œè€Œå””ä¿‚ç”¨
package.elã€‚æˆ‘æœƒå°‡ Lisp ç›®éŒ„åŠ å…¥æˆ‘å˜… =load-path= ï¼ŒåŒæ™‚æˆ‘éƒ½æœƒå–ºç¬¬ä¸€æ¬¡
=use-package org= å‘¼å«ä¸­ä½¿ç”¨ =:load-path= é¸é …åšŸè¨­ç½®åŠ è¼‰è·¯å¾‘ã€‚å…¶ä¸­ä¸€å€‹å¯èƒ½
ä¿‚æœ‰æ•ˆå˜…ï¼Œå¦ä¸€å€‹å¯èƒ½ä¿‚å¤šé¤˜å˜…ï¼Œä½†å¯èƒ½ä¿‚ä¸€ç¨®ã€Œçš®å¸¶åŠ åŠå¸¶ã€å˜…åšæ³•ã€‚ç”±æ–¼æˆ‘
é€šé =org-babel-tangle= ç”Ÿæˆ =suk.el= ï¼Œæ‰€ä»¥æˆ‘å˜… Emacs é…ç½®å¯ä»¥å–ºå””éœ€è¦å…ˆ
åŠ è¼‰ Org å˜…æƒ…æ³ä¸‹åŠ è¼‰ =suk.el= ã€‚
#+begin_src emacs-lisp :tangle init.el :eval never-export
  (load-if-exists (expand-file-name "suk.el" suk-emacs-root-dir))
  (unless (server-running-p) (server-start))

#+END_SRC

** è°ƒè¯•è´´å£«
å¦‚æœå•²å˜¢å£å’—ï¼Œæˆ‘å¯ä»¥ç”¨ï¼š

- ~check-parens~ åšŸæµå””å•±å˜…æ‹¬è™Ÿ
- package: *bug-hunter* å°‡æˆ‘å˜…é…ç½®åˆ†æˆå…©åŠ
- ~trace-function-background~ å°‡è³‡è¨Šåˆ—å°åˆ°ç·©è¡å€
- ~profiler-start~ åšŸæµå¤šå•²æœ‰é—œæ…¢å‡½æ•¸å˜…è³‡è¨Š
* æˆ‘å˜…è¨­å®š
** å€‹äººä¿¡æ¯
:PROPERTIES:
:CUSTOM_ID: setup-personal-info
:END:
<<setup-personal-info>>

#+begin_src emacs-lisp :tangle suk.el :eval never-export
  (setq user-full-name "Suk")
  (setq user-mail-address "bruceasu@gmail.com")
#+end_src
** ç¼–è¾‘å™¨è®¾å®š
:PROPERTIES:
:CUSTOM_ID: setup-editor
:END:
<<setup-editor>>

*** åŸºæœ¬è¨­å®š
:PROPERTIES:
:CUSTOM_ID: setup-basic
:END:
<<setup-basic>>

#+begin_src emacs-lisp :tangle suk.el :eval never-export
  ;; basic settings
  (setq-default
   major-mode 'text-mode ; é»˜è®¤ä½¿ç”¨textæ¨¡å¼
   cursor-type 'bar      ; è®¾ç½®å…‰æ ‡æ ·å¼
   tab-width 4           ; tab çš„å®½åº¦ä¸º 4 ç©ºæ ¼
   indent-tabs-mode nil  ; æ°¸ä¹…ä½¿ç”¨ç©ºæ ¼ç¸®æ’ï¼Œå””å¥½ç”¨ TAB åªä¿‚ç”¨ç©ºæ ¼ä»£æ›¿
                         ; TABï¼Œä½¿ç”¨ C-q TAB ä¾†è¼¸å…¥ TAB å­—ç¬¦
   )
  (tooltip-mode -1)                          ;ä¸è¦æ˜¾ç¤ºä»»ä½• tooltips
  (delete-selection-mode 1)                  ;é€‰ä¸­æ–‡æœ¬åè¾“å…¥ä¼šè¦†ç›–
  (size-indication-mode 1)
  (server-mode 1)
  (global-hl-line-mode 1)                    ;é«˜äº®å½“å‰è¡Œ
  (put 'narrow-to-region 'disabled nil)      ;å¼€å¯å˜çª„åŒºåŸŸ
  (auto-compression-mode 1)                  ;æ‰“å¼€å‹ç¼©æ–‡ä»¶æ—¶è‡ªåŠ¨è§£å‹ç¼©
  (show-paren-mode t)                        ;æ˜¾ç¤ºæ‹¬å·åŒ¹é…
  ;;(blink-cursor-mode -1)
  (setq inhibit-startup-message t)           ; å…³é—­å¯åŠ¨æ¬¢è¿ç•Œé¢
  ;; (setq initial-scratch-message nil)      ; æ¸…ç©º *scratch* ç¼“å†²åŒºä¿¡æ¯
  (setq inhibit-startup-echo-area-message t) ; å…³é—­å¯åŠ¨æ—¶å›æ˜¾åŒºçš„æç¤ºä¿¡æ¯


  (setq read-process-output-max #x10000)  ; 64kb.  Increase how much is read from processes in a single chunk (default is 4kb)
  (setq vc-follow-symlinks t)
  (setq font-lock-maximum-decoration t)

  (setq adaptive-fill-regexp "[ t]+|[ t]*([0-9]+.|*+)[ t]*")
  (setq adaptive-fill-first-line-regexp "^* *$")
  (setq set-mark-command-repeat-pop t) ; Repeating C-SPC after popping mark pops it again
  (setq sentence-end "\\([ã€‚ï¼ï¼Ÿï¿¥%Ã—ï¼ˆï¼‰â€”]\\|â€¦â€¦\\|[.?!][]\"')}]*\\($\\|[ \t]\\)\\)[ \t\n]*") ; æµ‹å®šå¥å­ç»“æŸè¯†åˆ«åŒåŸ‹æ ‡ç‚¹ï¼Œä¸ç”¨åœ¨ `fill` æ—¶ï¼Œå†å¥å·åæ’å…¥ 2 ä¸ªç©ºè¡Œã€‚
  (setq sentence-end-double-space nil)
  (add-hook 'after-change-major-mode-hook (lambda ()(modify-syntax-entry ?_ "w"))) ;; è®© `_` è¢«è§†ä¸ºå•è¯å˜…ç»„æˆéƒ¨åˆ†
  (add-hook 'after-change-major-mode-hook (lambda () (modify-syntax-entry ?- "w"))) ;; `-` ç¬¦å·åŒæ ·
  (setq suggest-key-bindings 1)             ;å½“ä½¿ç”¨ M-x COMMAND åï¼Œè¿‡ 1 ç§’é’Ÿæ˜¾ç¤ºè¯¥ COMMAND ç»‘å®šçš„é”®ã€‚
  (setq browse-kill-ring-quit-action        ;è®¾ç½®é€€å‡ºåŠ¨ä½œ
        (quote save-and-restore))           ;ä¿å­˜è¿˜åŸçª—å£è®¾ç½®
  (setq max-lisp-eval-depth 4096)           ;lispæœ€å¤§æ‰§è¡Œæ·±åº¦
  (setq kill-ring-max 1024)                 ;ç”¨ä¸€ä¸ªå¾ˆå¤§çš„ kill ring. è¿™æ ·é˜²æ­¢æˆ‘ä¸å°å¿ƒåˆ æ‰é‡è¦çš„ä¸œè¥¿
  (setq mark-ring-max 1024)                 ;è®¾ç½®çš„mark ringå®¹é‡
  (setq eval-expression-print-length nil)   ;è®¾ç½®æ‰§è¡Œè¡¨è¾¾å¼çš„é•¿åº¦æ²¡æœ‰é™åˆ¶
  (setq eval-expression-print-level nil)    ;è®¾ç½®æ‰§è¡Œè¡¨è¾¾å¼çš„æ·±åº¦æ²¡æœ‰é™åˆ¶
  (setq read-quoted-char-radix 16)          ;è®¾ç½® å¼•ç”¨å­—ç¬¦ çš„åŸºæ•°
  (setq global-mark-ring-max 1024)          ;è®¾ç½®æœ€å¤§çš„å…¨å±€æ ‡è®°å®¹é‡
  (setq isearch-allow-scroll t)             ;isearchæœç´¢æ—¶æ˜¯å¯ä»¥æ»šåŠ¨å±å¹•çš„
  (setq enable-recursive-minibuffers t)     ;minibuffer é€’å½’è°ƒç”¨å‘½ä»¤
  (setq history-delete-duplicates t)        ;åˆ é™¤minibufferçš„é‡å¤å†å²
  (setq minibuffer-message-timeout 2)       ;æ˜¾ç¤ºæ¶ˆæ¯è¶…æ—¶çš„æ—¶é—´
  (setq auto-revert-mode 1)                 ;è‡ªåŠ¨æ›´æ–°buffer
  (setq show-paren-style 'parentheses)      ;æ‹¬å·åŒ¹é…æ˜¾ç¤ºä½†ä¸æ˜¯çƒ¦äººçš„è·³åˆ°å¦ä¸€ä¸ªæ‹¬å·ã€‚
  ;;(setq blink-matching-paren nil)         ;å½“æ’å…¥å³æ‹¬å·æ—¶ä¸æ˜¾ç¤ºåŒ¹é…çš„å·¦æ‹¬å·
  (setq message-log-max t)                  ;è®¾ç½®messageè®°å½•å…¨éƒ¨æ¶ˆæ¯, è€Œä¸ç”¨æˆªå»
  (setq require-final-newline nil)          ;ä¸è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦åˆ°æœ«å°¾, æœ‰äº›æƒ…å†µä¼šå‡ºç°é”™è¯¯
  (setq ediff-window-setup-function
        (quote ediff-setup-windows-plain))  ;æ¯”è¾ƒçª—å£è®¾ç½®åœ¨åŒä¸€ä¸ªframeé‡Œ
  (setq x-stretch-cursor t)                 ;å…‰æ ‡åœ¨ TAB å­—ç¬¦ä¸Šä¼šæ˜¾ç¤ºä¸ºä¸€ä¸ªå¤§æ–¹å—
  (setq print-escape-newlines t)            ;æ˜¾ç¤ºå­—ç¬¦çª—ä¸­çš„æ¢è¡Œç¬¦ä¸º \n
  (setq tramp-default-method "ssh")         ;è®¾ç½®ä¼ é€æ–‡ä»¶é»˜è®¤çš„æ–¹æ³•
  (setq void-text-area-pointer nil)         ;ç¦æ­¢æ˜¾ç¤ºé¼ æ ‡æŒ‡é’ˆ
  (setq auto-window-vscroll nil)            ;å…³é—­è‡ªåŠ¨è°ƒèŠ‚è¡Œé«˜
  (setq mouse-yank-at-point nil)            ;è®©å…‰æ ‡æ— æ³•ç¦»å¼€è§†çº¿
  (setq kill-whole-line t)                  ; C-k deletes the end of line
  (setq delete-by-moving-to-trash t)        ; Deleting files go to OS's trash folder
  (setq track-eol t)                        ; Keep cursor at end of lines. Require line-move-visual is nil.
  (setq line-move-visual nil)
  (setq save-interprogram-paste-before-kill t) ; Save clipboard contents into kill-ring before replace them
  ;;(setq auto-save-default nil)            ; Disable auto save
  (setq echo-keystrokes 0.1)                ;åŠ å¿«å¿«æ·é”®æç¤ºçš„é€Ÿåº¦

  ;; Hanlde minified code
  (if emacs/>=27p
      (add-hook 'after-init-hook #'global-so-long-mode))

  ;; å¦‚æœæœ‰ä¸¤ä¸ªé‡åbuffer, åˆ™å†å‰é¢åŠ ä¸Šè·¯å¾„åŒºåˆ«
  (require 'uniquify)
  (with-eval-after-load 'uniquify
    ;; (setq uniquify-buffer-name-style 'forward)
    (setq uniquify-buffer-name-style 'post-forward-angle-brackets)
    )
  ;; Misc
  (if (boundp 'use-short-answers)
      (setq use-short-answers t)
    (fset 'yes-or-no-p 'y-or-n-p))


#+end_src
*** å‚™ä»½è¨­å®š
:PROPERTIES:
:CUSTOM_ID: setup-backup
:END:
<<setup-backup>>

#+begin_src emacs-lisp :tangle suk.el :eval never-export
  ;; backup settings
  (setq make-backup-files t)
  (setq version-control t)     ; å…è®¸å¤šæ¬¡å¤‡ä»½
  (setq kept-old-versions 2)   ; ä¿ç•™æœ€æ—©çš„2ä¸ªå¤‡ä»½æ–‡ä»¶
  (setq kept-new-version 100)  ; ä¿ç•™æœ€è¿‘çš„100ä¸ªå¤‡ä»½æ–‡ä»¶
  (setq delete-old-versions t) ; è‡ªåŠ¨åˆ é™¤æ—§çš„å¤‡ä»½æ–‡ä»¶
#+end_src
*** æ­´å²
:PROPERTIES:
:CUSTOM_ID: setup-history
:END:
<<setup-history>>

#+begin_src emacs-lisp :tangle suk.el
  (setq enable-recursive-minibuffers t ; Allow commands in minibuffers
        history-length 1000
        savehist-additional-variables '(mark-ring
                                        global-mark-ring
                                        search-ring
                                        regexp-search-ring
                                        extended-command-history)
        savehist-autosave-interval 300
        savehist-file (expand-file-name "history" suk-emacs-var-dir) ; "~/.emacs.d/var/history"
        )
  (savehist-mode 1)
#+end_src
*** ç·¨ç¢¼è¨­å®š
:PROPERTIES:
:CUSTOM_ID: setup-charset
:END:
<<setup-charset>>
#+begin_src emacs-lisp :tangle suk.el
  ;; Set UTF-8 as the default coding system
  (prefer-coding-system 'utf-8)
  (setq default-buffer-file-coding-system 'utf-8)            ;ç¼“å­˜æ–‡ä»¶ç¼–ç 
  (setq default-file-name-coding-system 'utf-8)              ;æ–‡ä»¶åç¼–ç 
  (setq default-keyboard-coding-system 'utf-8)               ;é”®ç›˜è¾“å…¥ç¼–ç 
  (setq default-process-coding-system '(utf-8 . utf-8))      ;è¿›ç¨‹è¾“å‡ºè¾“å…¥ç¼–ç 
  (setq default-sendmail-coding-system 'utf-8)               ;å‘é€é‚®ä»¶ç¼–ç 
  (setq default-terminal-coding-system 'utf-8)               ;ç»ˆç«¯ç¼–ç 


  (set-default-coding-systems 'utf-8)
  (set-terminal-coding-system 'utf-8)
  (set-keyboard-coding-system 'utf-8)
  (setq-default buffer-file-coding-system 'utf-8)

  (set-terminal-coding-system 'utf-8)
  (set-keyboard-coding-system 'utf-8)

  (setq buffer-file-coding-system 'utf-8)
  (setq session-save-file-coding-system 'utf-8)

  (set-language-environment "UTF-8")

  ;; é‡è¦æç¤º:å†™åœ¨æœ€åä¸€è¡Œçš„ï¼Œå®é™…ä¸Šæœ€ä¼˜å…ˆä½¿ç”¨; æœ€å‰é¢ä¸€è¡Œï¼Œåè€Œæ”¾åˆ°æœ€åæ‰è¯†åˆ«ã€‚
  ;; utf-16le-with-signature ç›¸å½“äº Windows ä¸‹çš„ Unicode ç¼–ç ï¼Œè¿™é‡Œä¹Ÿå¯å†™æˆ
  ;; utf-16 (utf-16 ham:  utf-16le, utf-16be, utf-16le-with-signature dang)
  ;; Unicode
  ;; (prefer-coding-system 'utf-16le-with-signature)
  ;; (prefer-coding-system 'utf-16)
  ;; (prefer-coding-system 'utf-8-dos)
  (prefer-coding-system 'utf-8)
#+end_src
** ä¼ºæœºåŠ è½½ Lazy Load
:PROPERTIES:
:CUSTOM_ID: setup-lazy-load
:END:
<<setup-lazy-load>>

- å…¨å±€ lazy-load-global-keys
- æ¨¡å¼ lazy-load-local-keys

æ”¯æŒæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’å‰ç¼€æŒ‰é”®ï¼Œ

å¦‚æœ Emacs é»˜è®¤å·²ç»åŠ è½½å’—æŸä¸ªæ’ä»¶ï¼Œè€Œå””éœ€è¦å–ºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œéƒ½å¯ä»¥ä½¿
ç”¨ lazy-load-set-keys

å¥½å¤šå…¨å±€æŒ‰é”®é»˜è®¤å·²ç»è¢« Emacs å ç”¨å’—ï¼Œå¿…é¡»å…ˆå¸è½½å…ˆå¯ä»¥é‡æ–°ç»‘å®šå•²å…¨å±€æŒ‰
é”®ï¼Œä¾‹å¦‚ Ctrl + xï¼Œä¸‹é¢å‘¢æ®µä»£ç å°±ç³»ç”¨ lazy-load-unset-keys å¸è½½é»˜è®¤ç»‘
å®šå˜…å…¨å±€æŒ‰é”®ã€‚

#+begin_example
 ;;; --- å¸è½½æŒ‰é”®
 (lazy-load-unset-keys ;å…¨å±€æŒ‰é”®çš„å¸è½½
  '("C-z" "C-x"  "s-W" "s-z" "M-h" "C-\\" "s-c" "s-x" "s-v"))

 ;; Macå¹³å°ä¸‹äº¤æ¢ Option å’Œ Command é”®ã€‚

  (when (featurep 'cocoa)
    (setq mac-option-modifier 'super)
    (setq mac-command-modifier 'meta))

#+end_example

#+begin_src emacs-lisp :tangle etc/init-key.el
  (require 'lazy-load)
  (provide 'init-key)
  ;;; ### Unset key ###
  ;;; --- å¸è½½æŒ‰é”®
  (lazy-load-unset-keys                   ;å…¨å±€æŒ‰é”®çš„å¸è½½
   ;; '("C-z"  "s-W" "s-z" "M-h" "C-\\" "s-c" "s-x" "s-v"))
   '("C-z" ))

#+end_src
Add to suk.el
#+begin_src emacs-lisp :tangle suk.el
  (require 'init-key)
#+end_src

** ä½•ä»¥å¿«é”® How to set keys
*** Bindkeys examples
#+begin_src emacs-elisp :tangle achrives-and-examples.el
;; global-set-key examples:
(global-set-key (kbd "C-x C-\\") 'next-line)
(global-set-key [?\C-x ?\C-\\] 'next-line)
(global-set-key [(control ?x) (control ?\\)] 'next-line)

;; remove a keybinding

;; for emacs 29 or after
(keymap-global-set "C-t" nil)
;; or use
(keymap-global-unset "C-t")
;; before emacs 28 or before
(global-set-key (kbd "C-t") nil)
;; or
(global-unset-key (kbd "C-t"))


(define-prefix-command 'my-leader) ;è®¾å®šleader
(define-key keymap "keystrok" 'command-name)   ;å°†å¿«æ·é”®ç»‘å®šåˆ° leaderæŒ‰é”®åï¼Œå³å’Œé”®ä½å›¾ç»‘å®šã€‚
(global-set-key "keystroke" 'command-name) ; å®šä¹‰å…¨å±€å¿«æ·é”®
(local-set-key  "keystroke" 'command-name) ; å®šä¹‰å±€éƒ¨å¿«æ·é”®
;;æ³¨æ„ï¼škeystrokeä¸­çš„Control å’Œ Alternativeä½¿ç”¨\C, \Mè¡¨ç¤ºã€‚
;;å¦‚æœæ˜¯kbdå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨Cå’ŒMè¡¨ç¤º

;; æ–¹å¼ä¸€ï¼š
(define-prefix-command 'SPC-map)
(global-set-key (kbd "SPC") 'SPC-map)
(global-set-key (kbd "SPC f") 'find-file)

;; æ–¹å¼äºŒï¼š
(define-prefix-command 'SPC-map)
(global-set-key (kbd "SPC") #'SPC-map)
(define-key SPC-map (kbd "f") #'find-file)


;; æ¼”ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ–°çš„æŒ‰é”®å‰ç¼€. è¿™é‡Œå®šä¹‰äº†M-cä½œä¸ºæŒ‰é”®å‰ç¼€.
(define-prefix-command 'comma-map)
(global-set-key (kbd ",") 'comma-map)
(global-set-key [(meta c)] 'meta-c-map)
;; æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªæ¨¡å¼ä¸‹(è¿™é‡Œæ˜¯isearchæ¨¡å¼), å®šä¹‰å¿«æ·é”®.
;; é€€å‡ºisearch-mode, æ‰€æœ‰æŒ‰é”®å¤±æ•ˆ.
(add-hook
  'isearch-mode-hook
  '(lambda ()
    ;; æœç´¢ä¸‹ä¸€ä¸ªç»“æœ
    (define-key isearch-mode-map [(meta n)] 'isearch-repeat-forward)
    ;; æœç´¢å‰ä¸€ä¸ªç»“æœ
    (define-key isearch-mode-map [(meta p)] 'isearch-repeat-backward)
    ;; æ›¿æ¢
    (define-key isearch-mode-map [(control r)] 'isearch-query-replace)
    ;; æ­£åˆ™æ›¿æ¢
    (define-key isearch-mode-map [(meta 5)] 'isearch-query-replace-regexp)
    (define-key isearch-mode-map [(meta f)] 'isearch-yank-word-or-char)
    ;; å‰ªåˆ‡æ¿ä½œä¸ºæœç´¢å†…å®¹
    (define-key isearch-mode-map [(meta y)] 'isearch-yank-kill)
    ;; å°†å…‰æ ‡åˆ°è¡Œå°¾ä½œä¸ºæœç´¢å†…å®¹
    (define-key isearch-mode-map [(meta k)] 'isearch-yank-line)
    (define-key isearch-mode-map [(hyper l)] 'isearch-yank-char)
    ;; å‘å·¦æˆ–å‘å³(é€‰æ‹©/å–æ¶ˆ)å•ä¸ªå­—ç¬¦ä½œä¸ºæœç´¢å†…å®¹
    (define-key isearch-mode-map [(hyper j)] 'isearch-delete-char)
    ;; æ˜¾ç¤ºoccurè§†å›¾
    (define-key isearch-mode-map [(meta o)] 'isearch-occur)
    ;; å•è¯æœç´¢
    (define-key isearch-mode-map [(meta w)] 'isearch-forward-word)
    (define-key isearch-mode-map [(meta s)] 'isearch-repeat-forward)
    ))

#+END_SRC

ç›´æ¥å®šä¹‰å…¨å±€å¿«æ·é”®ï¼š
:  (global-set-key (kbd "C-c n d") #'denote)

è‡ªå·±å®šä¹‰ keymap å…¶å®å¾ˆç®€å•çš„ï¼Œä½¿ç”¨ defvar-keymap ï¼Œå¯ä»¥ä»ä¸Šé¢çš„é…ç½®ä¸­
æŠ½å– C-c n ä½œä¸ºä¸€ä¸ª prefix key ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š
#+BEGIN_EXAMPLE
(define-prefix-command  hsk/notetaking-map)
(define-key  hsk/notetaking-map (kbd "d") #denote)

or

(defvar-keymap hsk/notetaking-map
  :doc "My notetaking keymap"
  "d" #'denote
  "t" #'denote-keywords-add
  "T" #'denote-keywords-remove)
#+END_EXAMPLE

ç„¶åå°±å¯ä»¥ç”¨ï¼š
: (global-set-key (kbd "C-c n") hsk/notetaking-map)

æ¥å°†ä¸Šé¢å®šä¹‰çš„ keymap ç»‘å®šåˆ° C-c n ä¸Šã€‚ä¸è¿‡ä» emacs-29 å¼€å§‹ï¼Œæ›´æ¨èç”¨
keymap-set ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ”¹æˆï¼š
: (keymap-set global-map "C-c n" hsk/notetaking-map)
: (keymap-global-set "C-c n" hsk/notetaking-map)

çœå»äº† (kbd ...) è¿™ä¸€å±‚ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚

æ¯”èµ·åŸå…ˆæ¯ä¸ªå¿«æ·é”®å•ç‹¬å®šä¹‰ï¼Œä½¿ç”¨ keymap å¥½å¤„æ˜¯ä¾¿äºç®¡ç†ï¼Œæ¯”å¦‚ä¹‹åæˆ‘æƒ³æ›´
æ¢å¿«æ·é”®å‰ç¼€ï¼Œä» C-c n æ¢æˆ C-c C-n ï¼Œåªè¦æ”¹ä¸€å¤„ keymap-set å°±å¯ä»¥äº†ã€‚

å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥åµŒå¥—å®šä¹‰ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦å°† org-journal ç›¸å…³çš„æ“ä½œä¹ŸæŒ‚åˆ°
hsk/notetaking-map ä¸‹é¢ï¼Œå¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ª hsk/org-journal-mapï¼š
#+BEGIN_EXAMPLE
  (defvar-keymap hsk/org-journal-map
  :doc "My org-journal keymap"
  "n" #'org-journal-new-entry
  "s" #'org-journal-search
  "o" #'org-journal-open-current-journal-file)
#+END_EXAMPLE


ç„¶åå°†å®ƒåµŒå¥—è¿›å¦ä¸€ä¸ª map ä¸‹é¢ï¼š
#+BEGIN_EXAMPLE
  (defvar-keymap hsk/notetaking-map
  :doc "My notetaking keymap"
  ;;...
  "j" hsk/org-journal-map)
#+END_EXAMPLE

è¿™æ · org-journal-new-entry å°±æ˜ å°„åˆ° C-c n j n ä¸Šäº†ï¼Œéå¸¸ä¼˜é›…ã€‚


: (let ((my-keymap (make-sparse-keymap))) ; åˆ›å»ºä¸€ä¸ªç©ºçš„ keymap
:  (keymap-set my-keymap "C-c f" 'find-file)) ; è®¾ç½® C-c f æ¥æ‰§è¡Œ 'find-file å‘½ä»¤
: (keymap-local-set "C-p" ctl-x-map)


*** bind-keys
æ˜¯ç”± use-package å®æä¾›çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸åœ¨ä¸€ä¸ªå£°æ˜ä¸­ç»‘å®šå¤šä¸ª
é”®ã€‚è™½ç„¶bind-keys å¯ä»¥ç‹¬ç«‹äº use-package ä½¿ç”¨ï¼Œä½†å®ƒé€šå¸¸ä¸ use-package
ç»“åˆä½¿ç”¨ï¼Œä»¥æä¾›æ›´æ¸…æ™°å’Œæ¨¡å—åŒ–çš„é”®ç»‘å®šé…ç½®ã€‚
#+begin_src emacs-lisp :tangle suk.el
  (use-package bind-key)
  ;;(bind-key "C-c x" #'some-function some-package-mode-map)
  ;;(bind-key "C-c y" #'another-function)

  ;; (bind-keys
  ;;  ("C-x C-c" . save-buffers-kill-terminal)
  ;;  ("C-x C-f" . find-file)
  ;;  ("C-x C-s" . save-buffer))

  ;; (bind-keys :map python-mode-map
  ;;            ("C-c C-c" . python-shell-send-buffer)
  ;;            ("C-c C-r" . python-shell-send-region))


  ;; Toggle fullscreen <F11> also bind to fullscreen
  (bind-keys ("C-<f11>" . toggle-frame-fullscreen)
             ("C-S-f" . toggle-frame-fullscreen) ; Compatible with macOS
             ("M-S-<return>" . toggle-frame-fullscreen) ; Compatible with Windos
             )
#+end_src

*** Global keys
#+begin_src emacs-lisp :tangle suk.el
  ;; ä¸€å•²æ–¹ä¾¿å˜…å‡½æ•°
  (global-set-key (kbd "C-x M-a") 'align-regexp)  ;; å¿«æ·é”® C-x M-a ç”¨äºå¯¹é½æ­£åˆ™è¡¨è¾¾å¼
  ;;(global-set-key (kbd "C-(") 'backward-sexp)     ;; å¿«æ·é”® C-( ç”¨äºå‘åè·³è·ƒåˆ°ä¸Šä¸€ä¸ª sexp C-M-<left> ESC C-<left>
  ;;(global-set-key (kbd "C-)") 'forward-sexp)      ;; å¿«æ·é”® C-) ç”¨äºå‘å‰è·³è·ƒåˆ°ä¸‹ä¸€ä¸ª sexp C-M-<right> ESC C-<right>
  (global-set-key (kbd "C-x R") 'recentf-open)    ;; å¿«æ·é”® C-x R ç”¨äºæ‰“å¼€æœ€è¿‘æ–‡ä»¶
  (global-set-key (kbd "<escape>") 'keyboard-escape-quit)

  (when emacs/>=29p
    ;; (keymap-global-set <key> <cmmd>)
    (keymap-set global-map "C-<f11>" #'toggle-frame-fullscreen)       ;; å¿«æ·é”® C-<f11> ç”¨äºåˆ‡æ¢å…¨å±æ¨¡å¼
    (keymap-set global-map "M-s-<return>" #'toggle-frame-fullscreen)  ;; å¿«æ·é”® M-S-<return> ä¹Ÿç”¨äºåˆ‡æ¢å…¨å±æ¨¡å¼
    (keymap-set global-map "RET" #'newline-and-indent)                ;; å›è½¦é”® RET ç”¨äºåˆ›å»ºæ–°è¡Œå¹¶å¯¹é½
    (keymap-set global-map "S-<return>" #'comment-indent-new-line)    ;; Shift + å›è½¦é”®ç”¨äºå–æ¶ˆå¯¹é½åˆ›å»ºçš„æ–°è¡Œ
    ) 
  (unless emacs/>=29p
    (global-set-key (kbd "C-<f11>") 'toggle-frame-fullscreen)      ;; å¿«æ·é”® C-<f11> ç”¨äºåˆ‡æ¢å…¨å±æ¨¡å¼
    (global-set-key (kbd "M-s<return>") 'toggle-frame-fullscreen)
    (global-set-key (kbd "RET") #'newline-and-indent)              ;; å›è½¦é”® RET ç”¨äºåˆ›å»ºæ–°è¡Œå¹¶å¯¹é½
    (global-set-key (kbd "S-<return>") #'comment-indent-new-line)  ;; Shift + å›è½¦é”®ç”¨äºå–æ¶ˆå¯¹é½åˆ›å»ºçš„æ–°è¡Œ
    )

  (global-set-key  (kbd "C-S-SPC") 'set-mark-command)

  (define-prefix-command 'leader-key)
  (global-set-key (kbd "S-SPC") 'leader-key)
  (keymap-set leader-key "f" #'toggle-frame-fullscreen) ;; full screen
  ;;; ### Toolkit ###
  ;;; --- å·¥å…·å‡½æ•°
  (lazy-load-set-keys
   '(
     ("C-," . bury-buffer)                ;éšè—å½“å‰buffer
     ("C-." . unbury-buffer)              ;åéšè—å½“å‰buffer
     ;; ("s-[" . eval-expression)            ;æ‰§è¡Œè¡¨è¾¾å¼ M-: M-ESC :
     ;;("s-1" . sort-lines)                 ;æ’åº
     ;;("s-<f12>" . calendar)
     ("C-<f12>" . lazycat-theme-toggle)
     ;;([c-t] . transpose-chars)
     ;; ([S-f5] . toggle-truncate-lines) ; C-x x t
     ;; ("C-x M-a" . align-regexp)
     )
   )

  ;; C-c TAB indent-region
  ;; C-u C-c TAB => (un)indent-region

  ;; M-x global-set-key RET äº¤äº’å¼çš„ç»‘å®šä½ çš„é”®ã€‚
  ;; C-x Esc Esc è°ƒå‡ºä¸Šä¸€æ¡â€œå¤æ‚å‘½ä»¤â€

  ;;Emacs è‡ªåŠ¨æ’ç‰ˆ
  ;;å¾ˆç®€å•ï¼šC-x h C-M-\
  ;;å…¶ä¸­C-x h æ˜¯å…¨é€‰
  ;;C-M-\ æ˜¯æ’ç‰ˆ

  ;; C-x C-q set/unset readonly
  ;; å¤§å°å†™è½¬æ¢ï¼š M-u, M-l, M-c

  ;; M-x align-regexp å¯ä»¥æ–¹ä¾¿çš„å¯¹é½ä¸€äº›æ–‡å­—

#+end_src

** Toggles
#+begin_src emacs-lisp :tangle suk.el
  (with-eval-after-load 'pretty-hydra
    ;; Global toggles
    (with-no-warnings
      (pretty-hydra-define+ toggles-hydra (:title (pretty-hydra-title "Toggles" 'faicon "nf-fa-toggle_on") :color amaranth :quit-key ("q" "C-g"))
        ("Basic"
         (("n" (cond ((fboundp 'display-line-numbers-mode)
                      (display-line-numbers-mode (if display-line-numbers-mode -1 1)))
                     ((fboundp 'gblobal-linum-mode)
                      (global-linum-mode (if global-linum-mode -1 1))))
           "line number"
           :toggle (or (bound-and-true-p display-line-numbers-mode)
                       (bound-and-true-p global-linum-mode)))
          ("i" global-aggressive-indent-mode "aggressive indent" :toggle t)
          ("d" global-hungry-delete-mode "hungry delete" :toggle t)
          ("e" electric-pair-mode "electric pair" :toggle t)
          ("c" flyspell-mode "spell check" :toggle t)
          ("s" prettify-symbols-mode "pretty symbol" :toggle t)
          ("l" global-page-break-lines-mode "page break lines" :toggle t)
          ("B" display-battery-mode "battery" :toggle t)
          ("T" display-time-mode "time" :toggle t)
          ("a" abbrev-mode "abrev" :toggle t)
          ("F" auto-fill-mode "auto fill" :toggle t)
          ("m" doom-modeline-mode "modern mode-line" :toggle t)
          ("t" toggle-truncate-lines "truncate lines" :toggle t)
          ("u" toggle-company-ispell "Company Ispell" :toggle t))
         "Highlight"
         (("h l" global-hl-line-mode "line" :toggle t)
          ("h p" show-paren-mode "paren" :toggle t)
          ("h s" symbol-overlay-mode "symbol" :toggle t)
          ("h r" rainbow-mode "rainbow" :toggle t)
          ("h w" (setq-default show-trailing-whitespace (not show-trailing-whitespace))
           "whitespace" :toggle show-trailing-whitespace)
          ("h d" rainbow-delimiters-mode "delimiter" :toggle t)
          ("h i" highlight-indent-guides-mode "indent" :toggle t)
          ("h t" global-hl-todo-mode "todo" :toggle t))
         "Program"
         (("f" flymake-mode "flymake" :toggle t)
          ("O" hs-minor-mode "hideshow" :toggle t)
          ("U" subword-mode "subword" :toggle t)
          ("w" whitespace-mode "whitespace" :toggle t)
          ("W" which-function-mode "which function" :toggle t)
          ("E" toggle-debug-on-error "debug on error" :toggle (default-value 'debug-on-error))
          ("Q" toggle-debug-on-quit "debug on quit" :toggle (default-value 'debug-on-quit))
          ("v" global-diff-hl-mode "gutter" :toggle t)
          ("V" diff-hql-flydiff-mode "live gutter" :toggle t)
          ("M" diff-hl-margin-mode "margin gutter" :toggle t)
          ("D" diff-hl-dired-mode "dired gutter" :toggle t))
         ))
      ;; (keymap-global-set "C-x M-t"  #'toggles-hydra/body)
      (keymap-set leader-key "t" #'toggles-hydra/body)
  ))

#+end_src
** Move cursor

#+begin_src emacs-lisp :tangle suk.el
    ;;; ### goto-line-preview ###
  (lazy-load-global-keys
   '(
     ("M-g p" . goto-line-preview))
   "goto-line-preview")

     ;;; ### basic-toolkit ###
    (lazy-load-global-keys
   '(
     ("M-G" . goto-column)                ;åˆ°æŒ‡å®šåˆ—
     ("s-g" . goto-percent)               ;è·³è½¬åˆ°å½“å‰Bufferçš„æ–‡æœ¬ç™¾åˆ†æ¯”, å•ä½ä¸ºå­—ç¬¦
     )
   "basic-toolkit")

  (lazy-load-global-keys
   '(
     ("C-x r ,"   . remember-init)      ;è®°å¿†åˆå§‹å‡½æ•°
     ("C-x r ."   . remember-jump)      ;è®°å¿†è·³è½¬å‡½æ•°
     ("C-x r <" . point-stack-pop)    ;bufferç´¢å¼•è·³è½¬
     ("C-x r >" . point-stack-push)   ;bufferç´¢å¼•æ ‡è®°
     )
   "my-bookmak")

  ;;; --- æ»šåŠ¨å…¶ä»–çª—å£

  ;; ä¸‹é¢è¿™ä¸¤ä¸ªé”®æ¨¡æ‹ŸViçš„å…‰æ ‡ä¸åŠ¨å±å¹•åŠ¨æ•ˆæœ, æˆ‘å¾ˆå–œæ¬¢, å‡ ä¹æ€»åœ¨ä½¿ç”¨.
  ;;(global-set-key [(meta N)] 'window-move-up)        
  ;;(global-set-key [(meta P)] 'window-move-DOWN)

  ;; åŒä¸Š, ä½†æ˜¯æ˜¯å¦ä¸€ä¸ªbufferçª—å£ä¸Šä¸‹ç§»åŠ¨. å¸¸å¸¸æŸ¥çœ‹å¸®åŠ©ç”¨è¿™ä¸ª.
  ;;(global-set-key [(control N)] 'other-window-move-up)
  ;;(global-set-key [(control P)] 'other-window-move-down) 
  (lazy-load-global-keys
   '(
     ("M-N" . other-window-move-up)   ;å‘ä¸‹æ»šåŠ¨å…¶ä»–çª—å£  scroll-other-window-up
     ("M-P" . other-window-move-down) ;å‘ä¸Šæ»šåŠ¨å…¶ä»–çª—å£  scroll-other-window-down
     ("M-n" . window-move-up)         ;å‘ä¸‹æ»šåŠ¨å½“å‰çª—å£  scroll-up
     ("M-p" . window-move-down)       ;å‘ä¸Šæ»šåŠ¨å½“å‰çª—å£  scroll-down
     )
   "win-move")

  ;; Jump to Chinese characters
  (run-with-idle-timer
   1
   nil
   #'(lambda()     
       (use-package ace-pinyin
         :diminish
         :hook (after-init . ace-pinyin-global-mode))
       (require 'goto-chg)
       ))


#+end_src
** Move text
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;; ### move text ###
  (lazy-load-global-keys
   '(
     ("C-S-n" . move-text-down) ;æŠŠå…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œæ–‡å­—(æˆ–æ ‡è®°)ä¸‹ç§»ä¸€è¡Œ
     ("C-S-p" . move-text-up)   ;æŠŠå…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œæ–‡å­—(æˆ–æ ‡è®°)ä¸Šç§»ä¸€è¡Œ
     ("C-S-<down>" . move-text-down)  ;æŠŠå…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œæ–‡å­—(æˆ–æ ‡è®°)ä¸‹ç§»ä¸€è¡Œ
     ("C-S-<up>"   . move-text-up)    ;æŠŠå…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œæ–‡å­—(æˆ–æ ‡è®°)ä¸Šç§»ä¸€è¡Œ
     )
   "move-text")

   ;;; ### move comment ###
  (lazy-load-global-keys
   '(
     ("M-s-n" . comment-part-move-down)   ;å‘ä¸‹ç§»åŠ¨æ³¨é‡Š
     ("M-s-p" . comment-part-move-up)     ;å‘ä¸Šç§»åŠ¨æ³¨é‡Š
     ("C-s-n" . comment-dwim-next-line)   ;ç§»åŠ¨åˆ°ä¸Šä¸€è¡Œå¹¶æ³¨é‡Š
     ("C-s-p" . comment-dwim-prev-line)   ;ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œå¹¶æ³¨é‡Š
     )
   "move-comment")
#+end_src

** Open new line
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;;; ### open new line ###
  (lazy-load-global-keys
   '(
     ("C-o" . open-newline-above) ;åœ¨ä¸Šé¢ä¸€è¡Œæ–°å»ºä¸€è¡Œ
     ("C-l" . open-newline-below) ;åœ¨ä¸‹é¢ä¸€è¡Œæ–°å»ºä¸€è¡Œ
     )
   "open-newline")
#+end_src
** Duplicate line
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;; ### duplicate-line ###
  (lazy-load-global-keys
   '(
     ("C-S-o" . duplicate-line-or-region-above) ;å‘ä¸Šå¤åˆ¶å½“å‰è¡Œæˆ–åŒºåŸŸ
     ("C-S-l" . duplicate-line-or-region-below) ;å‘ä¸‹å¤åˆ¶å½“å‰è¡Œæˆ–åŒºåŸŸ
     ("C-S-s-o" . duplicate-line-above-comment) ;å¤åˆ¶å½“å‰è¡Œåˆ°ä¸Šä¸€è¡Œ, å¹¶æ³¨é‡Šå½“å‰è¡Œ
     ("C-S-s-l" . duplicate-line-below-comment) ;å¤åˆ¶å½“å‰è¡Œåˆ°ä¸‹ä¸€è¡Œ, å¹¶æ³¨é‡Šå½“å‰è¡Œ
     ("C-:" . comment-or-uncomment-region+)     ;æ³¨é‡Šå½“å‰è¡Œ

     )
   "duplicate-line")
#+end_src
** Delete to character
#+begin_src emacs-lisp :tangle etc/init-key.el
;; è‡ªå®šä¹‰åˆ é™¤åˆ°å­—ç¬¦å‡½æ•°
(defun my/delete-to-char (char)
  "åˆ é™¤å…‰æ ‡ä½ç½®åˆ°ä¸‹ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦ CHAR ä¹‹é—´çš„æ‰€æœ‰å†…å®¹ï¼ˆä¸åŒ…æ‹¬ CHAR æœ¬èº«ï¼‰ã€‚"
  (interactive "cDelete to char: ")
  (let ((start (point))
        (end (progn
               (search-forward (char-to-string char) (line-end-position) t))))
    (if end
        (progn
          (goto-char end)
          (delete-region start (- end 1))
          (message "Deleted from %d to %d" start (- end 1)))
      (progn
        (delete-region start (line-end-position))
        (message "Character '%c' not found. Deleted to end of line." char)))))

;; ç»‘å®šå¿«æ·é”® C-c d åˆ° my/delete-to-char å‡½æ•°
(global-set-key (kbd "C-c d") 'my/delete-to-char)
#+end_src
** Insert template
#+begin_src emacs-lisp :tangle suk.el
  ;;;###autoload
  (defun insert-hash-template ()
    "æ’å…¥HASHæ¨¡æ¿ï¼š
  #=================================================
  # <cursor>
  #-------------------------------------------------
  å…‰æ ‡ä½äºç¬¬äºŒè¡Œçš„ # åé¢ã€‚"
    (interactive)
    (beginning-of-line) 
    (insert "#=================================================\n")
    (insert "# \n")
    (insert "#-------------------------------------------------\n")
    ;; å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œçš„ # åé¢
    (forward-line -2)          ; ç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ˆå³ç¬¬äºŒè¡Œï¼‰
    (end-of-line)              ; ç§»åŠ¨åˆ°è¡Œå°¾

    )

  ;;;###autoload
  (defun insert-slash-template ()
    "æ’å…¥Slash commentæ¨¡æ¿ï¼š
  #=================================================
  # <cursor>
  #-------------------------------------------------
  å…‰æ ‡ä½äºç¬¬äºŒè¡Œçš„ // åé¢ã€‚"
    (interactive)
    (beginning-of-line) 
    (insert "//=================================================\n")
    (insert "// \n")
    (insert "//-------------------------------------------------\n")
    ;; å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œçš„ # åé¢
    (forward-line -2)          ; ç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ˆå³ç¬¬äºŒè¡Œï¼‰
    (end-of-line)              ; ç§»åŠ¨åˆ°è¡Œå°¾
    )


  ;;;###autoload
  (defun insert-star-template ()
    "æ’å…¥Slash commentæ¨¡æ¿ï¼š
  #=================================================
  # <cursor>
  #-------------------------------------------------
  å…‰æ ‡ä½äºç¬¬äºŒè¡Œçš„ # åé¢ã€‚"
    (interactive)
    (beginning-of-line) 
    (insert "/*=================================================*/\n")
    (insert "/*  */\n")
    (insert "/*-------------------------------------------------*/\n")
    (forward-line -2)         
    (end-of-line)          
    (backward-char 3)      
    )

  ;;;###autoload
  (defun insert-javadoc-template ()
    "æ’å…¥Javadocæ¨¡æ¿ï¼š
  #=================================================
  # <cursor>
  #-------------------------------------------------
  å…‰æ ‡ä½äºç¬¬äºŒè¡Œçš„ * åé¢ã€‚"
    (interactive)
    (beginning-of-line) 
    (insert "/**\n")
    (insert " * \n")
    (insert " */\n")
    (forward-line -2)       
    (end-of-line)         
    )

  ;; ç»‘å®šå¿«æ·é”® C-c t åˆ°æ’å…¥è‡ªå®šä¹‰æ¨¡æ¿çš„å‡½æ•°
  (global-set-key (kbd "C-c t h") 'insert-hash-template)
  (global-set-key (kbd "C-c t c") 'insert-slash-template)
  (global-set-key (kbd "C-c t s") 'insert-star-template)
  (global-set-key (kbd "C-c t j") 'insert-javadoc-template)

#+end_src

** Word Styles
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;; ### String Inflection ###
  ;; --- å•è¯è¯­æ³•é£æ ¼å¿«é€Ÿè½¬æ¢
  (lazy-load-global-keys
   '(
     ("C-c C-u" . string-inflection-hydra/body)
     )
   "init-string-inflection")
   ;;; ### basic-toolkit ###
  (lazy-load-global-keys
   '(
     ("M-l" . downcase-char)
     ("M-u" . upcase-char)
     )
   "cases")
#+end_src
** Thing Edit
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;;; ### Thing-edit ###
  ;;; --- å¢å¼ºå¼ç¼–è¾‘å½“å‰å…‰æ ‡çš„å¯¹è±¡ 
  (lazy-load-global-keys
   '(
     ;; ("C-c w" . thing-copy-word)
     ;; ("C-c s" . thing-copy-symbol)
     ;; ("C-c m" . thing-copy-email)
     ;; ("C-c f" . thing-copy-filename)
     ;; ("C-c u" . thing-copy-url)
     ;; ("C-c x" . thing-copy-sexp)
     ;; ("C-c g" . thing-copy-page)
     ;; ("C-c t" . thing-copy-sentence)
     ;; ("C-c o" . thing-copy-witespace)
     ;; ("C-c i" . thing-copy-list)
     ;; ("C-c c" . thing-copy-comment)
     ;; ("C-c h" . thing-copy-defun)
     ;; ("C-c p" . thing-copy-parentheses)
     ;; ("C-c l" . thing-copy-line)
     ;; ("C-c a" . thing-copy-to-line-begining)
     ;; ("C-c e" . thing-copy-to-line-end)

     ;; ("C-c W" . thing-cut-word)
     ;; ("C-c S" . thing-cut-symbol)
     ;; ("C-c M" . thing-cut-email)
     ;; ("C-c F" . thing-cut-filename)
     ;; ("C-c G" . thing-cut-page)
     ;; ("C-c T" . thing-cut-sentence)
     ;; ("C-c O" . thing-cut-whitespace)
     ;; ("C-c I" . thing-cut-list)
     ;; ("C-c C" . thing-cut-comment)
     ;; ("C-c H" . thing-cut-defun)
     ;; ("C-c P" . thing-cut-parentheses)
     ;; ("C-c L" . thing-cut-line)
     ;; ("C-c A" . thing-cut-to-line-beginning)
     ;; ("C-c E" . thing-cut-to-line-end)

     ("C-c e" . hydra-thing-edit/body)
     )
   "init-thing-edit"
   )


#+end_src

** Buffer Edit
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;; ### Buffer Edit ### 
  ;; --- ç¼“å­˜ç¼–è¾‘
  (lazy-load-set-keys
   '(
     ("C-x C-x" . exchange-point-and-mark)   ;äº¤æ¢å½“å‰ç‚¹å’Œæ ‡è®°ç‚¹
     ("M-o" . backward-delete-char-untabify) ;å‘å‰åˆ é™¤å­—ç¬¦
     ("C-M-S-h" . mark-paragraph)            ;é€‰ä¸­æ®µè½
     ("M-SPC" . just-one-space)              ;åªæœ‰ä¸€ä¸ªç©ºæ ¼åœ¨å…‰æ ‡å¤„
     ))
  ;;; ### basic-toolkit ###
  (lazy-load-global-keys
   '(
     ;;("M-2" . indent-buffer)              ;è‡ªåŠ¨æ ¼å¼åŒ–å½“å‰Buffer
     ;; indent-comment-buffer
     ;;("C-x u" . mark-line)              ;é€‰ä¸­æ•´è¡Œ
     ("s-k" . kill-and-join-forward)      ;åœ¨ç¼©è¿›çš„è¡Œä¹‹é—´åˆ é™¤
     ;;("" . strip-blank-lines)             ; åˆ é™¤ç©ºè¡Œ
     ;; strip-line-number
     ;; delete-chars-hungry-forward
     ;; delete-chars-hungry-backward
     ;; underline-line-with
     ;; current-line-move-to-top
     ("<f2>" . refresh-file)              ;è‡ªåŠ¨åˆ·æ–°æ–‡ä»¶
     ("C-S-j" . join-lines)               ;è¿æ¥ä¸‹è¡Œ
     ("M-q" . suk/fill-or-unfill-paragraph)
     ("C-x n N" . suk/xah-narrow-to-region)
     )
   "basic-toolkit")
#+end_src


** Insert translated name
#+begin_src emacs-lisp :tangle suk-unload.el
  ;;; ### Insert translated name ###
  ;; youdao / google
  (setq insert-translated-name-translate-engine "google")
  (lazy-load-global-keys
   '(
     ("," . insert-translated-name-insert-with-underline)
     ("." . insert-translated-name-insert-with-camel)
     ("/" . insert-translated-name-insert)
     )
   "insert-translated-name"
   "C-z"
   )
#+end_src
** Description Keys
=F1 + {f/k/d/i/k}= æˆ–è€…  =C-h {f/k/d/i}= å¯ä»¥æ‰“å¼€ç›¸å…³å¸®åŠ©
Use ~C-c C-h~ to open the description menu 

#+begin_src emacs-lisp :tangle suk.el

  ;;;###autoload
  (with-eval-after-load 'hydra
    (defhydra my-hydra-describe (:color blue :hint nil)
      "
  Describe Something: (q to quit)
  _a_ all help for everything screen
  _b_ bindings
  _c_ char
  _C_ coding system
  _f_ function
  _i_ input method
  _k_ key briefly
  _K_ key
  _l_ language environment
  _m_ major mode
  _M_ minor mode
  _n_ current coding system briefly
  _N_ current coding system full
  _o_ lighter indicator
  _O_ lighter symbol
  _p_ package
  _P_ text properties
  _s_ symbol
  _t_ theme
  _v_ variable
  _w_ where is something defined
  "
      ("b" describe-bindings)
      ("C" describe-categories)
      ("c" describe-char)
      ("C" describe-coding-system)
      ("f" describe-function)
      ("i" describe-input-method)
      ("K" describe-key)
      ("k" describe-key-briefly)
      ("l" describe-language-environment)
      ("M" describe-minor-mode)
      ("m" describe-mode)
      ("N" describe-current-coding-system)
      ("n" describe-current-coding-system-briefly)
      ("o" describe-minor-mode-from-indicator)
      ("O" describe-minor-mode-from-symbol)
      ("p" describe-package)
      ("P" describe-text-properties)
      ("q" nil)
      ("a" help)
      ("s" describe-symbol)
      ("t" describe-theme)
      ("v" describe-variable)
      ("w" where-is))
    (global-set-key (kbd "C-c C-h") 'my-hydra-describe/body))
#+end_src
** Rectangle
è®°å½•ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•
- =C-x r k=  Kill the text of the region-rectangle, saving its contents as the last killed rectangle (kill-rectangle).
- =C-x r M-w= Save the text of the region-rectangle as the last killed rectangle (copy-rectangle-as-kill).
- =C-x r d= Delete the text of the region-rectangle (delete-rectangle).
- =C-x r y= Yank the last killed rectangle with its upper left corner at point (yank-rectangle).
- =C-x r o= Insert blank space to fill the space of the region-rectangle (open-rectangle). This pushes the previous contents of the region-rectangle to the right.
- =C-x r N= Insert line numbers along the left edge of the region-rectangle (rectangle-number-lines). This pushes the previous contents of the region-rectangle to the right.
- =C-x r c= Clear the region-rectangle by replacing all of its contents with spaces (clear-rectangle).
- =M-x delete-whitespace-rectangle= Delete whitespace in each of the lines on the specified rectangle, starting from the left edge column of the rectangle.
- =C-x r t string <RET>=  Replace rectangle contents with string on each line (string-rectangle).
-  =M-x string-insert-rectangle <RET> string <RET>= Insert string on each line of the rectangle.
-  =C-x <SPC>= Toggle Rectangle Mark mode (rectangle-mark-mode). When
  this mode is active, the region-rectangle is highlighted and can be
  shrunk/grown, and the standard kill and yank commands operate on it.
  The rectangle operations fall into two classes: commands to erase or
  insert rectangles, and comm
#+begin_src emacs-lisp :tangle suk.el
   ;;; Rectangle
  (lazy-load-global-keys
   '(
   
     ("r" . hydra-rectangle/body)
     )
   "init-rectangle"
   "C-z"
   )
#+end_src
** Expand region
#+begin_src emacs-lisp :tangle suk.el
  ;; expand-region
  (run-with-idle-timer
   2 nil
   #'(lambda()
       ;; (use-package expand-region ; I prefer stable version
       ;;    :load-path "~/.emacs.d/extensions/expand-region"
       ;; )
       (with-eval-after-load 'expand-region
          (defun treesit-mark-bigger-node ()
             "Use tree-sitter to mark regions."
             (let* ((root (treesit-buffer-root-node))
                    (node (treesit-node-descendant-for-range root (region-beginning) (region-end)))
                    (node-start (treesit-node-start node))
                    (node-end (treesit-node-end node)))
               ;; Node fits the region exactly. Try its parent node instead.
               (when (and (= (region-beginning) node-start) (= (region-end) node-end))
                 (when-let ((node (treesit-node-parent node)))
                   (setq node-start (treesit-node-start node)
                         node-end (treesit-node-end node))))
               (set-mark node-end)
               (goto-char node-start)))
          )))

#+end_src
Add shortcut.
#+begin_src emacs-lisp :tangle etc/init-key.el
 (lazy-load-global-keys
        '(("M-=" . er/expand-region)
          ("M--" . er/contract-region)
          )
        "expand-region")
#+end_src
** Undo
#+begin_src emacs-lisp :tangle suk.el
  ;; Treat undo history as a tree, ^x u
  (run-with-idle-timer
   2 nil
   #'(lambda()
         (if emacs/>=28p
             (progn
               ;; vundo :load-path "~/.emacs.d/extensions/vundo"
               ;; (requir 'vundo)
               (with-eval-after-load 'vundo
                 (setq vundo-glyph-alist vundo-unicode-symbols)))
           (progn
             (setq undo-tree-visualizer-timestamps t
                   undo-tree-visualizer-diff t
                   undo-tree-enable-undo-in-region nil
                   undo-tree-auto-save-history nil)
             ;; HACK: keep the diff window
             (with-no-warnings
               (make-variable-buffer-local 'undo-tree-visualizer-diff)
               (setq-default undo-tree-visualizer-diff t))
             (with-eval-after-load 'undo-tree
               (add-hook 'after-init-hook #'global-undo-tree-mode))
             ))
         ))
#+end_src
Add shortcuts.
#+begin_src emacs-lisp :tangle etc/init-key.el
  (if emacs/>=28p
      (lazy-load-global-keys
       '(("C-x u" . vundo)
         ("C-/" . vundo)
         )
       "vundo")
    (lazy-load-global-keys
     '(("C-x u" . undo-trees)
       ("C-/"   . undo-tree-undo)
       ("C-?  " . undo-tree-redo)
       )
     "undo-tree")
    )
#+end_src
** Yank
#+begin_src emacs-lisp :tangle suk.el
  ;;; ### Advice ###
  ;;; --- å„ç§emacsè¡Œä¸ºå»ºè®®
  ;; åœ¨ç‰¹å®šåœ°æ¨¡å¼ä¸‹ç²˜è´´æ—¶è‡ªåŠ¨ç¼©è¿›
  (defadvice yank (after indent-region activate)
    "To make yank content indent automatically."
    (if (member major-mode
                '(emacs-lisp-mode
                  java-mode
                  web-mode
                  c-mode
                  c++-mode
                  js-mode
                  latex-mode
                  plain-tex-mode))
        (indent-region (region-beginning) (region-end) nil)))
#+end_src
** Macros
è®°å½•ä¸€ä¸‹ä½¿ç”¨æ–¹å¼

  - =f3= start macro(~kmacro-start-macro-or-insert-counter~),
  - =f4= done macro or run marcro (~kmacro-end-or-call-macro~).
  - =C-x (= start macro (~kmacro-start-macro~),
  - =C-x )= end done marco(~kmacro-end-macro~),
  - =C-x e= ~run marco(kmacro-end-macro)~
  - =C-x C-k r= ~apply-macro-to-region-lines~
  - =C-x C-k C-n= ~kmacro-cycle-ring-next~               ;ä¸‹ä¸€ä¸ªé”®ç›˜å®
  - =C-x C-k C-p= ~kmacro-cycle-ring-previous~      ;ä¸Šä¸€ä¸ªé”®ç›˜å®
  - =C-x C-k RET=  ~kmacro-edit-macro~                          ;ç¼–è¾‘é”®ç›˜å®
  - ~insert-kbd-macro~
  - =C-x C-k n=  ~name-last-kbd-macro~ is an alias for ~kmacro-name-last-macro~
  - =C-x C-k C-d=  ~kmacro-delete-ring-head~

  å…ˆå®šä¹‰ä¸€ä¸ªå®

  ç„¶å ~name-last-kbd-macro~

  ç„¶å ~insert-kbd-macro~

  ç­‰åˆ°å¦‚ä¸‹ç±»ä¼¼çš„é…ç½®
  : (fset 'delete-empty-lines (kbd "M-x flush-lines RET ^\s-*$ RET"))

** Misc packages
#+begin_src emacs-lisp :tangle suk.el
  (run-with-idle-timer
   2 nil
   #'(lambda()
       (use-package paredit) ;; useful for lisp
       (use-package wgrep) ;; eidt the grep / rg result then apply to the origin buffer. Cancel is supportted.
       (use-package writeroom-mode)
       ))

#+end_src
** Misc
#+begin_src emacs-lisp :tangle suk.el
#+end_src


* ç¼“å­˜åŒº Buffer
** å®‰è£…æ’ä»¶
#+begin_src emacs-lisp :tangle suk.el
  (require-package 'buffer-move)
#+end_src
** ä½¿ç”¨ ibuffer.
#+begin_src emacs-lisp :tangle suk.el

  (use-package ibuffer
    :ensure nil
    :bind ("C-x C-b" . ibuffer)
    :init (setq ibuffer-filter-group-name-face '(:inherit (font-lock-string-face bold))))
  ;;(global-set-key (kbd "C-x C-b") 'ibuffer)

  (with-eval-after-load 'ibuffer
    ;; Display icons for buffers
    (when (display-graphic-p)
      (use-package nerd-icons-ibuffer
        :hook (ibuffer-mode . nerd-icons-ibuffer-mode)
        :init (setq nerd-icons-ibuffer-icon suk-icon)))
    )
#+end_src
** æŒä¹…åŒ–  scratch ç¼“å­˜åŒº
å””æ¬²å­˜æ­¤ä¸´æ—¶ç¼“å†²åŒºï¼Œå’å¯å†ç»­å‰ç¼˜ã€‚
#+begin_src emacs-lisp :tangle suk.el
  ;; Persistent the scratch buffer
  (run-with-idle-timer
   10 nil
   #'(lambda()
       (use-package persistent-scratch
         :diminish
         :bind (:map persistent-scratch-mode-map
                     ([remap kill-buffer] . (lambda (&rest _)
                                              (interactive)
                                              (user-error "Scratch buffer cannot be killed")))
                     ([remap revert-buffer] . persistent-scratch-restore)
                     ([remap revert-this-buffer] . persistent-scratch-restore))
         :hook ((after-init . persistent-scratch-autosave-mode)iu
                (lisp-interaction-mode . persistent-scratch-mode))
         :init
         ;; åˆ›å»º var æ–‡ä»¶å¤¹
         (make-directory (expand-file-name "var" user-emacs-directory) t)

         (setq persistent-scratch-backup-file-name-format "%Y-%m-%d"
               persistent-scratch-backup-directory (expand-file-name "var/persistent-scratch" user-emacs-directory)
               persistent-scratch-save-file (expand-file-name "var/.persistent-scratch" user-emacs-directory))
         (persistent-scratch-setup-default)

         )))

#+end_src
*** Buffer shortcuts.
#+begin_src emacs-lisp :tangle etc/init-key.el
   (lazy-load-global-keys
   '(
     ("C-c b"  . my-hydra-buffers/body)
     ("M-<f7>" . suk-read-mode)
     ("<f7>"   . olivetti-mode)
     ("C-;"    . suk/close-current-buffer) ;å…³é—­å½“å‰buffer
     )
   "buffer-extension")

  ;; (lazy-load-global-keys
  ;;  '(
  ;;     ("<f7>" . olivetti-mode)
  ;;   )
  ;;  "olivetti")

  ;; default keys: C-x LEFT/RIGHT C-, C-.

#+end_src
*** Buffer Move
#+begin_src emacs-lisp :tangle etc/init-key.el

  ;; --- ç¼“å­˜ç§»åŠ¨
  (lazy-load-set-keys
   '(
     ;;("C-z i" . beginning-of-buffer)      ;ç¼“å­˜å¼€å§‹ M-<
     ;;("C-z k" . end-of-buffer)            ;ç¼“å­˜ç»“å°¾ M->
     ("C-M-f" . forward-paragraph)        ;ä¸‹ä¸€ä¸ªæ®µè½
     ("C-M-b" . backward-paragraph)       ;ä¸Šä¸€ä¸ªæ®µè½
     ("C-M-y" . backward-up-list)         ;å‘å·¦è·³å‡º LIST
     ("C-M-o" . up-list)                  ;å‘å³è·³å‡º LIST
     ("C-M-u" . backward-down-list)       ;å‘å·¦è·³è¿› LIST
     ("C-M-i" . down-list)                ;å‘å³è·³è¿› LIST
     ("C-M-a" . beginning-of-defun)       ;å‡½æ•°å¼€å¤´
     ("C-M-e" . end-of-defun)             ;å‡½æ•°æœ«å°¾
     ))
#+end_src
*** Buffer autorevert
#+begin_src emacs-lisp :tangle suk.el
  ;; Automatically reload files was modified by external program
  (run-with-idle-timer
   1 nil
   #'(lambda()
       (require-package 'autorevert)
       (use-package autorevert
         :ensure nil
         :diminish
         :defer 2
         :hook (after-init . global-auto-revert-mode))))
#+end_src
*** Auto Save
#+begin_src emacs-lisp :tangle suk.el
  (require 'auto-save)
  (auto-save-enable)
  (setq auto-save-silent t)
  ;;(setq auto-save-delete-trailing-whitespace t)
#+end_src
*** vdiff
#+begin_src emacs-lisp :tangle suk.el
  ;; ### vdiff ###
  (lazy-load-global-keys
   '(
     ("M-s-u" . vdiff-buffers))
   "vdiff")
#+end_src
** ç§»ç¼“å­˜åŒºä¹‹ä»–çª—å£
#+begin_src emacs-lisp :tangle etc/init-key.el
  (lazy-load-global-keys
   '(
     ("C-c C-<up>"    . buf-move-up)   
     ("C-c C-<down>"  . buf-move-down)
     ("C-c C-<left>"  . buf-move-left)  
     ("C-c C-<right>" . buf-move-right)   
     )
   "buffer-move")
#+end_src
** å¿«åˆ‡ç¼“å†²åŒº
#+begin_src emacs-lisp :tangle suk.el
  ;; Toggle two most recent buffers
  (fset 'quick-switch-buffer [?\C-x ?b return])
  (global-set-key (kbd "s-b") 'quick-switch-buffer)
  (global-set-key (kbd "C-z b") 'quick-switch-buffer)
#+end_src
* çª—å£ç®¡ç†
** å®‰è£…æ’ä»¶
#+begin_src emacs-lisp :tangle install.el
  (require-package 'transwin)
  (require-package 'ace-window)
  (require-package 'popper)
#+end_src

** é€æ˜çª—å£ Transwin
#+begin_src emacs-lisp :tangle suk.el
  ;; Frame transparence
  (lazy-load-global-keys
   '(
     ("C-M-9" . transwin-inc)
     ("C-M-8" . transwin-dec)
     ("C-M-7" . transwin-toggle)
     )
   "transwin"
  )

  (with-eval-after-load 'transwin
    (setq transwin-parameter-alpha 'alpha-background))

#+end_src
** çª—å£å¸ƒå±€å…ˆç”Ÿ Winner
æ¢å¤ä¸Šä¸€ä¸ªçª—å£å¸ƒå±€ï¼š =C-c <Left>=
å›åˆ°ä¸‹ä¸€ä¸ªçª—å£å¸ƒå±€ï¼š =C-c <Right>=

#+begin_src emacs-lisp :tangle suk.el
  ;; Restore old window configurations
  (use-package winner
    :ensure nil
    :commands (winner-undo winner-redo) ;; C-c <Left>/C-c <Right>
    :hook (after-init . winner-mode)
    :init (setq winner-boring-buffers '("*Completions*"
                                        "*Compile-Log*"
                                        "*inferior-lisp*"
                                        "*Fuzzy Completions*"
                                        "*Apropos*"
                                        "*Help*"
                                        "*cvs*"
                                        "*Buffer List*"
                                        "*Ibuffer*"
                                        "*esh command on file*"))
    )
#+end_src
** çª—å£èˆè€… Ace-window
#+begin_src emacs-lisp :tangle suk.el
  ;; Quickly switch windows

  (use-package ace-window
    :bind (([remap other-window] . ace-window)
           (:map leader-key ("w" . ace-window-hydra/body)))
    :hook (emacs-startup . ace-window-display-mode)
    :config
    (defun toggle-window-split ()
      (interactive)
      (if (= (count-windows) 2)
          (let* ((this-win-buffer (window-buffer))
                 (next-win-buffer (window-buffer (next-window)))
                 (this-win-edges (window-edges (selected-window)))
                 (next-win-edges (window-edges (next-window)))
                 (this-win-2nd (not (and (<= (car this-win-edges)
                                             (car next-win-edges))
                                         (<= (cadr this-win-edges)
                                             (cadr next-win-edges)))))
                 (splitter
                  (if (= (car this-win-edges)
                         (car (window-edges (next-window))))
                      'split-window-horizontally
                    'split-window-vertically)))
            (delete-other-windows)
            (let ((first-win (selected-window)))
              (funcall splitter)
              (if this-win-2nd (other-window 1))
              (set-window-buffer (selected-window) this-win-buffer)
              (set-window-buffer (next-window) next-win-buffer)
              (select-window first-win)
              (if this-win-2nd (other-window 1))))
        (user-error "`toggle-window-split' only supports two windows")))

    ;; Bind hydra to dispatch list
    (add-to-list 'aw-dispatch-alist '(?w ace-window-hydra/body) t)

    ;; Select widnow via `M-1'...`M-9'
    (defun aw--select-window (number)
      "Slecet the specified window."
      (when (numberp number)
        (let ((found nil))
          (dolist (win (aw-window-list))
            (when (and (window-live-p win)
                       (eq number
                           (string-to-number
                            (window-parameter win 'ace-window-path))))
              (setq found t)
              (aw-switch-to-window win)))
          (unless found
            (message "No specified window: %d" number)))))
    (dotimes (n 9)
      (bind-key (format "M-%d" (1+ n))
                (lambda ()
                  (interactive)
                  (aw--select-window (1+ n))))))

#+end_src
** Enforce rules for popups
#+begin_src emacs-lisp :tangle suk.el
  ;; Enforce rules for popups
  (use-package popper
    :custom
    (popper-group-function #'popper-group-by-directory)
    (popper-echo-dispatch-actions t)
    :bind (:map popper-mode-map
                ("C-h z"       . popper-toggle)
                ("C-<tab>"     . popper-cycle)
                ("C-M-<tab>"   . popper-toggle-type))
    :hook (emacs-startup . popper-echo-mode)
    :init
    (setq popper-reference-buffers
          '("\\*Messages\\*$"
            "Output\\*$" "\\*Pp Eval Output\\*$"
            "^\\*eldoc.*\\*$"
            "\\*Compile-Log\\*$"
            "\\*Completions\\*$"
            "\\*Warnings\\*$"
            "\\*Async Shell Command\\*$"
            "\\*Apropos\\*$"
            "\\*Backtrace\\*$"
            "\\*Calendar\\*$"
            "\\*Fd\\*$" "\\*Find\\*$" "\\*Finder\\*$"
            "\\*Kill Ring\\*$"
            "\\*Embark \\(Collect\\|Live\\):.*\\*$"

            bookmark-bmenu-mode
            comint-mode
            compilation-mode
            help-mode helpful-mode
            tabulated-list-mode
            Buffer-menu-mode

            flymake-diagnostics-buffer-mode
            flycheck-error-list-mode flycheck-verify-mode

            gnus-article-mode devdocs-mode
            grep-mode occur-mode rg-mode deadgrep-mode ag-mode pt-mode
            youdao-dictionary-mode osx-dictionary-mode fanyi-mode

            "^\\*Process List\\*$" process-menu-mode
            list-environment-mode cargo-process-mode

            "^\\*.*eshell.*\\*.*$"
            "^\\*.*shell.*\\*.*$"
            "^\\*.*terminal.*\\*.*$"
            "^\\*.*vterm[inal]*.*\\*.*$"

            "\\*DAP Templates\\*$" dap-server-log-mode
            "\\*ELP Profiling Restuls\\*" profiler-report-mode
            "\\*Paradox Report\\*$" "\\*package update results\\*$" "\\*Package-Lint\\*$"
            "\\*[Wo]*Man.*\\*$"
            "\\*ert\\*$" overseer-buffer-mode
            "\\*gud-debug\\*$"
            "\\*lsp-help\\*$" "\\*lsp session\\*$"
            "\\*quickrun\\*$"
            "\\*tldr\\*$"
            "\\*vc-.*\\**"
            "\\*diff-hl\\**"
            "^\\*macro expansion\\**"

            "\\*Agenda Commands\\*" "\\*Org Select\\*" "\\*Capture\\*" "^CAPTURE-.*\\.org*"
            "\\*Gofmt Errors\\*$" "\\*Go Test\\*$" godoc-mode
            "\\*docker-.+\\*"
            "\\*prolog\\*" inferior-python-mode
            "\\*rustfmt\\*$" rustic-compilation-mode rustic-cargo-clippy-mode
            rustic-cargo-outdated-mode rustic-cargo-run-mode rustic-cargo-test-mode
            ))

    (with-eval-after-load 'doom-modeline
      (setq popper-mode-line
            '(:eval (let ((face (if (doom-modeline--active)
                                    'doom-modeline-emphasis
                                  'doom-modeline)))
                      (if (and (icons-displayable-p)
                               (bound-and-true-p doom-modeline-icon)
                               (bound-and-true-p doom-modeline-mode))
                          (format " %s "
                                  (nerd-icons-octicon "nf-oct-pin" :face face))
                        (propertize " POP " 'face face))))))
    :config
    (with-no-warnings
      (defun my-popper-fit-window-height (win)
        "Determine the height of popup window WIN by fitting it to the buffer's content."
        (fit-window-to-buffer
         win
         (floor (frame-height) 3)
         (floor (frame-height) 3)))
      (setq popper-window-height #'my-popper-fit-window-height)

      (defun popper-close-window-hack (&rest _)
        "Close popper window via `C-g'."
        ;; `C-g' can deactivate region
        (when (and (called-interactively-p 'interactive)
                   (not (region-active-p))
                   popper-open-popup-alist)
          (let ((window (caar popper-open-popup-alist)))
            (when (window-live-p window)
              (delete-window window)))))
      (advice-add #'keyboard-quit :before #'popper-close-window-hack)))


#+end_src
** Menu
#+begin_src emacs-lisp :tangle suk.el
  (suk/wait-for-modules
   (lambda()
     (with-eval-after-load 'pretty-hydra
       (pretty-hydra-define+ ace-window-hydra
         (:title (pretty-hydra-title "Window Management" 'faicon "nf-fa-th")
                 :foreign-keys warn
                 :quit-key ("q" "C-g"))
         ("Actions"
          (;;("TAB" other-window "switch")
           ("x" ace-delete-window "delete")
           ("X" ace-delete-other-windows "delete other" :exit t)
           ("s" ace-swap-window "swap")
           ("a" ace-select-window "select" :exit t)
           ("m" toggle-frame-maximized "maximize" :exit t)
           ("u" toggle-frame-fullscreen "fullscreen" :exit t))
          "Resize"
          (("<left>" shrink-window-horizontally "shrink H")
           ("<right>" enlarge-window-horizontally "enlarge H")
           ("<up>" shrink-window "shrink V")
           ("<down>" enlarge-window "enlarge V")
           ("n" balance-windows "balance"))
          "Split"
          (("r" split-window-right "horizontally")
           ("R" split-window-horizontally-instead "horizontally instead")
           ("v" split-window-below "vertically")
           ("V" split-window-vertically-instead "vertically instead")
           ("t" toggle-window-split "toggle")
           ("o" delete-other-windows "only this"))
          "Zoom"
          (("+" text-scale-increase "in")
           ("=" text-scale-increase "in")
           ("-" text-scale-decrease "out")
           ("0" (text-scale-increase 0) "reset"))
          "Misc"
          (("o" set-frame-font "frame font")
           ("f" make-frame-command "new frame")
           ("d" delete-frame "delete frame")
           ("z" winner-undo "winner undo")
           ("Z" winner-redo "winner redo"))
          )
         )
       (bind-key "w" #'ace-window-hydra/body leader-key)
       ))
   'ace-window
   'winner
   )
#+end_src
** å¿«æ·é”®
#+begin_src emacs-lisp :tangle suk.el

  (lazy-load-global-keys
   '(
     ("C-c V" . delete-other-windows-vertically+)   ;å…³é—­ä¸Šä¸‹çš„å…¶ä»–çª—å£
     ("C-c H" . delete-other-windows-horizontally+) ;å…³é—­å·¦å³çš„å…¶ä»–çª—å£
     ("C-'"   . delete-current-buffer-and-window)   ;å…³é—­å½“å‰buffer, å¹¶å…³é—­çª—å£
     ("C-\""  . delete-current-buffer-window)       ;åˆ é™¤å½“å‰bufferçš„çª—å£
     ("M-s-o" . toggle-one-window)                  ;åˆ‡æ¢ä¸€ä¸ªçª—å£
     ("C-x O" . toggle-window-split)
     )
   "window-extension")
#+end_src
* ä¹¦ç­¾ Bookmark
#+begin_src emacs-lisp :tangle suk.el

  (lazy-load-local-keys
   '(
     ("b" . suk/bookmark-launcher/body)
     )
   leader-key
   "my-bookmark"
   ) ;; æœ‰çš„å‡½æ•°è·Ÿbasic-toolkité‡å¤

  ;; C-x r l to list bookmarks
#+end_src

* æœç´¢

** Setup
#+begin_src emacs-lisp :tangle etc/init-search.el
  (provide 'init-search)
#+end_src
Add to suk.el
#+begin_src emacs-lisp :tangle suk.el
  (require 'init-search)
#+end_src
** äº¤äº’å¼æœç´¢
#+begin_src emacs-lisp :tangle etc/init-search.el

  ;;; ### Isearch ###
  ;;; ---
  (lazy-load-set-keys
   '(
     ("TAB" . isearch-complete)               ;isearchè¡¥å…¨
     ("C-s" . isearch-repeat-forward)         ;é‡å¤å‘å‰æœç´¢, ç¬¬ä¸€æ¬¡å¯ä»¥ç”¨æ¥æœç´¢ä¸Šä¸€æ¬¡çš„å†å²å“Ÿ
     ("C-r" . isearch-repeat-backward)        ;é‡å¤å‘åæœç´¢
     ("C-g" . isearch-abort)                  ;ä¸­æ­¢æœç´¢
     ("C-w" . isearch-yank-word-or-char)      ;ç²˜å¸–å…‰æ ‡åçš„è¯æˆ–å­—ç¬¦ä½œä¸ºæœç´¢å¯¹è±¡
     ("C-y" . isearch-yank-line)              ;ç²˜å¸–å…‰æ ‡åçš„è¡Œä½œä¸ºæœç´¢å¯¹è±¡
     ("M-o" . isearch-delete-char)            ;åˆ é™¤
     ("M-p" . isearch-ring-retreat)           ;æœç´¢å†å²å‘å
     ("M-n" . isearch-ring-adjust)            ;æœç´¢å†å²å‘å‰
     ("M-Y" . isearch-yank-kill)              ;ä» kill ring ä¸­ç²˜å¸–æœ€åä¸€é¡¹åˆ°æœç´¢å¯¹è±¡å
     ("M-h" . isearch-yank-char)              ;ç²˜å¸–å…‰æ ‡åçš„å­—ç¬¦åˆ°æœç´¢å¯¹è±¡
     ("M-e" . isearch-edit-string)            ;ç¼–è¾‘æœç´¢å¯¹è±¡
     ("M-c" . isearch-toggle-case-fold)       ;åˆ‡æ¢å¤§å°å†™
     ("M-r" . isearch-toggle-regexp)          ;åˆ‡æ¢æ­£åˆ™è¡¨è¾¾å¼
     ("M-w" . isearch-toggle-word)            ;åˆ‡æ¢è¯
     ("M->" . isearch-beginning-of-buffer)    ;è·³è½¬åˆ°bufferå¼€å¤´å¹¶é‡æ–°æœç´¢, æœç´¢æœ€å‰é¢ä¸€ä¸ª
     ("M-<" . isearch-end-of-buffer)          ;è·³è½¬åˆ°bufferæœ«å°¾å¹¶é‡æ–°æœç´¢, æœç´¢æœ€åé¢ä¸€ä¸ª
     ("M-%" . isearch-query-replace)          ;æ›¿æ¢
     ("M-d" . isearch-find-duplicate-word)    ;æŸ¥æ‰¾é‡å¤çš„å•è¯
     ("M-z" . isearch-find-duplicate-line)    ;æŸ¥æ‰¾é‡å¤çš„è¡Œ
     ("C-M-%" . isearch-query-replace-regexp) ;æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢
     )
   isearch-mode-map
   )

#+end_src
** Search tools
*** å®‰è£…æ’ä»¶
#+begin_src emacs-lisp :tangle install.el

  ;;(require-package 'git-timemachine)
  (require-package 'exec-path-from-shell)
  (require-package 'findr) ;; a light file search tools.
  (require-package 'find-by-pinyin-dired)
  (require-package 'jump)

  ;; (require-package 'counsel) ; counsel => swiper => ivy
  ;; (require-package 'counsel-bbdb)
  ;; (require-package 'counsel-gtags)
  ;; (require-package 'counsel-css)
  (require-package 'bbdb)


  (require-package 'ivy)
  (require-package 'ivy-posframe)
  (require-package 'find-file-in-project)
  (require-package 'swiper)

  (require-package 'pinyinlib)
  (require-package 'ace-pinyin)
  (require-package 'goto-chg)
  (require-package 'avy)
  (require-package 'avy-zap)

#+end_src
*** ivy
#+begin_src emacs-lisp :tangle etc/init-search.el
  (use-package ivy
   :ensure t
   :diminish (ivy-mode)
   :config
   (ivy-mode 1)
   (setq ivy-use-virtual-buffers t)
   (setq enable-recursive-minibuffers t)
   (setq ivy-count-format "%d/%d ")
   (setq ivy-display-style 'fancy)

   (define-key ivy-minibuffer-map [escape] 'minibuffer-keyboard-quit)
   (setq ivy-re-builders-alist
         '((counsel-rg . ivy--regex-plus)
           (swiper . ivy--regex-plus)
           (swiper-isearch . ivy--regex-plus)
           (t . ivy--regex-ignore-order)))

   (when (display-graphic-p)    
     (use-package ivy-posframe))
   )
#+end_src
*** counsel
#+begin_src emacs-lisp :tangle etc/init-search.el
    (use-package counsel
      :after ivy
      :ensure t
      :bind
      (
       ;; ("M-y" . counsel-yank-pop)
       ;; ("C-x C-f" . counsel-find-file)
       ("M-x" . counsel-M-x)
       :map ivy-minibuffer-map
       ("M-y" . ivy-next-line)))
#+end_src
*** swiper
#+begin_src emacs-lisp :tangle etc/init-search.el

  (use-package swiper
    :bind
    (
     ("C-x M-s" . swiper)
     ("C-s"     . swiper-isearch)
     ("C-r"     . swiper-isearch)
     ("C-c C-r" . ivy-resume)
     )
    :config
    (progn
      ;;(ivy-mode 1)
      (setq ivy-use-virtual-buffers t)
      ;;(setq ivy-display-style 'fancy)
      (define-key read-expression-map (kbd "C-r") 'counsel-expression-history))
    )


#+end_src
*** avy
#+begin_src emacs-lisp :tangle etc/init-search.el
    (lazy-load-global-keys
     ' (("C-:"   . avy-goto-char)
        ("C-M-;" . avy-goto-char-2)
        ("M-g l" . avy-goto-line)
        ("M-g w" . avy-goto-word-1)
        ("M-g W" . avy-goto-word-0))
     "avy")
    (with-eval-after-load 'avy
      (setq avy-all-windows nil
            avy-all-windows-alt t
            avy-background t
            avy-style 'pre)
      (add-hook 'after-init-hook #'avy-setup-default)


      )

    (with-eval-after-load 'avy-zap
      ;; Kill text between the point and the character CHAR
      (lazy-load-global-keys
       '(("M-z" . avy-zap-to-char-dwim)
         ("M-Z" . avy-zap-up-to-char-dwim))
       "avy-zap"
       "C-z")
      )

 
#+end_src
** Grep
#+begin_src emacs-lisp :tangle etc/init-tools.el
  
  ;; Writable `grep' buffer
  (use-package wgrep
    :init
    (setq wgrep-auto-save-buffer t
          wgrep-change-readonly-file t))

  ;; Search tool
  (use-package grep
    :ensure nil
    :autoload grep-apply-setting
    :init
    (when (executable-find "rg")
      (grep-apply-setting
       'grep-command "rg --color=auto --null -nH --no-heading -e ")
      (grep-apply-setting
       'grep-template "rg --color=auto --null --no-heading -g '!*/' -e <R> <D>")
      (grep-apply-setting
       'grep-find-command '("rg --color=auto --null -nH --no-heading -e ''" . 38))
      (grep-apply-setting
       'grep-find-template "rg --color=auto --null -nH --no-heading -e <R> <D>")))


  ;; Fast search tool `ripgrep'
  (use-package rg
    :hook (after-init . rg-enable-default-bindings)
    :bind (:map rg-global-map
                ("c" . rg-dwim-current-dir)
                ("f" . rg-dwim-current-file)
                ("m" . rg-menu))
    :init (setq rg-group-result t
                rg-show-columns t)
    :config
    (cl-pushnew '("tmpl" . "*.tmpl") rg-custom-type-aliases))

#+end_src
** æ˜Ÿé™…è¯‘ç‹å‘½ä»¤è¡Œ
#+begin_src emacs-lisp :tangle achrives-and-examples.el
  ;;; ### Sdcv ###
  ;;; --- æ˜Ÿé™…è¯‘ç‹å‘½ä»¤è¡Œ
  (when  (eq system-type 'gnu/linux)
      (lazy-load-global-keys
       '(("p" . sdcv-search-pointer)           ;å…‰æ ‡å¤„çš„å•è¯, bufferæ˜¾ç¤º
         ("P" . sdcv-search-pointer+)          ;å…‰æ ‡å¤„çš„å•è¯, tooltipæ˜¾ç¤º
         ("i" . sdcv-search-input)             ;è¾“å…¥çš„å•è¯, bufferæ˜¾ç¤º
         (";" . sdcv-search-input+)
         ("y" . my-youdao-dictionary-search-at-point)
         ("Y" . youdao-dictionary-search-at-point)
         ("g" . google-translate-at-point)
         ("G" . google-translate-query-translate)
         ("s" . google-translate-smooth-translate)
         ("f" . fanyi-dwim)
         ("d" . fanyi-dwim2)
         ("h" . fanyi-from-history)
         )
       "init-translate"
       "C-z"))
#+end_src
* Org
** Setup
#+begin_src emacs-lisp :tangle etc/init-org.el
  (provide 'init-org)
#+end_src
Add to suk.el
#+begin_src emacs-lisp :tangle suk.el
  (require 'init-org)
#+end_src

** Base settings
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;(message org-files-directory)
  ;; åˆ›å»º var æ–‡ä»¶å¤¹
  (make-directory (expand-file-name "var" user-emacs-directory) t)

  ;; è®¾ç½® org-persist ç›®å½•
  (setq org-persist-directory (expand-file-name "var/org-persist" user-emacs-directory))
  ;; åˆ›å»ºæ–°çš„ org-persist ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  (unless (file-exists-p org-persist-directory)
    (make-directory org-persist-directory t))
  (require 'org)
  ;; To speed up startup, don't put to init section
  (setq org-modules nil)
  ;;(setq org-startup-indented t)
  (setq org-startup-folded nil)
  (setq org-ellipsis  "... â†’ ")
  (setq org-pretty-entities t)
  (setq org-hide-emphasis-markers t)
  (setq org-hide-leading-stars nil)
  (setq org-blank-before-new-entry '((heading) (plain-list-item . auto)))
  (setq org-insert-heading-respect-content t)
  (setq org-yank-adjusted-subtrees t)
  ;; Use the current window for C-c ' source editing
  (setq org-src-window-setup 'current-window)
  ;; Use the current window for indirect buffer display
  (setq org-indirect-buffer-display 'current-window)
  (add-to-list 'auto-mode-alist '("\\.\\(org\\|org_archive\\)$" . org-mode))

  (setq org-tags-column -80)

  (setq org-catch-invisible-edits 'smart)

  ;; è®¾ç½®æ‰“å¼€æŸç§æ–‡ä»¶ç±»å‹
  (setq org-file-apps
        '((auto-mode . emacs)
          ("\\.mm\\'" . system)
          ("\\.x?html?\\'" . system)
          ("\\.pdf\\'" . system)))

    ;; è¿è¡Œ Org Babel Tangle å‘½ä»¤ï¼š`M-x org-babel-tangle`ã€‚
    ;; ä» org æ–‡ä»¶ä¸­ç”Ÿæˆ el é…ç½®æ–‡ä»¶
    ;; ä¿å­˜ user-emacs-directory(~/.emacs.d/) æ–‡ä»¶ä¸‹çš„ org æ—¶ï¼Œ
    ;; å¯¼å‡ºæ–‡ä»¶ä¸­ elisp ä»£ç åˆ°æ–‡ä»¶ä¸­ã€‚
    (defun suk/org-babel-tangle-config ()
      (when (string-equal (file-name-directory (buffer-file-name))
                          (expand-file-name user-emacs-directory)) ; ~/.emacs.d
        (let ((org-confirm-babel-evaluate nil))
          (org-babel-tangle))))

    (add-hook 'org-mode-hook
              (lambda ()
                (add-hook 'after-save-hook #'suk/org-babel-tangle-config)))


    ;;;###autoload
    (defun suk/load-theme-org()
      (interactive)
      (load-theme 'doom-solarized-light)
      )

    ;;;###autoload
    (defun suk/load-theme-default()
      (interactive)
      (load-theme 'doom-one)
      )
#+end_src
** GTD
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;; GTD
  (setq org-use-fast-todo-selection t)
  ;; ! çš„å«ä¹‰æ˜¯è®°å½•æŸé¡¹æ›´æ”¹ä¸ºçŠ¶æ€çš„æ—¶é—´ã€‚æˆ‘ä¸æŠŠè¿™ä¸ªæ·»åŠ åˆ°å®Œæˆçš„çŠ¶æ€ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å·²
  ;; ç»è¢«è®°å½•äº†ã€‚

  ;; @ ç¬¦å·è¡¨ç¤ºå¸¦ç†ç”±çš„æç¤ºï¼Œæ‰€ä»¥å½“åˆ‡æ¢åˆ° WAITTING æ—¶ï¼ŒOrg æ¨¡å¼ä¼šé—®æˆ‘ä¸ºä»€ä¹ˆï¼Œå¹¶å°†
  ;; è¿™ä¸ªæ·»åŠ åˆ°ç¬”è®°ä¸­ã€‚
  (setq org-todo-keywords
        '((sequence "TODO(t)" "NEXT(n!)"  "|" "DONEâœ”(d!)" "CANCELLEDâœ˜(c@/!)")
          (sequence "WAITâš‘(w@/!)" "HOLD(h@/!)" "|" "ABORT" "SOME" "PHONE" "MEETING")))
  (setq org-todo-keyword-faces
        '(("TODO" :foreground "red" :weight bold)
          ("NEXT" :foreground "blue" :weight bold)
          ("DONEâœ”" :foreground "forest green" :weight bold)
          ("WAITâš‘" :foreground "orange" :weight bold)
          ("HOLD" :foreground "magenta" :weight bold)
          ;;("CANCELLED" :foreground "forest grey" :weight bold)
          ("ABORT" :foreground "yellow" :weight bold)
          ("SOME" :foreground "lightgreen" :weight bold)
          ("MEETING" :foreground "lightblue" :weight bold)
          ("PHONE" :foreground "pink" :weight bold) ))


  (setq org-priority-faces
        '((?A . error)
          (?B . warning)
          (?C . success)))

  (setq org-tag-alist '((:startgroup . nil)
                      ("urgent-important" . ?u) ;; ç¬¬ä¸€è±¡é™ï¼šç´§æ€¥ä¸”é‡è¦
                      ("not-urgent-important" . ?n) ;; ç¬¬äºŒè±¡é™ï¼šä¸ç´§æ€¥ä½†é‡è¦
                      ("urgent-not-important" . ?i) ;; ç¬¬ä¸‰è±¡é™ï¼šç´§æ€¥ä½†ä¸é‡è¦
                      ("not-urgent-not-important" . ?t) ;; ç¬¬å››è±¡é™ï¼šä¸ç´§æ€¥ä¸”ä¸é‡è¦
                      (:endgroup . nil)))

  ;; å¯ä»¥ä½¿ç”¨ org-tags-view æ¥è¿‡æ»¤å’ŒæŸ¥çœ‹ä¸åŒè±¡é™çš„ä»»åŠ¡
  ;; ä¾‹å¦‚ï¼šM-x org-tags-view RET +urgent-important
  ;; The triggers break down to the following rules:
  ;;   Moving a task to CANCELLED adds a CANCELLED tag
  ;;   Moving a task to WAITTING adds a WAITTING tag
  ;;   Moving a task to HOLD adds WAITTING and HOLD tags
  ;;   Moving a task to a done state removes WAITTING and HOLD tags
  ;;   Moving a task to TODO removes WAITTING, CANCELLED, and HOLD tags
  ;;   Moving a task to NEXT removes WAITTING, CANCELLED, and HOLD tags
  ;;   Moving a task to DONE removes WAITTING, CANCELLED, and HOLD tags
  (setq org-todo-state-tags-triggers
        '(("CANCELLED" ("CANCELLED" . t))
          ("WAITâš‘" ("WAITTING" . t))
          ("HOLD" ("WAITTING") ("HOLD" . t))
          (done ("WAITING") ("HOLD"))
          ("DONE" ("WAITTING") ("CANCELLED") ("HOLD"))
          ("ABORT" ("WAITTING") ("CANCELLED") ("HOLD"))
          ("TODO" ("WAITTING") ("CANCELLED") ("HOLD"))
          ("NEXT" ("WAITTING") ("CANCELLED") ("HOLD"))
          ("SOME" ("WAITTING") ("CANCELLED") ("HOLD"))))
  (setq org-log-done 'time)

  ;; Start the weekly agenda on Monday
  (setq org-agenda-start-on-weekday 1)
  (setq org-agenda-diary-file (expand-file-name "diary.org" org-files-directory))
  (setq org-agenda-block-separator ?â”€)
  (setq org-agenda-time-grid
        '((daily today require-timed)
          (800 1000 1200 1400 1600 1800 2000)
          " â”„â”„â”„â”„â”„ " "â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„"))
  (setq org-agenda-current-time-string
        "â­  now â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
  (setq org-agenda-diary-file (expand-file-name "diary.org" org-files-directory))
  ;; setup agenda files
  ;; org-mode manages the org-agenda-files variable automatically
  ;; using C-c [ and C-c ] to add and remove files respectively.
  ;; They can be files or directories.
  (setq org-agenda-files
        `(,(expand-file-name "gtd.org" org-files-directory)
          ,(expand-file-name "work.org" org-files-directory)
          ,(expand-file-name "finished.org" org-files-directory)
          ,(expand-file-name "cancel.org" org-files-directory)
          ,(expand-file-name "journal.org" org-files-directory)
          ,(expand-file-name "trash.org" org-files-directory)
          ;;,(expand-file-name "folder" org-files-directory)
          ))

#+end_src

** Capture
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;; capture template
  (setq org-default-notes-file (expand-file-name "notes.org" org-files-directory))
  ;; Capture templates for: TODO tasks, Notes,
  ;; appointments, phone calls, meetings, and (setq
  ;; org-protocol)
  (setq org-capture-templates
        '(
          ("t" "Todo"
           entry (file+headline (expand-file-name "gtd.org" org-files-directory) "Tasks")
           "* TODO %?\n%U\n%a\n" :clock-in t :clock-resume t)
          ("n" "Note"
           entry (file (expand-file-name "notes.org" org-files-directory))
           "* %? :NOTE:\n%U\n%a\n" :clock-in t :clock-resume t)
          ("r" "Respond"
           entry (file (expand-file-name "gtd.org" org-files-directory))
           "* NEXT Respond to %:from on %:subject\nSCHEDULED: %t\n%U\n%a\n"
           :clock-in t :clock-resume t :immediate-finish t)
          ("j" "Journal"
           entry (file+datetree (expand-file-name "journal.org" org-files-directory))
           "* %?\nEntered on %U\n  %i\n  %a" :clock-in t :clock-resume t)
          ("w" "Review"
           entry (file (expand-file-name "gtd.org" org-files-directory))
           "* TODO Review %c\n%U\n"
           :immediate-finish t)
          ("m" "Meeting"
           entry (file (expand-file-name "gtd.org" org-files-directory))
           "* MEETING with %? :MEETING:\n%U"
           :clock-in t :clock-resume t)
          ("p" "Phone call"
           entry (file (expand-file-name "gtd.org" org-files-directory))
           "* PHONE %? :PHONE:\n%U"
           :clock-in t :clock-resume t)
          ("h" "Habit"
           entry (file (expand-file-name "gtd.org" org-files-directory))
           "* NEXT %?\n%U\n%a\nSCHEDULED: %(format-time-string \"%<<%Y-%m-%d %a .+1d/3d>>\")\n:PROPERTIES:\n:STYLE: habit\n:REPEAT_TO_STATE: NEXT\n:END:\n")
          ))
#+end_src
** Refile
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  ;; Refile settings
  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  ;; Exclude DONE state tasks from refile targets
      ;;;###autoload
  (defun suk/verify-refile-target ()
    "Exclude todo keywords with a done state from refile targets."
    (not (member (nth 2 (org-heading-components)) org-done-keywords)))

  ;; Targets include this file and any file contributing to the agenda - up to 9 levels deep
  (setq org-refile-targets (quote ((nil :maxlevel . 9) (org-agenda-files :maxlevel . 9))))
  ;; Use full outline paths for refile targets
  (setq org-refile-use-outline-path t)
  (setq org-refile-target-verify-function 'suk/verify-refile-target)
  ;; Allow refile to create parent tasks with confirmation
  (setq org-refile-allow-creating-parent-nodes 'confirm)

#+end_src

*** Quick asscess
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;; Registers allow you to jump to a file or other location quickly.
  ;; To jump to a register, use C-x r j followed by the letter of the register.
  ;; Using registers for all these file shortcuts is probably a bit of
  ;; a waste since I can easily define my own keymap, but since I rarely
  ;; go beyond register A anyway. Also, I might as well add shortcuts for refiling.
  (require 'bookmark)
  (defvar my-refile-map (make-sparse-keymap))
  (defmacro my-defshortcut (key file)
    `(progn
       (set-register ,key (cons 'file ,file))
       (bookmark-store ,file (list (cons 'filename ,file)
                                   (cons 'position 1)
                                   (cons 'front-context-string "")) nil)
       (define-key my-refile-map
                   (char-to-string ,key)
                   (lambda (prefix)
                     (interactive "p")
                     (let ((org-refile-targets '(((,file) :maxlevel . 6)))
                           (current-prefix-arg (or current-prefix-arg '(4))))
                       (call-interactively 'org-refile))))))

  (defvar my-org-last-refile-marker nil "Marker for last refile")
  (defun my-org-refile-in-file (&optional prefix)
    "Refile to a target within the current file."
    (interactive)
    (let ((org-refile-targets (list (cons (list (buffer-file-name)) '(:maxlevel . 5)))))
      (call-interactively 'org-refile)
      (setq my-org-last-refile-marker (plist-get org-bookmark-names-plist :last-refile))))

  (defun my-org-refile-to-previous ()
    "Refile subtree to last position from `my-org-refile-in-file'."
    (interactive)
    (save-selected-window
      (when (eq major-mode 'org-agenda-mode)
        (org-agenda-switch-to))
      (org-cut-subtree)
      (save-window-excursion
        (save-excursion
          (bookmark-jump (plist-get org-bookmark-names-plist :last-refile))
          (let ((level (org-current-level)))
            (org-end-of-subtree t t)
            (org-paste-subtree))))))


  (define-key my-refile-map "," 'my-org-refile-to-previous)
  (define-key my-refile-map "." 'my-org-refile-in-file)
  ;; (my-defshortcut ?i "~/cloud/orgzly/Inbox.org")
  (my-defshortcut ?e "~/.emacs.d/README.org")
  ;; (my-defshortcut ?s "~/personal/sewing.org")
  ;; (my-defshortcut ?b "~/personal/business.org")
  ;; (my-defshortcut ?p "~/personal/google-inbox.org")
  ;; (my-defshortcut ?P "~/personal/google-ideas.org")
  ;; (my-defshortcut ?B "~/Dropbox/books")
  ;; (my-defshortcut ?n "~/notes")
  ;; (my-defshortcut ?N "~/sync/notes/QuickNote.md")
  ;; (my-defshortcut ?w "~/Dropbox/public/sharing/index.org")
  ;; (my-defshortcut ?W "~/Dropbox/public/sharing/blog.org")
  ;; (my-defshortcut ?j "~/personal/journal.org")
  ;; (my-defshortcut ?J "~/cloud/a/Journal.csv")
  ;; (my-defshortcut ?I "~/Dropbox/Inbox")
  ;; (my-defshortcut ?g "~/sachac.github.io/evil-plans/index.org")
  ;; (my-defshortcut ?c "~/code/dev/elisp-course.org")
  ;; (my-defshortcut ?C "~/personal/calendar.org")
  ;; (my-defshortcut ?l "~/dropbox/public/sharing/learning.org")
  ;; (my-defshortcut ?q "~/sync/notes/QuickNote.md")
  ;; (my-defshortcut ?Q "~/personal/questions.org")
#+end_src
** Exporter
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  ;; EXPORTER
  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  (setq default-process-coding-system '(utf-8-unix . utf-8-unix))
  ;; Inline images in HTML instead of producting links to the image
  (setq org-html-inline-images t)
  ;; Use (setq org-manual.css from the norang website for export document stylesheets)
  ;; (setq org-html-head-extra "<link rel=\"stylesheet\" href=\"org-manual.css\" type=\"text/css\" />")
  (setq org-html-head-include-default-style nil)
  ;; Do not generate internal css formatting for HTML exports
  (setq org-export-htmlize-output-type (quote css))
  ;; Increase default number of headings to export
  (setq org-export-headline-levels 6)
  (setq org-export-coding-system 'utf-8)
  (setq org-table-export-default-format "orgtbl-to-csv")
  ;; Do not generate internal css formatting for HTML exports
  (setq org-export-htmlize-output-type 'css)
  (setq org-export-with-timestamps nil)
  ;; _ ä¸è½¬ä¹‰ï¼Œç›¸å½“äº#+OPTIONS: ^:{} ~:{}
  (setq org-export-with-sub-superscripts "{}") ; å¤„ç†
  (setq org-use-sub-superscripts '{}) ; æ˜¾ç¤º

  ;; Embed inline CSS read from a file.
  ;;;###autoload
  (defun null-or-unboundp (var)
    "Return t if VAR is either unbound or nil, otherwise return nil."
    (or (not (boundp var))
        (null (symbol-value var))))

  ;;;###autoload
  (defun my-org-inline-css-hook (exporter)
    "Insert custom inline css"
    (when (eq exporter 'html)
      (let* ((dir (ignore-errors (file-name-directory (buffer-file-name))))
             (path (concat dir "style.css"))
             ;;(path  org-css-file)
             (homestyle (and (or (null dir) (null (file-exists-p path)))
                             (not (null-or-unboundp 'my-org-inline-css-file))))
             (final (if homestyle my-org-inline-css-file path)))
        (if (file-exists-p final)
            (progn
              (setq-local org-html-head-include-default-style nil)
              (setq-local org-html-head
                          (concat
                           "<style type=\"text/css\">\n"
                           "<!--/*--><![CDATA[/*><!--*/\n"
                           (with-temp-buffer
                             (insert-file-contents final)
                             (buffer-string))
                           "/*]]>*/-->\n"
                           "</style>\n")))))))

  (add-hook 'org-export-before-processing-hook #'my-org-inline-css-hook)

  ;; https://github.com/marsmining/ox-twbs
  ;; M-x package-install [RET] ox-twbs [RET]
  ;; If the installation doesnâ€™t work try refreshing the package list:
  ;; M-x package-refresh-contents [RET]
  ;; usage: org-twbs-export-to-html

  (use-package ox-twbs)
  (add-hook 'org-mode-hook
            (lambda ()
              (local-set-key (kbd "s-\\") 'my-org-publish-buffer)))

  (defun my-org-publish-buffer ()
    (interactive)
    (save-buffer)
    (org-twbs-export-to-html))
  (add-hook 'org-mode-hook
            (lambda ()
              "Beautify org symbols."
              (when suk-prettify-org-symbols-alist
                (if prettify-symbols-alist
                    (push suk-prettify-org-symbols-alist prettify-symbols-alist)
                  (setq prettify-symbols-alist suk-prettify-org-symbols-alist)))
              (prettify-symbols-mode 1)
              (abbrev-mode 1)
              (setq truncate-lines nil)
              (set-fill-column 70)
              (turn-on-font-lock)
              (load-org-font)
              ))
  (defun my-execute-function-and-shell-command-async ()
    "æ‰§è¡Œè‡ªå®šä¹‰å‡½æ•°é€»è¾‘ï¼Œç„¶åå¼‚æ­¥è°ƒç”¨å¤–éƒ¨ shell å‘½ä»¤ï¼Œä¼ é€’å½“å‰æ–‡ä»¶åçš„æ‰©å±•åæ›¿æ¢ä¸º .html çš„è·¯å¾„ä½œä¸ºå‚æ•°ã€‚"
    (interactive)
    ;; æ£€æŸ¥å½“å‰ç¼“å†²åŒºæ˜¯å¦å…³è”æœ‰æ–‡ä»¶
    (if (buffer-file-name)
        (let* ((current-file (buffer-file-name))
               ;; ä½¿ç”¨ file-name-sans-extension è·å–ä¸å¸¦æ‰©å±•åçš„æ–‡ä»¶å
               (base-name (file-name-sans-extension current-file))
               ;; æ„å»ºæ–°çš„æ–‡ä»¶åï¼Œæ›¿æ¢æ‰©å±•åä¸º .html
               (html-file (concat base-name ".html"))
               ;; å®šä¹‰è¦æ‰§è¡Œçš„å¤–éƒ¨å‘½ä»¤ï¼Œè¿™é‡Œä»¥ ls -l ä¸ºä¾‹
               (command (format "htm-cleanup.sh %s" (shell-quote-argument html-file)))
               ;; å®šä¹‰è¾“å‡ºç¼“å†²åŒºåç§°
               (output-buffer "*Shell Command Output*"))
          (my-org-publish-buffer)
          ;; æ‰§è¡Œè‡ªå®šä¹‰å‡½æ•°é€»è¾‘
          (message "æ­£åœ¨å¤„ç†æ–‡ä»¶: %s" current-file)

          ;; å¼‚æ­¥è°ƒç”¨å¤–éƒ¨ shell å‘½ä»¤
          (async-shell-command command output-buffer)

          ;; æ˜¾ç¤ºæç¤ºä¿¡æ¯
          (message "å·²å¯åŠ¨å¼‚æ­¥å‘½ä»¤: %s" command))
      (message "å½“å‰ç¼“å†²åŒºæ²¡æœ‰å…³è”çš„æ–‡ä»¶ã€‚")))



  ;; ç»‘å®šå¿«æ·é”® C-c e åˆ°ä¸Šè¿°å‡½æ•°
  (global-set-key (kbd "C-S-e") #'my-execute-function-and-shell-command-async)

  ;;(global-set-key (kbd "C-S-e") #'my-org-publish-buffer)

  ;; covert to html
  (use-package htmlize :defer 2)
  ;;(require-package 'ob-sagemath)
#+end_src
** Attachments
#+begin_src emacs-lisp :tangle etc/init-org.el
   ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   ;;; Attachments
   ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  (setq org-id-method (quote uuidgen))
  ;; Say you want to attach a file x.sql to your current task. Create
  ;; the file data in /tmp/x.sql and save it.
  ;;
  ;; Attach the file with C-c C-a a and enter the filename: x.sql.
  ;; This generates a unique ID for the task and adds the file in the
  ;; attachment directory.
  ;;
  ;; * Attachments                                     :ATTACH:
  ;;   :PROPERTIES:
  ;;   :Attachments: x.sql
  ;;   :ID:       f1d38e9a-ff70-4cc4-ab50-e8b58b2aaa7b
  ;;   :END:
  ;;
  ;; The attached file is saved in
  ;; data/f1/d38e9a-ff70-4cc4-ab50-e8b58b2aaa7b/. Where it goes
  ;; exactly isn't important for me éˆ¥?as long as it is saved and
  ;; retrievable easily. Org-mode copies the original file /tmp/x.sql
  ;; into the appropriate attachment directory.
  ;;
  ;; Tasks with attachments automatically get an ATTACH tag so you can
  ;; easily find tasks with attachments with a tag search.
  ;;
  ;; To open the attachment for a task use C-c C-a o. This prompts for
  ;; the attachment to open and TAB completion works here.
  
#+end_src
** TODO Use plantuml  (setup path in OS )
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;(setq plantuml-default-exec-mode 'server) ;default
  ;; ;; Sample jar configuration
  ;; (setq plantuml-jar-path "/path/to/your/copy/of/plantuml.jar")
  ;; (setq plantuml-default-exec-mode 'jar)

  ;; ;; Sample executable configuration
  ;; (setq plantuml-executable-path "/path/to/your/copy/of/plantuml.bin")
  ;; (setq plantuml-default-exec-mode 'executable)
  (setq plantuml-default-exec-mode 'jar)
  (setq org-plantuml-jar-path
        (expand-file-name "C:/green/plantuml-1.2024.3.jar"))
  (setq org-plantuml-jar-args (list "-charset" "UTF-8"))
  ;; plantuml-java-args
  ;; plantuml-jar-args
  (defun my-org-plantuml-execute (orig-fun &rest args)
    (let (
          (plantuml-java-args (list
                               "-Djava.awt.headless=true"
                               "-Dfile.encoding=UTT-8"
                               "-jar"
                               "--illegal-access=deny"
                               ))
          (plantuml-jar-args (list  "-charset" "UTF-8")) ;default value
          )
      (apply orig-fun args)))

  (advice-add 'org-plantuml-execute :around #'my-org-plantuml-execute)
  (add-to-list 'org-src-lang-modes '("plantuml" . plantuml))
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((plantuml . t)
     (dot . t)
     ))
  ;;(setq process-environment (cons "PATH=D:/green/plantUML/bin;%PATH%" process-environment))

  ;; (defun my-org-export-before-processing-hook (backend)
  ;;   (let ((process-environment (cons "PATH=%PATH%" process-environment)))
  ;;     (org-babel-execute-src-block)
  ;;     (org-babel-execute-buffer)))

  ;; (add-hook 'org-export-before-processing-hook 'my-org-export-before-processing-hook)


  (defun my-org-mode-refresh-images ()
    (when (derived-mode-p 'org-mode) ; ç¡®ä¿å½“å‰æ¨¡å¼æ˜¯ Org-mode
      (org-redisplay-inline-images))) ; åˆ·æ–°å†…åµŒå›¾ç‰‡

  (add-hook 'org-babel-after-execute-hook 'my-org-mode-refresh-images)
#+end_src
** Use toc-org
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;; org-mode
  (use-package toc-org)
#+end_src
** Use Tmr
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;;; Run commands in a popup frame
  (defun prot-window-delete-popup-frame (&rest _)
    "Kill selected selected frame if it has parameter `prot-window-popup-frame'.
      Use this function via a hook."
    (when (frame-parameter nil 'prot-window-popup-frame)
      (delete-frame)))
  (defmacro prot-window-define-with-popup-frame (command)
    "Define interactive function which calls COMMAND in a new frame.
      Make the new frame have the `prot-window-popup-frame' parameter."
    `(defun ,(intern (format "prot-window-popup-%s" command)) ()
       ,(format "Run `%s' in a popup frame with `prot-window-popup-frame' parameter.
      Also see `prot-window-delete-popup-frame'." command)
       (interactive)
       (let ((frame (make-frame '((prot-window-popup-frame . t)))))
         (select-frame frame)
         (switch-to-buffer " prot-window-hidden-buffer-for-popup-frame")
         (condition-case nil
             (call-interactively ',command)
           ((quit error user-error)
            (delete-frame frame))))))
  (declare-function org-capture "org-capture" (&optional goto keys))
  (defvar org-capture-after-finalize-hook)
      ;;;###autoload (autoload 'prot-window-popup-org-capture "prot-window")
  (prot-window-define-with-popup-frame org-capture)
  (add-hook 'org-capture-after-finalize-hook #'prot-window-delete-popup-frame)
  (require-package 'tmr)
  (declare-function tmr "tmr" (time &optional description acknowledgep))
  (defvar tmr-timer-created-functions)
      ;;;###autoload (autoload 'prot-window-popup-tmr "prot-window")
  (prot-window-define-with-popup-frame tmr)
  (add-hook 'tmr-timer-created-functions #'prot-window-delete-popup-frame)

  ;;;; The emacsclient calls that need ot be bound to system-wide keys
  ;; emacsclient -e '(prot-window-popup-org-capture)'
  ;; emacsclient -e '(prot-window-popup-tmr)'

#+end_src
** Use hydra
#+begin_src emacs-lisp :tangle etc/init-org.el
 
  (with-eval-after-load 'hydra
    (defhydra hydra-global-org (:color blue)
        "Org"
        ("t" org-timer-start "Start Timer")
        ("s" org-timer-stop "Stop Timer")
        ("r" org-timer-set-timer "Set Timer") ; This one requires you be in an orgmode doc, as it sets the timer for the header
        ("p" org-timer "Print Timer") ; output timer value to buffer
        ("w" (org-clock-in '(4)) "Clock-In") ; used with (org-clock-persistence-insinuate) (setq org-clock-persist t)
        ("o" org-clock-out "Clock-Out") ; you might also want (setq org-log-note-clock-out t)
        ("j" org-clock-goto "Clock Goto") ; global visit the clocked task
        ("c" org-capture "Capture") ; Don't forget to define the captures you want http://orgmode.org/manual/Capture.html
          ("l" (or )rg-capture-goto-last-stored "Last Capture"))

     )


#+end_src
** Use org-modern
#+begin_src emacs-lisp :tangle etc/init-org.el
  ;;Prettify UI
  (use-package org-modern
    :custom
    ;;  (org-modern-table nil)
    (prettify-symbols-alist nil)
    :config
    ;; Disable Prettify Symbols mode globally or locally as needed
    ;;(global-prettify-symbols-mode -1)
    :hook ((org-mode . org-modern-mode)
           (org-agenda-finalize . org-modern-agenda)
           ))
  
#+end_src
** Use org-roam
#+begin_src emacs-lisp :tangle etc/init-org.el
  (use-package org-roam
    :ensure t
    :init
    (setq org-roam-v2-ack t)
    (setq org-roam-db-location "~/.emacs.d/var/org-roam.db")
    :custom
    ;; (org-roam-directory (file-truename "~/RoadNotes"))
    ;; The file-truename function is only necessary when you use
    ;; symbolic links inside org-roam-directory: Org-roam does not
    ;; resolve symbolic links.
    (make-directory (expand-file-name "daily" org-roam-directory) t)
    (org-roam-completion-everywhere t)
    (org-roam-dailies-capture-templates
     '(("d" "default" entry "* %<%I:%M %p>: %?"
        :if-new (file+head "%<%Y-%m-%d>.org" "#+title: %<%Y-%m-%d>\n"))))
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert)
           :map org-mode-map
           ("C-M-i" . completion-at-point)
           :map org-roam-dailies-map
           ("Y" . org-roam-dailies-capture-yesterday)
           ("n" . org-roam-dailies-capture-today)
           ("T" . org-roam-dailies-capture-tomorrow)
           ("v" . org-roam-dailies-capture-date)
           ("d" . org-roam-dailies-goto-today)
           ("t" . org-roam-dailies-goto-tomorrow)
           ("y" . org-roam-dailies-goto-yesterday)
           ("c" . org-roam-dailies-goto-date)
           ("b" . org-roam-dailies-goto-next-note)
           ("f" . org-roam-dailies-goto-previous-note)
           )
    :bind-keymap
    ("C-c n d" . org-roam-dailies-map)
    :config
    (require 'org-roam-dailies) ;; Ensure the keymap is available
    (org-roam-db-autosync-mode)

    )
#+end_src
** Add shortcuts
#+begin_src emacs-lisp :tangle etc/init-key.el
  ;;; --- ç¬”è®°ç®¡ç†å’Œç»„ç»‡
  (define-prefix-command 'F9-map)
  (global-set-key (kbd "<f9>") 'F9-map)
  (lazy-load-global-keys
   '(("a" . org-agenda)
     ("A" . org-attach)
     ("s" . show-org-agenda)
     ("c" . org-capture)
     ("i" . org-toggle-inline-images)
     ("l" . org-toggle-link-display)
     ("d" . calendar)
     ("f" . suk/file-shortcuts/body)

     )
   "init-org"
   "<f9>")

    ;; I use C-c c to start capture mode
    (global-set-key (kbd "C-c c") #'org-capture)
    ;; ;; (global-set-key (kbd "C-c C") 'org-capture)
    (global-set-key "\C-cl" #'org-store-link)
    (global-set-key "\C-ca" #'org-agenda)
    ;;(global-set-key "\C-cb" #'org-iswitchb)

    ;; C-',  C-, is org-cycle-agenda-files keys
    ;; æ–°ç‰ˆçš„org-modeä½¿ç”¨C-c C-, æ›¿æ¢äº† <sTAB æä¾›çš„æ¨¡æ¿åŠŸèƒ½ã€‚

#+end_src
* Recentf
#+begin_src emacs-lisp :tangle suk.el
  ;; Recentf
  (setq recentf-save-file (concat suk-emacs-var-dir "/recentf"))
  ;;(setq recentf-save-file "~/.emacs.d/var/recentf")
  (use-package recentf
    :ensure nil
    :defer 1
    :init
    (setq recentf-save-file (concat suk-emacs-var-dir "/recentf"))
    ;;(setq recentf-save-file "~/.emacs.d/var/recentf")
    ;;(add-hook 'after-init-hook #'recentf-mode)
    (setq recentf-max-saved-items 500)
    (setq recentf-max-saved-items 17)
    (recentf-mode)
    (recentf-track-opened-file)

    :config
    (add-to-list 'recentf-exclude (expand-file-name package-user-dir))
    (add-to-list 'recentf-exclude ".cache")
    (add-to-list 'recentf-exclude ".cask")
    (add-to-list 'recentf-exclude ".elfeed")
    (add-to-list 'recentf-exclude "bookmarks")
    (add-to-list 'recentf-exclude "cache")
    (add-to-list 'recentf-exclude "persp-confs")
    (add-to-list 'recentf-exclude "recentf")
    (add-to-list 'recentf-exclude "url")
    (add-to-list 'recentf-exclude "COMMIT_EDITMSG\\'")
    (defun suk/recentf-exclude-p (file)
      (let ((file-dir (file-truename (file-name-directory file))))
        (-any-p (lamdba (dir)
                        (string-prefix-p dir file-dir))
                (mapcar 'file-truename (list var package-user-dir)))))
    (add-to-list 'recentf-exclude #'suk/recentf-exclude-p)
    )

#+end_src
* Session
åŠ è½½ä¿å­˜çš„äº‹åŠ¡ã€‚
#+begin_src emacs-lisp :tangle suk.el
  (use-package session)
  (require 'auto-save)
  ;; todo dont load
  (require 'basic-toolkit)

  (setq desktop-load-locked-desktop t) ; don't popup dialog ask user, load anyway
  (setq desktop-restore-frames nil)    ; don't restore any frame

  (defun emacs-session-restore ()
    "Restore emacs session."
    (interactive)
    (ignore-errors
      ;; Kill other windows.
      (delete-other-windows)
      ;; Kill unused buffers.
      (kill-unused-buffers)
      ;; Restore session.
      (desktop-read "~/.emacs.d/var/")
      ))

  (defun emacs-session-save (&optional arg)
    "Save emacs session."
    (interactive "p")
    (ignore-errors
      (if (equal arg 4)
          ;; Kill all buffers if with prefix argument.
          (mapc 'kill-buffer (buffer-list))
        ;; Kill unused buffers.
        (kill-unused-buffers)
        ;; Save all buffers before exit.
        (auto-save-buffers))
      ;; Save session.
      (make-directory "~/.emacs.d/var/" t)
      (desktop-save "~/.emacs.d/var/")
      ;; Exit emacs.
      (kill-emacs)))

  (global-set-key (kbd "S-<f9>") 'emacs-session-save)
  (global-set-key (kbd "C-<f9>") 'emacs-session-save)

  (emacs-session-restore)
#+end_src
* ç”¨æˆ·ç•Œé¢
:PROPERTIES:
:CUSTOM_ID: setup-ui
:END:
<<setup-ui>>

Add to suk.el
  #+begin_src emacs-lisp :tangle suk.el
  (require 'init-ui)   
  #+end_src

Setup init-ui
#+begin_src emacs-lisp :tangle etc/init-ui.el
  (provide 'init-ui)
#+end_src
** ä¸»é¢˜
:PROPERTIES:
:CUSTOM_ID: setup-theme
:END:
<<setup-theme>>

#+begin_src emacs-lisp :tangle etc/init-ui.el
  ;;(require 'lazycat-theme)
  ;;(lazycat-theme-load-dark)
  (use-package doom-themes
    :ensure t
    :custom
    (doom-themes-enable-bold t)
    (doom-themes-enable-italic t)
    ;; åŠ è½½ä¸€ä¸ªä¸»é¢˜ï¼ŒDOOM One æ˜¯ DOOM Emacs çš„é»˜è®¤ä¸»é¢˜ï¼Œéå¸¸ç¾è§‚
    :init
    (load-theme 'doom-one t)
    )

 
  (use-package doom-modeline
    :hook (after-init . doom-modeline-mode)
    :init
    (setq doom-modeline-icon suk-icon
          doom-modeline-minor-modes t)
    :config
    (column-number-mode 1)
    :custom
    (doom-modeline-height 30)
    (doom-modeline-window-width-limit nil)
    (doom-modeline-buffer-file-name-style 'truncate-with-project)
    (doom-modeline-icon t)
    (doom-modeline-time t)
    (doom-modeline-vcs-max-leghth 50)
    ;; Windowsä¸‹è®°å¾—åŠ ä¸Š
    (if sys/win32p (setq inhibit-compacting-font-caches t))
    )

  (use-package hide-mode-line
    :hook (((treemacs-mode
             eshell-mode shell-mode
             term-mode vterm-mode
             embark-collect-mode
             lsp-ui-imenu-mode
             pdf-annot-list-mode) . turn-on-hide-mode-line-mode)
           (dired-mode . (lambda()
                           (and (bound-and-true-p hide-mode-line-mode)
                                (turn-off-hide-mode-line-mode))))))

  ;; A minor-mode menu for mode-line
  (use-package minions
    :hook (doom-modeline-mode . minions-mode))

#+end_src
** å­—ä½“
:PROPERTIES:
:CUSTOM_ID: setup-fonts
:END:
<<setup-fonts>>

#+begin_src emacs-lisp :tangle etc/init-ui.el
    ;; å­—ä½“
    (lazy-load-set-keys
     '(
       ("C--" . text-scale-decrease)        ;å‡å°å­—ä½“å¤§å°
       ("C-=" . text-scale-increase)        ;å¢åŠ å­—ä½“å¤§å°
       ("C-x C-0" . text-scale-adjust)
       ))


    (defun font-installed-p (font-name)
      "Check if font with FONT-NAME is available."
      (find-font (font-spec :name font-name)))


  ;; Use fixed pitch where it's sensible
  ;;  (use-package mixed-pitch :diminish)
  (require 'load-set-font)
#+end_src
** æ ‡ç­¾Tabs
:PROPERTIES:
:CUSTOM_ID: setup-tabs
:END:
<<setup-tabs>>

#+begin_src emacs-lisp :tangle etc/init-ui.el
  (when (display-graphic-p)
    (use-package centaur-tabs
      :demand
      :init
      ;; Set the style to rounded with icons
      (setq centaur-tabs-style "bar")
      (setq centaur-tabs-set-icons t)
      :config
      (centaur-tabs-mode t)
      :bind
      ("C-<prior>" . centaur-tabs-backward)  ;; Ctrl PgUp
      ("C-<next>"  . centaur-tabs-forward))  ;; Ctrl PgDn
  )
#+end_src
** å›¾æ ‡
:PROPERTIES:
:CUSTOM_ID: setup-icons
:END:
<<setup-icons>>

#+begin_src emacs-lisp :tangle etc/init-ui.el
  (when (display-graphic-p)
     ;; Icons
    (use-package nerd-icons
      :config
      (when (and (display-graphic-p)
                 (not (font-installed-p nerd-icons-font-family)))
        (nerd-icons-install-fonts t)))

    ;; å›¾æ ‡æ”¯æŒ
    (use-package all-the-icons
      ;; :ensure t
      :load-path "~/.emacs.d/extensions/all-the-icons"
      :if (display-graphic-p))
    )
#+end_src
** é«˜äº®
#+begin_src emacs-lisp :tangle etc/init-ui.el
  (run-with-idle-timer
   9
   nil
   #'(lambda()
       ;;(require-package 'highlight-symbol)
       ;; Highlight the current line
       (use-package hl-line
         :ensure nil
         :hook ((after-init . global-hl-line-mode)
                ((dashboard-mode eshell-mode shell-mode term-mode vterm-mode) .
                 (lambda () (setq-local global-hl-line-mode nil)))))
       ))
#+end_src
** è®¾å®š hydra
:PROPERTIES:
:CUSTOM_ID: setup-hydra
:END:
<<setup-hydra>>
*** Setup hydra
#+begin_src emacs-lisp :tangle etc/init-ui.el
  ;; setup hydra
  (use-package hydra
    :hook (emacs-lisp-mode . hydra-add-imenu)
    :config
    (with-eval-after-load 'posframe
      (setq hydra-hint-display-type 'posframe)
      (defun hydra-set-posframe-show-params ()
        "Set hydra-posframe style."
        (setq hydra-posframe-show-params
              `(
                :left-fringe 8
                :right-fringe 8
                :internal-border-width 2
                :internal-border-color ,(face-background 'posframe-border nil t)
                :background-color ,(face-background 'tooltip nil t)
                :foreground-color ,(face-foreground 'tooltip nil t)
                :lines-truncate t
                )))
      (hydra-set-posframe-show-params)
      (add-hook 'after-load-theme-hook #'hydra-set-posframe-show-params t))
    )

#+end_src
*** Setup pretty-hydra
#+begin_src emacs-lisp :tangle etc/init-ui.el
  (use-package pretty-hydra
    :requires hydra
    :custom (pretty-hydra-default-title-body-format-spec " %s%s")
    :hook (emacs-lisp-mode . (lambda ()
                               (add-to-list
                                'imenu-generic-expression
                                '("Hydras" "^.*(\\(pretty-hydra-define\\) \\([a-zA-Z-]+\\)" 2))))
    :init
    (cl-defun pretty-hydra-title (title &optional icon-type icon-name &key face height v-adjust)
      "Add an icon in the hydra title."
      (let ((face (or face `(:inherit highlight :reverse-video t)))
            (height (or height 1.2))
            (v-adjust (or v-adjust 0.0)))
        (concat
         (when (and (icons-displayable-p) icon-type icon-name)
           (let ((f (intern (format "nerd-icons-%s" icon-type))))
             (when (fboundp f)
               (concat (apply f (list icon-name :face face :height height :v-adjust v-adjust)) " "))))
         (propertize title 'face face)))))

#+end_src
** è®¾å®š posframe
#+begin_src emacs-lisp :tangle etc/init-ui.el
  (when (display-graphic-p)
    (use-package posframe
      :hook (after-load-theme . posframe-delete-all)
      :init
      (defface posframe-border `((t (:inherit region)))
        "Face used by the `posframe' border."
        :group 'posframe)
      (defvar posframe-border-width 2
        "Default posframe border width.")
      )

    :config
    (posframe-delete-all)
    )
#+end_src
** æ‚é¡¹
#+begin_src emacs-lisp :tangle etc/init-ui.el
  ;; Optimization
  (setq idle-update-delay 1.0)
  (when (fboundp 'tool-bar-mode) (tool-bar-mode -1))
  (when (fboundp 'menu-bar-mode) (menu-bar-mode -1))
  ;; (when (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))

  ;; GUI Environment
  (when (display-graphic-p)
    ;; Don't use GTK+ tooltip
    (when (boundp 'x-gtk-use-system-tooltips)
      (setq x-gtk-use-system-tooltips nil))
    ;; scroll-bar
    (set-scroll-bar-mode 'right)
    ;; éšè—å‚ç›´æ»šåŠ¨æ¡ã€‚
    ;;(modify-all-frames-parameters '((vertical-scroll-bars)))
    )
#+end_src
* Completion
** install
#+begin_src emacs-lisp :tangle install.el
  (require-package 'company)
  (require-package 'company-box)
#+end_src
** setup
#+begin_src emacs-lisp :tangle etc/init-completion.el
  (provide 'init-completion)
#+end_src
Add to suk.el
#+begin_src emacs-lisp :tangle suk.el
  (require 'init-completion)
#+end_src
** Vertico
:PROPERTIES:
:CUSTOM_ID: setup-vertico
:END:
<<setup-vertico>>

Vertico æ˜¯ Emacs ä¸­çš„ä¸€æ¬¾ç”¨äºå¢å¼º minibuffer è¾“å…¥ä½“éªŒçš„æ’ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨
é€æ­¥æ”¹è¿› completionï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰å’Œé€‰æ‹©å€™é€‰é¡¹æ—¶çš„ç•Œé¢è¡¨ç°ã€‚

ä¸»è¦ç‰¹ç‚¹

   + å‚ç›´é€‰æ‹©ç•Œé¢ï¼š

       Vertico æä¾›äº†ä¸€ç§å‚ç›´çš„å€™é€‰é¡¹æ˜¾ç¤ºæ–¹å¼ï¼Œä¸é»˜è®¤çš„ minibuffer ä¸
     åŒï¼Œå®ƒé€šè¿‡åœ¨å±å¹•ä¸Šå‚ç›´åˆ—å‡ºå€™é€‰é¡¹ï¼Œå¹¶å…è®¸ä½ å¿«é€Ÿæµè§ˆã€é€‰æ‹©å€™é€‰é¡¹ã€‚
     å®ƒä¸ä»…ä»…æ˜¯è¡¥å…¨ï¼Œè¿˜æ˜¯ä¸€ä¸ªç›´è§‚çš„é€‰æ‹©ç•Œé¢ã€‚

   * å¿«é€Ÿå’Œè½»é‡ï¼š

      å®ƒçš„è®¾è®¡ç†å¿µæ˜¯ç®€å•ã€è½»é‡å¹¶ä¸”å¿«é€Ÿã€‚å®ƒä¸ä¼šåƒå…¶ä»–ä¸€äº›è¡¥å…¨æ¡†æ¶é‚£æ ·å¸¦
     æœ‰è¿‡å¤šå¤æ‚çš„åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸“æ³¨äºæä¾›æµç•…çš„ã€å“åº”è¿…é€Ÿçš„å€™é€‰é¡¹æ˜¾ç¤ºã€‚

   * å…¼å®¹æ€§å¼ºï¼š

      Vertico æ˜¯ä¸ completion å’Œ minibuffer çš„é»˜è®¤ç³»ç»Ÿç´§å¯†é›†æˆçš„ï¼Œå¹¶ä¸”
     å®ƒæ”¯æŒä¸å…¶ä»–è¡¥å…¨æ¡†æ¶å¦‚ company-mode å’Œ corfu ä¸€èµ·ä½¿ç”¨ï¼Œå¸®åŠ©ä½ åœ¨é€‰
     æ‹©å€™é€‰é¡¹æ—¶æä¾›æ›´å¥½çš„ä½“éªŒã€‚

   * é€‚é…æ€§ï¼š

     å®ƒèƒ½å¤Ÿä¸å¾ˆå¤šæµè¡Œçš„æ’ä»¶ï¼ˆå¦‚ Consult, Orderless, Embarkï¼‰æ— ç¼é…åˆï¼Œ
     æ‰©å±•å€™é€‰é¡¹é€‰æ‹©çš„åŠŸèƒ½ã€‚
        
#+begin_src emacs-lisp :tangle etc/init-completion.el
  (when (display-graphic-p)
    (use-package vertico
      :bind (:map vertico-map
                  ("RET"   . vertico-directory-enter)
                  ("DEL"   . vertico-directory-delete-char)
                  ("M-DEL" . vertico-directory-delete-word))
      :hook ((after-init . vertico-mode)
             (rfn-eshadow-update-overlay . vertico-directory-tidy))
      )
     (use-package vertico-posframe
        :ensure t
        :after (posframe vertico)
        :hook (vertico-mode . vertico-posframe-mode)
        :init (setq vertico-posframe-parameters '((left-fringe  . 8) (right-fringe . 8)))
        )
    )
#+end_src
** corfu
#+begin_src emacs-lisp :tangle etc/init-completion.el
  (use-package corfu
    :custom
    (corfu-cycle t)
    (corfu-auto t)
    (corfu-auto-prefix 2)
    (corfu-auto-delay 1)
    (corfu-popupinfo-delay '(0.5 . 0.2))
    (corfu-preview-current 'insert)
    (corfu-preselect 'prompt)
    (corfu-on-exeact-match nil)
    :bind (:map corfu-map
                ("TAB" . corfu-next)
                ([tab] . corfu-next)
                ("C-n" . corfu-next)
                ("S-TAB" . corfu-previous)
                ([backtab] . corfu-previous)
                ("C-p" . corfu-previous)
                ("S-<return>" . corfu-insert)
                ("RET" . nil)
                ("<return>" . corfu-mode)
                ("C-y" . corfu-yank)
                ("C-g" . corfu-abort))
    :init
    (global-corfu-mode)
    (corfu-history-mode))

  (use-package nerd-icons-corfu
    :after corfu
    :init (add-to-list 'corfu-margin-formatters #'nerd-icons-corfu-formatter))

#+end_src
** Company
*** Setup
#+begin_src emacs-lisp :tangle etc/init-completion-company.el
  (use-package company
    :defer 2
    :init
    (setq company-idle-delay nil)  ;; ç¦ç”¨è‡ªåŠ¨å¼¹å‡ºè¡¥å…¨
    :defines (company-dabbrev-ignore-case company-dabbrev-downcase)
    :hook (after-init . global-company-mode)
    :init (setq company-tooltip-align-annotations t
                company-minimum-prefix-length 3
                company-require-match nil
                company-dabbrev-ignore-case nil
                company-dabbrev-downcase nil
                company-show-numbers t)
    :config
    ;;(setq switch-window-input-style 'minibuffer)
    (setq company-minimum-prefix-length 3)
    (setq company-show-quick-access t)
    :bind
    (:map company-active-map
          ("C-n" . #'company-select-next)
          ("C-p" . #'company-select-previous)
          ("TAB" . company-complete-selection)
          ("M-h" . company-complete-selection)
          ("M-H" . company-complete-common)
          ("M-s" . company-search-candidates)
          ("M-S" . company-filter-candidates)
          ("M-n" . company-select-next)
          ("M-p" . company-select-previous))
    (:map leader-key
          ("y" . #'company-yasnippet))
    )
  (use-package company-box
    :ensure nil)
  (provide 'init-completion-company)
#+end_src
*** æ‰‹åŠ¨è§¦å‘
#+begin_src emacs-lisp :tangle  etc/init-completion.el
  ;;æ®è¯´è·Ÿ lsp-bridge å†²çª
  (setq company-idle-delay nil) 
  ;; (global-set-key (kbd "M-/") 'company-complete)  ;; ç»‘å®š M-/ ä¸º company-complete
  ;; (global-set-key (kbd "M-?") 'dabbrev-expand)    ;; ç»‘å®š M-? ä¸º dabbrev-expand
  (lazy-load-global-keys
   '(
     ("M-/" . company-complete)
     ("M-?" . dabbrev-expand)

     )
   "init-completion-company"
   )
#+end_src
** Use orderless
#+begin_src emacs-lisp :tangle etc/init-completion.el
  ;; Optionally use the `orderless' completion style.
  (require-package 'orderless)
  (use-package orderless
    :custom
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles basic partial-completion))))
    (orderless-component-separator #'orderless-escapable-split-on-space))
  ;; Support Pinyin
  (use-package pinyinlib
    :after orderless
    :autoload pinyinlib-build-regexp-string
    :init
    (defun completion--regex-pinyin (str)
      (orderless-regexp (pinyinlib-build-regexp-string str)))
    (add-to-list 'orderless-matching-styles 'completion--regex-pinyin))
#+end_src
** Use consult
#+begin_src emacs-lisp :tangle etc/init-completion.el
  (use-package consult
    :bind (;; C-c bindings in `mode-specific-map'
           ("C-c M-x" . consult-mode-command)
           ([remap Info-search]        . consult-info)
           ([remap isearch-forward]    . consult-line)
           ([remap recentf-open-files] . consult-recent-file)

           ;; C-x bindings in `ctl-x-map'
           ("C-x M-:" . consult-complex-command)     ;; orig. repeat-complex-command
           ("C-x b"   . consult-buffer)              ;; orig. switch-to-buffer
           ("C-x 4 b" . consult-buffer-other-window) ;; orig. switch-to-buffer-other-window
           ("C-x 5 b" . consult-buffer-other-frame)  ;; orig. switch-to-buffer-other-frame
           ("C-x r b" . consult-bookmark)            ;; orig. bookmark-jump
           ("C-x p b" . consult-project-buffer)      ;; orig. project-switch-to-buffer
           ;; Custom M-# bindings for fast register access
           ("M-#"     . consult-register-load)
           ("M-'"     . consult-register-store)      ;; orig. abbrev-prefix-mark (unrelated)
           ("C-M-#"   . consult-register)
           ;; Other custom bindings
           ("M-y"     . consult-yank-pop)            ;; orig. yank-pop
           ;; M-g bindings in `goto-map'
           ("M-g e"   . consult-compile-error)
           ("M-g g"   . consult-goto-line)           ;; orig. goto-line
           ("M-g M-g" . consult-goto-line)           ;; orig. goto-line
           ("M-g o"   . consult-outline)             ;; Alternative: consult-org-heading
           ("M-g m"   . consult-mark)
           ("M-g k"   . consult-global-mark)
           ("M-g i"   . consult-imenu)
           ("M-g I"   . consult-imenu-multi)
           ;; ("M-g M"   . consult-man)
           ;; ("M-g I"   . consult-info)
           ("M-g t"   . consult-theme)
           ("M-g h"   . consult-history)
           ;; M-s bindings in `search-map'
           ("M-s d"   . consult-find)
           ("M-s D"   . consult-locate)
           ("M-s g"   . consult-grep)
           ("M-s G"   . consult-git-grep)
           ("M-s r"   . consult-ripgrep)
           ("M-s l"   . consult-line)
           ("M-s L"   . consult-line-multi)
           ("M-s k"   . consult-keep-lines)
           ("M-s u"   . consult-focus-lines)
           ;; Isearch integration
           ("M-s e"   . consult-isearch-history)
           ("C-r" .  consult-line)
           :map isearch-mode-map
           ("M-e"     . consult-isearch-history)
           ("M-s e"   . consult-isearch-history)
           ("M-s l"   . consult-line)
           ("M-s L"   . consult-line-multi)
           ) 

    ;; Enable automatic preview at point in the *Completions* buffer. This is
    ;; relevant when you use the default completion UI.
    :hook (completion-list-mode . consult-preview-at-point-mode)

    ;; The :init configuration is always executed (Not lazy)
    :init
    ;; Optionally configure the register formatting. This improves the register
    ;; preview for `consult-register', `consult-register-load',
    ;; `consult-register-store' and the Emacs built-ins.
    (setq register-preview-delay 0.5
          register-preview-function #'consult-register-format)

    ;; Optionally tweak the register preview window.
    ;; This adds thin lines, sorting and hides the mode line of the window.
    (advice-add #'register-preview :override #'consult-register-window)
    :config
    (use-package consult-flyspell
      :bind ("M-g s" . consult-flyspell))

    (use-package consult-yasnippet
      :bind ("M-g y" . consult-yasnippet))
    ;; Use Consult to select xref locations with preview
    (with-eval-after-load 'xref
      (setq xref-show-xrefs-function #'consult-xref
            xref-show-definitions-function #'consult-xref))
    )


#+end_src
** nerd-icons-completion
#+begin_src emacs-lisp :tangle etc/init-completion.el
  
  (use-package nerd-icons-completion
    :when (icons-displayable-p)
    :hook (vertico-mode . nerd-icons-completion-mode))
#+end_src
** Misc
#+begin_src emacs-lisp :tangle  etc/init-completion.el
  (use-package emacs
    :init
    ;; TAB cycle if there are only few candidates
    (setq completion-cycle-threshold 3)

    ;; Only list the commands of the current modes
    (when (boundp 'read-extended-command-predicate)
      (setq read-extended-command-predicate
            #'command-completion-default-include-p))

    ;; Enable indentation+completion using the TAB key.
    ;; `completion-at-point' is often bound to M-TAB.
    (setq tab-always-indent 'complete))

  ;; More utils
  (use-package shackle)

  (unless (display-graphic-p)
    ;; only conole packages
    )

#+end_src
* Tools
** setup
#+begin_src emacs-lisp :tangle etc/init-tools.el
  (provide 'init-tools)
#+end_src
Add to suk.el
#+begin_src emacs-lisp :tangle suk.el
  (require 'init-tools)
#+end_src
** Which Keys
:PROPERTIES:
:CUSTOM_ID: setup-which-keys
:END:
<<setup-which-keys>>
*** å®‰è£…
#+begin_src emacs-lisp :tangle install.el
    (require-package 'which-key)
#+end_src
*** è®¾ç½®
#+begin_src emacs-lisp :tangle etc/init-tools.el
  ;; Display available keybindings in popup

  (use-package which-key
    :diminish
    :bind (("C-h M-m" . which-key-show-major-mode)
           (:map help-map ("C-h" . which-key-C-h-dispatch)))

    :hook (after-init . which-key-mode)
    ;;:custom
    ;; å¼¹å‡ºæ–¹å¼ï¼Œåº•éƒ¨å¼¹å‡º
    ;;(which-key-popup-type 'side-window)
    :init (setq which-key-max-description-length 30
                which-key-lighter nil
                which-key-show-remaining-keys t)
    :config
    (which-key-mode))

  (use-package which-key-posframe
    :after (which-key posframe)
    :config
    (which-key-posframe-mode 1))

#+end_src

** è‹±æ–‡åŠ©æ‰‹
#+begin_src emacs-lisp :tangle etc/init-tools.el

  ;;; ### Company en words ###
  ;;; --- è‹±æ–‡åŠ©æ‰‹
  (lazy-load-global-keys
   '(
     ("M-r" . toggle-company-english-helper) ;è‹±æ–‡åŠ©æ‰‹
     )
   "company-english-helper")
#+end_src
** Treemacs
A tree view component
#+begin_src emacs-lisp :tangle etc/init-tools.el
  (lazy-load-global-keys
   '(
     ("<f8>" . treemacs)
    )
  "init-treemacs")
#+end_src
** NeoTree
Another tree view component
#+begin_src emacs-lisp :tangle etc/init-tools.el
  ;; è®¾ç½®æ‰“å¼€ NeoTree æ ‘å½¢åˆ—è¡¨å±•ç¤º
  ;;(require-package 'neotree)
  ;;(use-package neotree
  ;;  :commands (projectile-switch-project neotree-dir)
  ;;  :config
  ;;  (setq neo-theme 'ascii           ; NeoTree å›¾æ ‡çš„æ ·å¼
  ;;        neo-window-width 35
  ;;        neo-window-fixed-size nil) ; è®¾ç½® NeoTree çª—å£çš„å®½åº¦å¯ä»¥ä½¿ç”¨é¼ æ ‡è°ƒæ•´
  ;;  :bind ("C-c o" . projectile-switch-project))


#+end_src

** Markdown support
#+begin_src emacs-lisp :tangle etc/init-tools.el
  (use-package markdown-mode)
#+end_src
** Regex tool
#+begin_src emacs-lisp :tangle etc/init-tools.el
  (use-package regex-tool)
#+end_src
** command log mode
#+begin_src emacs-lisp :tangle etc/init-tools.el
  ;; (use-package 'command-log-mode) ;; show the command you press the shortcuts. M-x command-log-mode, M-x clm/open-command-log-buffer

#+end_src
** server
#+begin_src emacs-lisp :tangle etc/init-tools.el
  ;;;; The emacsclient call depends on the daemon or `server-mode' (I use the latter)
  (use-package server
    :ensure nil
    :defer 1
    :config
    (unless (server-running-p)
      (server-start)))
#+end_src
** Misc
*** install
#+begin_src emacs-lisp :tangle install.el
  ;; efficiency
  (require-package 'helpful)
  (require-package 'wc-mode)
  (require-package 'ws-butler)
  (require-package 'async)
  (require-package 'popup) ; some old package need it
  (require-package 'htmlize) ; prefer stable version
  (require-package 'diminish)
  (require-package 'unfill)
  (require-package 'rainbow-delimiters)
#+end_src

*** setup plugins
#+begin_src emacs-lisp :tangle etc/init-tools.el
  (use-package keyfreq
    :ensure t
    :config
    (keyfreq-mode 1)
    (keyfreq-autosave-mode 1))
  ;; M-x keyfreq-show
#+end_src
* Coding
å…¶å®ä½¿ç”¨emacsæ¥åšå·¥ç¨‹å¼€å‘æ˜¯ä¸å¤ªå¥½ï¼Œç”¨æ¥ç¼–å†™ä¸€å•²è„šæœ¬ç±»å˜…è¿˜å¥½ã€‚
** å®‰è£…è½¯ä»¶
#+begin_src emacs-lisp :tangle install.el
  ;; åœ¨WIndowsä¸‹æ•ˆç‡æä½ï¼Œé€Ÿåº¦å¥½æ…¢ï¼Œå†‡å¿…è¦ä½¿ç”¨ã€‚
  
  (require-package 'magit)
  (require-package 'fringe-helper)
  (require-package 'git-gutter) ; dependent to fringe-helper
  (require-package 'git-modes)
  (require-package 'web-mode)
  ;;(require-package 'lua-mode)
  (require-package 'yaml-mode)
  (require-package 'js2-mode)
  (require-package 'rjsx-mode) ; use my package in extensions
  (require-package 'csv-mode)
                                          ;(require-package 'emmet-mode)
  ;;(require-package 'groovy-mode)
  ;; magit sometime use packages which not released yet
  ;; so we place it at the end to make sure other packages are installed first
  (require-package 'graphql-mode)
  ;;(require-package 'auto-yasnippet)
  (require-package 'typescript-mode)
  (require-package 'nvm)

  ;;(require-package 'elpy) ;; python
  ;;(require-package 'request) ;; a http client
  ;;(require-package 'websocket) ; for debug debugging of browsers
  ;;(require-package 'simple-httpd)
  ;;(require-package 'highlight-symbol)
  ;;(require-package 'cpputils-cmake)
  ;;(require-package 'rust-mode)
  ;;(require-package 'cmake-mode)
  ;;(require-package 'sage-shell-mode)
#+end_src
** Setup
#+begin_src emacs-lisp :tangle etc/init-devtools.el
  (provide 'init-devtools)
  
#+end_src
** Modes
#+begin_src emacs-lisp :tangle etc/init-devtools.el

  ;; programming modes
  (use-package csv-mode)
  (use-package yaml-mode)
  (use-package web-mode)
  (use-package yaml-mode)
  (use-package js2-mode)
  (use-package rjsx-mode)
  (use-package csv-mode)
  (use-package typescript-mode)
  (use-package nvm)

#+end_src
** Formatter
#+begin_src emacs-lisp :tangle etc/init-devtools.el

  ;; format all, formatter for almost languages
  ;; great for programmers
  (require-package 'format-all)
  (use-package format-all
    :ensure t
    :hook (prog-mode . format-all-ensure-formatter)
    :bind ("C-c f" . #'format-all-buffer))

  ;; Format HTML, CSS and JavaScript/JSON
  ;; Install: npm -g install prettier
  (when (executable-find "prettier")
    (use-package prettier
      :diminish
      :hook ((js-mode js2-mode css-mode sgml-mode web-mode) . prettier-mode)
      :init (setq prettier-pre-warm 'none)))

  (use-package prettier-js
    :ensure t
    :defer 3
    :hook ((css-mode web-mode typescript-mode js-mode json-mode js2-mode) . prettier-js-mode))


  (use-package apheleia
    :hook (prog-mode . apheleia-mode)
    :config
    (setf (alist-get 'prettier apheleia-formatters)
          '("prettier" "--stdin-filepath" filepath)))
#+end_src
** Hideshow
#+begin_src emacs-lisp :tangle etc/init-devtools.el
  ;; æŠ˜å å’Œæ”¶ç¼©ä»£ç 
  ;; builtin
  (use-package hideshow
    :diminish hs-minor-mode
    :bind
    (:map hs-minor-mode-map
          ("C-c ." . hs-toggle-hiding)
          ("C-c ," . hs-show-all)
          )
    :hook (prog-mode . hs-minor-mode)
    :config
    (with-eval-after-load 'pretty-hydra
      (pretty-hydra-define+ hideshow-hydra
        (:title (pretty-hydra-title "HideShow" 'octicon "nf-oct-fold")
                :color amaranth :quit-key ("q" "C-g"))
        ("Fold"
         (("t" hs-toggle-all "toggle all")
          ("a" hs-show-all "show all")
          ("i" hs-hide-all "hide all")
          ("g" hs-toggle-hiding "toggle hiding")
          ("c" hs-cycle "cycle block")
          ("s" hs-show-block "show block")
          ("h" hs-hide-block "hide block")
          ("l" hs-hide-level "hide level"))
         "Move"
         (("C-a" mwim-beginning-of-code-or-line "â­°")
          ("C-e" mwim-end-of-code-or-line "â­²")
          ("C-b" backward-char "â†")
          ("C-n" next-line "â†“")
          ("C-p" previous-line "â†‘")
          ("C-f" forward-char "â†’")
          ("C-v" pager-page-down "â†˜")
          ("M-v" pager-page-up "â†–")
          ("M-<" beginning-of-buffer "â­¶")
          ("M->" end-of-buffer "â­¸"))
         )
        ))
    (keymap-global-set "S-<f6>" #'hideshow-hydra/body)
    ;; Display line counts
    (defun hs-display-code-line-counts (ov)
      "Display line counts when hiding codes."
      (when (eq 'code (overlay-get ov 'hs))
        (overlay-put ov 'display
                     (concat
                      " "
                      (propertize
                       (if (char-displayable-p ?â·) "â·" "...")
                       'face 'shadow)
                      (propertize
                       (format " (%d lines)"
                               (count-lines (overlay-start ov)
                                            (overlay-end ov)))
                       'face '(:inherit shadow :height 0.8))
                      " "))))
    (setq hs-set-up-overlay #'hs-display-code-line-counts)
    )

  ;; Jump to definition
  (use-package dumb-jump
    :config
    (with-eval-after-load 'pretty-hydra
      (pretty-hydra-define+ dumb-jump-hydra
        (:title (pretty-hydra-title "Dump Jump" 'faicon "nf-fa-anchor")
                :color blue :quit-key ("q" "C-g"))
        ("Jump"
         (("j" dumb-jump-go "Go")
          ("o" dumb-jump-go-other-window "Go other window")
          ("e" dumb-jump-go-prefer-external "Go external")
          ("x" dumb-jump-go-prefer-external-other-window "Go external other window"))
         "Other"
         (("i" dumb-jump-go-prompt "Prompt")
          ("l" dumb-jump-quick-look "Quick look")
          ("b" dumb-jump-back "Back")))
        )
      (keymap-global-set "C-M-j" #'dumb-jump-hydra/body)
      )
    :init
    (add-hook 'xref-backend-functions #'dumb-jump-xref-activate)
    (setq dumb-jump-selector 'completing-read))

#+end_src
** Treesit
#+begin_src emacs-lisp :tangle etc/init-devtools.el
  ;; Tree-sitter support
  (when sys/linuxp
    (require-package 'treesit-auto)
    (use-package treesit-auto
      :ensure t
      :hook (after-init . global-treesit-auto-mode)
      :init
      (setq treesit-auto-install 'prompt)
      (setq treesit-language-source-alist
            '((bash       . ("https://github.com/tree-sitter/tree-sitter-bash"))
              (c          . ("https://github.com/tree-sitter/tree-sitter-c"))
              (cpp        . ("https://github.com/tree-sitter/tree-sitter-cpp"))
              (css        . ("https://github.com/tree-sitter/tree-sitter-css"))
              (cmake      . ("https://github.com/uyha/tree-sitter-cmake"))
              (csharp     . ("https://github.com/tree-sitter/tree-sitter-c-sharp.git"))
              (dockerfile . ("https://github.com/camdencheek/tree-sitter-dockerfile"))
              (elisp      . ("https://github.com/Wilfred/tree-sitter-elisp"))
              (go         . ("https://github.com/tree-sitter/tree-sitter-go"))
              (gomod      . ("https://github.com/camdencheek/tree-sitter-go-mod.git"))
              (html       . ("https://github.com/tree-sitter/tree-sitter-html"))
              (java       . ("https://github.com/tree-sitter/tree-sitter-java.git"))
              (javascript . ("https://github.com/tree-sitter/tree-sitter-javascript"))
              (json       . ("https://github.com/tree-sitter/tree-sitter-json"))
              (lua        . ("https://github.com/Azganoth/tree-sitter-lua"))
              (make       . ("https://github.com/alemuller/tree-sitter-make"))
              (markdown   . ("https://github.com/MDeiml/tree-sitter-markdown" nil "tree-sitter-markdown/src"))
              (ocaml      . ("https://github.com/tree-sitter/tree-sitter-ocaml" nil "ocaml/src"))
              (org        . ("https://github.com/milisims/tree-sitter-org"))
              (python     . ("https://github.com/tree-sitter/tree-sitter-python"))
              (php        . ("https://github.com/tree-sitter/tree-sitter-php"))
              (typescript . ("https://github.com/tree-sitter/tree-sitter-typescript" nil "typescript/src"))
              (tsx        . ("https://github.com/tree-sitter/tree-sitter-typescript" nil "tsx/src"))
              (ruby       . ("https://github.com/tree-sitter/tree-sitter-ruby"))
              (rust       . ("https://github.com/tree-sitter/tree-sitter-rust"))
              (sql        . ("https://github.com/m-novikov/tree-sitter-sql"))
              (vue        . ("https://github.com/merico-dev/tree-sitter-vue"))
              (yaml       . ("https://github.com/ikatyang/tree-sitter-yaml"))
              (toml       . ("https://github.com/tree-sitter/tree-sitter-toml"))
              (zig        . ("https://github.com/GrayJack/tree-sitter-zig"))))
      (add-to-list 'major-mode-remap-alist '(sh-mode         . bash-ts-mode))
      (add-to-list 'major-mode-remap-alist '(c-mode          . c-ts-mode))
      (add-to-list 'major-mode-remap-alist '(c++-mode        . c++-ts-mode))
      (add-to-list 'major-mode-remap-alist '(c-or-c++-mode   . c-or-c++-ts-mode))
      (add-to-list 'major-mode-remap-alist '(css-mode        . css-ts-mode))
      (add-to-list 'major-mode-remap-alist '(js-mode         . js-ts-mode))
      (add-to-list 'major-mode-remap-alist '(java-mode       . java-ts-mode))
      (add-to-list 'major-mode-remap-alist '(js-json-mode    . json-ts-mode))
      (add-to-list 'major-mode-remap-alist '(makefile-mode   . cmake-ts-mode))
      (add-to-list 'major-mode-remap-alist '(python-mode     . python-ts-mode))
      (add-to-list 'major-mode-remap-alist '(ruby-mode       . ruby-ts-mode))
      (add-to-list 'major-mode-remap-alist '(conf-toml-mode  . toml-ts-mode))
      (add-to-list 'auto-mode-alist '("\\(?:Dockerfile\\(?:\\..*\\)?\\|\\.[Dd]ockerfile\\)\\'" . dockerfile-ts-mode))
      (add-to-list 'auto-mode-alist '("\\.go\\'" . go-ts-mode))
      (add-to-list 'auto-mode-alist '("/go\\.mod\\'" . go-mod-ts-mode))
      (add-to-list 'auto-mode-alist '("\\.rs\\'" . rust-ts-mode))
      (add-to-list 'auto-mode-alist '("\\.ts\\'" . typescript-ts-mode))
      (add-to-list 'auto-mode-alist '("\\.y[a]?ml\\'" . yaml-ts-mode))
      )
    (global-treesit-auto-mode))
#+end_src
** copilot
#+begin_src emacs-lisp :tangle etc/init-devtools.el

  (when suk-copilot-enable

    (when sys/win32p 
      (setq copilot-node-executable "C:\\green\\node-v20.10.0-win-x64\\node.exe")
      (add-to-list 'load-path "C:\\green\\emacs-suk\\.emacs.d\\extensions\\copilot\\copilot.el")

      )
    (unless sys/win32p
      (setq copilot-node-executable "~/.nvm/versions/node/v22.13.0/bin/node")
      (add-to-list 'load-path "~/.emacs.d/extensions/copilot/copilot.el")
      )


    (use-package copilot)
    (with-eval-after-load 'copilot

      ;; å…¨å±€è®¾ç½® Copilot çš„ç¼©è¿›åç§»é‡ä¸º 4
      (setq copilot-indent-offset 4)
      ;; è®¾ç½® Copilot ç¼©è¿›åç§»é‡
      (let ((copilot-offsets
             '((python-mode . 4)
               (c-mode . 2)
               (js-mode . 2)
               (bat-mode . 2))))
        (dolist (pair copilot-offsets)
          (let ((mode (car pair))
                (offset (cdr pair)))
            (add-hook mode (lambda () (setq copilot-indent-offset offset))))))
      (add-hook 'prog-mode-hook 'copilot-mode)

      ;; To customize the behavior of copilot-mode, please check copilot-enable-predicates and copilot-disable-predicates.
      ;; You need to bind copilot-complete to some key and call copilot-clear-overlay inside post-command-hook.
      (define-key copilot-completion-map (kbd "<tab>") 'copilot-accept-completion)
      (define-key copilot-completion-map (kbd "TAB") 'copilot-accept-completion)
      (add-to-list 'copilot-major-mode-alist '("jsonl" . "json"))
      ;; Increase the maximum character limit for Copilot
      (setq copilot-max-char 200000) ;; Adjust the value as needed
      ;; Disable Copilot file size warnings
      (setq copilot-disable-size-check t) ;; Hypothetical variable
      ;;;; å¿½ç•¥ Copilot çš„ç‰¹å®šè­¦å‘Š
      ;;(add-to-list 'warning-suppress-types '(copilot quail--infer-indentation-offset found no mode-specific indentation offset))
      ;;;; è®¾ç½® Emacs çš„æœ€ä½è­¦å‘Šçº§åˆ«ä¸º warning`ï¼Œå¿½ç•¥ `emergency çº§åˆ«ä»¥ä¸‹çš„è­¦å‘Š
      ;; (setq warning-minimum-level :warning)
      ;; é—­å˜´
      (setq copilot-indent-offset-warning-disable t)
      )

    ;; Login to Copilot by M-x copilot-login. You can also check the
    ;; status by M-x copilot-diagnose (NotAuthorized means you don't have
    ;; a valid subscription).
    )
#+end_src
** Web
*** Typescript
#+begin_src emacs-lisp :tangle etc/init-devtools.el


  ;; {{ typescript
  (use-package typescript-mode
    :load-path "~/.emacs.d/extensions/typescript"
    :hook ((typescript-mode . (typescript-mode-hook-setup)))
    :config
    (defun typescript-mode-hook-setup ()
      "Set up `typescript-mode'."
      (when (my-use-tags-as-imenu-function-p)
        ;; use ctags to calculate imenu items
        (setq imenu-create-index-function
              'counsel-etags-imenu-default-create-index-function)))

    (defun my-typescript-beginning-of-defun-hack (orig-func &rest args)
      "Overwrite typescript beginning detection."
      (ignore orig-func)
      (ignore args)
      (when (my-use-tags-as-imenu-function-p)
        (let* ((closest (my-closest-imenu-item)))
          (when closest
            (imenu closest)))))
    (advice-add 'typescript-beginning-of-defun
                :around #'my-typescript-beginning-of-defun-hack)
    )



#+end_src
*** CSS
#+begin_src emacs-lisp :tangle etc/init-devtools.el

  ;; CSS
  (use-package css-mode
    :init (setq css-indent-offset 2))

  ;; SCSS
  (use-package scss-mode
    :init (setq scss-compile-at-save nil))

  ;; LESS
  (unless (fboundp 'less-css-mode)
    (use-package less-css-mode))

#+end_src
*** Javascript
#+begin_src emacs-lisp :tangle etc/init-devtools.el
  ;; JSON
  (unless (fboundp 'js-json-mode)
    (use-package json-mode
      :load-path "~/.emacs.d/extensions/json-mode"))

  ;; JavaScript
  (use-package js
    :init (setq js-indent-level 2))

  (with-eval-after-load 'js-mode
    ;; '$' is part of variable name like '$item'
    (modify-syntax-entry ?$ "w" js-mode-syntax-table))

  (use-package js2-mode
    :mode (("\\.js\\'" . js2-minor-mode)
           ("\\.jsx\\'" . js2-minor-jsx-mode))
    :interpreter (("node" . js2-minor-mode)
                  ("node" . js2-minor-jsx-mode))
    :hook ((js2-minor-mode . (lambda()  (js2-imenu-extras-mode)
                               (js2-highlight-unused-variables-mode)

                               )))
    :config
    (defun my-validate-json-or-js-expression (&optional not-json-p)
      "Validate buffer or select region as JSON.
  If NOT-JSON-P is not nil, validate as Javascript expression instead of JSON."
      (interactive "P")
      (let* ((json-exp (if (region-active-p) (my-selected-str)
                         (my-buffer-str)))
             (jsbuf-offet (if not-json-p 0 (length "var a=")))
             errs
             first-err
             (first-err-pos (if (region-active-p) (region-beginning) 0)))
        (unless not-json-p
          (setq json-exp (format "var a=%s;"  json-exp)))
        (with-temp-buffer
          (insert json-exp)
          (my-ensure 'js2-mode)
          (js2-parse)
          (setq errs (js2-errors))
          (cond
           ((not errs)
            (message "NO error found. Good job!"))
           (t
            ;; yes, first error in buffer is the last element in errs
            (setq first-err (car (last errs)))
            (setq first-err-pos (+ first-err-pos (- (cadr first-err) jsbuf-offet)))
            (message "%d error(s), first at buffer position %d: %s"
                     (length errs)
                     first-err-pos
                     (js2-get-msg (caar first-err))))))
        (if first-err (goto-char first-err-pos))))

    (defun my-print-json-path (&optional hardcoded-array-index)
      "Print the path to the JSON value under point, and save it in the kill ring.
  If HARDCODED-ARRAY-INDEX provided, array index in JSON path is replaced with it."
      (interactive "P")
      (cond
       ((memq major-mode '(js2-mode))
        (js2-print-json-path hardcoded-array-index))
       (t
        (let* ((cur-pos (point))
               (str (my-buffer-str)))
          (when (string= "json" (file-name-extension buffer-file-name))
            (setq str (format "var a=%s;" str))
            (setq cur-pos (+ cur-pos (length "var a="))))
          (my-ensure 'js2-mode)
          (with-temp-buffer
            (insert str)
            (js2-init-scanner)
            (js2-do-parse)
            (goto-char cur-pos)
            (js2-print-json-path))))))
    (defun my-print-json-path (&optional hardcoded-array-index)
      "Print the path to the JSON value under point, and save it in the kill ring.
  If HARDCODED-ARRAY-INDEX provided, array index in JSON path is replaced with it."
      (interactive "P")
      (cond
       ((memq major-mode '(js2-mode))
        (js2-print-json-path hardcoded-array-index))
       (t
        (let* ((cur-pos (point))
               (str (my-buffer-str)))
          (when (string= "json" (file-name-extension buffer-file-name))
            (setq str (format "var a=%s;" str))
            (setq cur-pos (+ cur-pos (length "var a="))))
          (my-ensure 'js2-mode)
          (with-temp-buffer
            (insert str)
            (js2-init-scanner)
            (js2-do-parse)
            (goto-char cur-pos)
            (js2-print-json-path))))))


    ;;Latest rjsx-mode does not have indentation issue
    ;;@see https://emacs.stackexchange.com/questions/33536/how-to-edit-jsx-react-files-in-emacs
    (setq-default js2-additional-externs
                  '("$"
                    "$A" ; salesforce lightning component
                    "$LightningApp" ; salesforce
                    "AccessifyHTML5"
                    "Blob"
                    "FormData"
                    "KeyEvent"
                    "Raphael"
                    "React"
                    "URLSearchParams"
                    "__dirname" ; Node
                    "_content" ; Keysnail
                    "after"
                    "afterEach"
                    "angular"
                    "app"
                    "assert"
                    "assign"
                    "before"
                    "beforeEach"
                    "browser"
                    "by"
                    "clearInterval"
                    "clearTimeout"
                    "command" ; Keysnail
                    "content" ; Keysnail
                    "decodeURI"
                    "define"
                    "describe"
                    "display" ; Keysnail
                    "documentRef"
                    "element"
                    "encodeURI"
                    "expect"
                    "ext" ; Keysnail
                    "fetch"
                    "gBrowser" ; Keysnail
                    "global"
                    "goDoCommand" ; Keysnail
                    "hook" ; Keysnail
                    "inject"
                    "isDev"
                    "it"
                    "jest"
                    "jQuery"
                    "jasmine"
                    "key" ; Keysnail
                    "ko"
                    "log"
                    "mockStore"
                    "module"
                    "mountWithTheme"
                    "plugins" ; Keysnail
                    "process"
                    "require"
                    "setInterval"
                    "setTimeout"
                    "shell" ; Keysnail
                    "tileTabs" ; Firefox addon
                    "util" ; Keysnail
                    "utag") )
    )

  (use-package rjsx-mode
    :load-path "~/.emacs.d/extensions/rjsx-mode"
    :mode ("\\.js\\'")
    :hook ((rjsx-mode .  (lambda()
                           (flycheck-add-mode 'javascript-eslint 'rjsx-mode)
                           (flycheck-select-checker 'javascript-eslint))))
    ;;:config
    ;;(add-hook 'rjsx-mode-hook 'setup)

    )

  ;; @see https://github.com/felipeochoa/rjsx-mode/issues/33
  (with-eval-after-load 'rjsx-mode
    (define-key rjsx-mode-map "<" nil))


  (require-package 'emmet-mode)
  (use-package emmet-mode
    :defer 3
    :init (setq emmet-expand-jsx-className? t)
    :hook (web-mode typescript-mode js-mode js2-mode rjsx-mode css-mode scss-mode sgml-mode))


  ;; Major mode for editing web templates
  (use-package web-mode
    :mode "\\.\\(phtml\\|php\\|[gj]sp\\|as[cp]x\\|erb\\|djhtml\\|html?\\|hbs\\|ejs\\|jade\\|swig\\|tm?pl\\|vue\\)$"
    :config
    (setq web-mode-markup-indent-offset 2)
    (setq web-mode-css-indent-offset 2)
    (setq web-mode-code-indent-offset 2)
    (setq web-mode-enable-auto-closing t) ; enable auto close tag in text-mode
    (setq web-mode-enable-auto-pairing t)
    (setq web-mode-auto-close-style 2)
    (setq web-mode-enable-css-colorization t)
    (setq web-mode-imenu-regexp-list
          '(("<\\(h[1-9]\\)\\([^>]*\\)>\\([^<]*\\)" 1 3 ">" nil)
            ("^[ \t]*<\\([@a-z]+\\)[^>]*>? *$" 1 " id=\"\\([a-zA-Z0-9_]+\\)\"" "#" ">")
            ("^[ \t]*<\\(@[a-z.]+\\)[^>]*>? *$" 1 " contentId=\"\\([a-zA-Z0-9_]+\\)\"" "=" ">")
            ;; angular imenu
            (" \\(ng-[a-z]*\\)=\"\\([^\"]+\\)" 1 2 "="))))


  ;; Adds node_modules/.bin directory to `exec_path'
  (use-package add-node-modules-path
     :hook ((web-mode js-mode js2-mode) . add-node-modules-path))

  (setq-default js2-use-font-lock-faces t
                js2-mode-must-byte-compile nil
                ;; {{ comment indention in modern frontend development
                javascript-indent-level 2
                js-indent-level 2
                css-indent-offset 2
                typescript-indent-level 2
                ;; }}
                js2-strict-trailing-comma-warning nil ; it's encouraged to use trailing comma in ES6
                js2-idle-timer-delay 0.5 ; NOT too big for real time syntax check
                js2-auto-indent-p nil
                js2-indent-on-enter-key nil ; annoying instead useful
                js2-skip-preprocessor-directives t
                js2-strict-inconsistent-return-warning nil ; return <=> return null
                js2-enter-indents-newline nil
                js2-bounce-indent-p t)

  (with-eval-after-load 'js-mode
    ;; '$' is part of variable name like '$item'
    (modify-syntax-entry ?$ "w" js-mode-syntax-table))

  (defun my-validate-json-or-js-expression (&optional not-json-p)
    "Validate buffer or select region as JSON.
  If NOT-JSON-P is not nil, validate as Javascript expression instead of JSON."
    (interactive "P")
    (let* ((json-exp (if (region-active-p) (my-selected-str)
                       (my-buffer-str)))
           (jsbuf-offet (if not-json-p 0 (length "var a=")))
           errs
           first-err
           (first-err-pos (if (region-active-p) (region-beginning) 0)))
      (unless not-json-p
        (setq json-exp (format "var a=%s;"  json-exp)))
      (with-temp-buffer
        (insert json-exp)
        (my-ensure 'js2-mode)
        (js2-parse)
        (setq errs (js2-errors))
        (cond
         ((not errs)
          (message "NO error found. Good job!"))
         (t
          ;; yes, first error in buffer is the last element in errs
          (setq first-err (car (last errs)))
          (setq first-err-pos (+ first-err-pos (- (cadr first-err) jsbuf-offet)))
          (message "%d error(s), first at buffer position %d: %s"
                   (length errs)
                   first-err-pos
                   (js2-get-msg (caar first-err))))))
      (if first-err (goto-char first-err-pos))))

  (defun my-print-json-path (&optional hardcoded-array-index)
    "Print the path to the JSON value under point, and save it in the kill ring.
  If HARDCODED-ARRAY-INDEX provided, array index in JSON path is replaced with it."
    (interactive "P")
    (cond
     ((memq major-mode '(js2-mode))
      (js2-print-json-path hardcoded-array-index))
     (t
      (let* ((cur-pos (point))
             (str (my-buffer-str)))
        (when (string= "json" (file-name-extension buffer-file-name))
          (setq str (format "var a=%s;" str))
          (setq cur-pos (+ cur-pos (length "var a="))))
        (my-ensure 'js2-mode)
        (with-temp-buffer
          (insert str)
          (js2-init-scanner)
          (js2-do-parse)
          (goto-char cur-pos)
          (js2-print-json-path))))))

  (with-eval-after-load 'js2-mode
    ;; I hate the hotkeys to hide things
    (define-key js2-mode-map (kbd "C-c C-e") nil)
    (define-key js2-mode-map (kbd "C-c C-s") nil)
    (define-key js2-mode-map (kbd "C-c C-f") nil)
    (define-key js2-mode-map (kbd "C-c C-t") nil)
    (define-key js2-mode-map (kbd "C-c C-o") nil)
    (define-key js2-mode-map (kbd "C-c C-w") nil))
  ;; }}

  (defun my-js2-mode-setup()
    "Set up javascript."
    ;; if use node.js we need nice output
    (js2-imenu-extras-mode)
    (setq mode-name "JS2")
    ;; counsel/ivy is more generic and powerful for refactoring
    ;; js2-mode has its own syntax linter

    ;; call js-doc commands through `counsel-M-x'!

    ;; @see https://github.com/mooz/js2-mode/issues/350
    (setq forward-sexp-function nil))

  (add-hook 'js2-mode-hook 'my-js2-mode-setup)

  ;; @see https://github.com/felipeochoa/rjsx-mode/issues/33
  (with-eval-after-load 'rjsx-mode
    (define-key rjsx-mode-map "<" nil))


  ;; Latest rjsx-mode does not have indentation issue
  ;; @see https://emacs.stackexchange.com/questions/33536/how-to-edit-jsx-react-files-in-emacs
  (setq-default js2-additional-externs
                '("$"
                  "$A" ; salesforce lightning component
                  "$LightningApp" ; salesforce
                  "AccessifyHTML5"
                  "Blob"
                  "FormData"
                  "KeyEvent"
                  "Raphael"
                  "React"
                  "URLSearchParams"
                  "__dirname" ; Node
                  "_content" ; Keysnail
                  "after"
                  "afterEach"
                  "angular"
                  "app"
                  "assert"
                  "assign"
                  "before"
                  "beforeEach"
                  "browser"
                  "by"
                  "clearInterval"
                  "clearTimeout"
                  "command" ; Keysnail
                  "content" ; Keysnail
                  "decodeURI"
                  "define"
                  "describe"
                  "display" ; Keysnail
                  "documentRef"
                  "element"
                  "encodeURI"
                  "expect"
                  "ext" ; Keysnail
                  "fetch"
                  "gBrowser" ; Keysnail
                  "global"
                  "goDoCommand" ; Keysnail
                  "hook" ; Keysnail
                  "inject"
                  "isDev"
                  "it"
                  "jest"
                  "jQuery"
                  "jasmine"
                  "key" ; Keysnail
                  "ko"
                  "log"
                  "mockStore"
                  "module"
                  "mountWithTheme"
                  "plugins" ; Keysnail
                  "process"
                  "require"
                  "setInterval"
                  "setTimeout"
                  "shell" ; Keysnail
                  "tileTabs" ; Firefox addon
                  "util" ; Keysnail
                  "utag"))

#+end_src
** Minor mode to aggressively keep your code always indented
#+begin_src emacs-lisp :tangle etc/init-devtools.el

  ;; Minor mode to aggressively keep your code always indented
  (use-package aggressive-indent
    :diminish
    :defer 2
    :hook ((after-init . global-aggressive-indent-mode)
           ;; NOTE: Disable in large files due to the performance issues
           ;; https://github.com/Malabarba/aggressive-indent-mode/issues/73
           (find-file . (lambda ()
                          (when (too-long-file-p)
                            (aggressive-indent-mode -1)))))
    :config
    ;; Disable in some modes
    (dolist (mode '(gitconfig-mode
                    asm-mode web-mode html-mode css-mode go-mode
                    scala-mode shell-mode term-mode vterm-mode
                    prolog-inferior-mode))
      (add-to-list 'aggressive-indent-excluded-modes mode))

    ;; Disable in some commands
    (add-to-list 'aggressive-indent-protected-commands
                 #'delete-trailing-whitespace t)

    ;; Be slightly less aggressive in C/C++/C#/Java/Go/Swift
    (add-to-list 'aggressive-indent-dont-indent-if
                 '(and (derived-mode-p
                        'c-mode 'c++-mode 'csharp-mode
                        'java-mode 'go-mode 'swift-mode)
                       (null (string-match "\\([;{}]\\|\\b\\(if\\|for\\|while\\)\\b\\)"
                                           )))))


#+end_src
** Project
#+begin_src emacs-lisp :tangle etc/init-devtools.el
    ;; ä½¿ç”¨ built-in project library
    (require 'project)

    ;; è®¾ç½®é¡¹ç›®æ ¹ç›®å½•è¯†åˆ«æ–¹å¼ï¼ˆé»˜è®¤æ˜¯ Gitã€Mercurialã€Bazaarã€Subversionã€Dockerfile ç­‰ï¼‰
    (setq project-find-functions '(project-try-vc))

    ;; å¯é€‰ï¼šè‡ªå®šä¹‰é¡¹ç›®æ ¹ç›®å½•è¯†åˆ«
    (defun my/project-root (args)
      "Define additional ways to recognize project root."
      (or (locate-dominating-file default-directory "package.json")
          (locate-dominating-file default-directory "pom.xml")
          (locate-dominating-file default-directory "setup.py"))
      )

    (add-to-list 'project-find-functions #'my/project-root)
  #+end_src
* æ‚é¡¹
#+begin_src emacs-lisp :tangle suk.el
  ;; ç©ºé—²æ—¶åŠ è½½
  (run-with-idle-timer
   1
   nil
   #'(lambda()
       (require 'load-abbrev)
       ;; chmod +x
       ;; ref. http://th.nao.ac.jp/MEMBER/zenitani/elisp-j.html#chmod
       (add-hook 'after-save-hook'executable-make-buffer-file-executable-if-script-p)
       (autoload 'calendar "init-calendar" "Config Chinese calendar " t)
       ))


#+end_src
* æ“ä½œç³»ç»Ÿç›¸å…³
#+begin_src emacs-lisp :tangle suk.el
  
  ;; Hanlde minified code
  (if emacs/>=27p (add-hook 'after-init-hook #'global-so-long-mode))
  (when sys/linuxp
    (load-if-exists (expand-file-name "linux.el" suk-emacs-root-dir)))
  (when sys/win32p
    (load-if-exists (expand-file-name "windows.el" suk-emacs-root-dir)))
  (when sys/macp
    (load-if-exists (expand-file-name "mac.el" suk-emacs-root-dir)))
#+end_src
** Linux
*** install
#+begin_src emacs-lisp :tangle install.el
  (require-package 'sudo-edit)
  (require-package 'pdf-tools) ;; use the package in extension
   
#+end_src
*** è®¾å®š
#+begin_src emacs-lisp :tangle linux.el
  ;; Your Linux specific settings

  ;; (setenv "JAVA_HOME" "/usr/lib/jvm/java-14-openjdk-amd64")

  ;; å¼€å‘å·¥å…·
  (run-with-idle-timer
   1 nil
   #'(lambda()
       (require 'init-devtools)
       ))

  ;; Open files as another user
  (run-with-idle-timer
   2
   nil
   #'(lambda()
       (require 'my-sudo)
       ;; (use-package sudo-edit)
       (lazy-load-global-keys
        '(("C-z C-s" . suk/sudo/body))
        "my-sudo"
        )
       ))

  ;; On-the-fly spell checker
  (run-with-idle-timer
   2
   nil
   #'(lambda()
       (use-package flyspell
         :ensure t
         :defer 2
         :diminish flyspell-mode
         :if (executable-find "aspell")
         :hook (((text-mode outline-mode) . flyspell-mode)
                (prog-mode . flyspell-prog-mode)
                (flyspell-mode . (lambda ()
                                   (unbind-key "C-;" flyspell-mode-map)
                                   (unbind-key "C-," flyspell-mode-map)
                                   (unbind-key "C-." flyspell-mode-map))))
         :init
         (setq flyspell-issue-message-flag nil)
         (setq ispell-program-name "aspell")
         (setq ispell-extra-args '("--sug-mode=ultra" "--lang=en_US" "--run-together")))))

  ;; ç‰¹æœ‰å·¥å…·
  (run-with-idle-timer
   2
   nil
   #'(lambda()
       ;; run "M-x pdf-tools-install" at debian and open pdf in GUI Emacs
       (use-package pdf-tools
         :ensure t
         :config (pdf-tools-install))
       ))

  ;; åŠ è½½è¾“å…¥æ³•
  (run-with-idle-timer
   1
   nil
   #'(lambda()
       (if suk-rime
           (require 'init-rime)
         (require 'rain))
       ))

  ;; å…¶ä»–
  (run-with-idle-timer
   1
   nil
   #'(lambda()
       (when (display-graphic-p)
         ;; only graphic packages
         )
       (unless (display-graphic-p)
         ;; only conole packages
         )
       ))
#+end_src

*** ç»ˆç«¯
vtermæ˜¯ä¸€ä¸ªç°ä»£åŒ–ã€é«˜æ€§èƒ½ä¸”åŠŸèƒ½ä¸°å¯Œçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ã€‚å®ƒç»“åˆäº†é«˜æ€§èƒ½çš„
libvterm åç«¯å’Œ Emacs çš„å¼ºå¤§åŠŸèƒ½ï¼Œæä¾›äº†æ¥è¿‘åŸç”Ÿç»ˆç«¯çš„ä½“éªŒã€‚

å¯¹äºéœ€è¦ç®¡ç†å¤šä¸ªç»ˆç«¯å®ä¾‹çš„ç”¨æˆ·ï¼Œmulti-vterm æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ‰©å±•ï¼Œèƒ½å¤Ÿæ–¹ä¾¿
åœ°åœ¨å¤šä¸ª vterm å®ä¾‹ä¹‹é—´åˆ‡æ¢ï¼Œç±»ä¼¼äº Terminator çš„åˆ†å±å’Œå¤šæ ‡ç­¾åŠŸèƒ½ã€‚
#+begin_src emacs-lisp :tangle etc/init-vterm.el
  (provide 'init-vterm)
  ;; é…ç½® vterm
  (use-package vterm
    :ensure t
    :commands vterm
    :config
    (setq vterm-shell "/bin/bash"))  ;; æ ¹æ®éœ€è¦è®¾ç½®é»˜è®¤ shell


  ;; å®šä¹‰ toggle-vterm å‡½æ•°
  (defun toggle-vterm ()
    "Toggle a vterm window at the bottom of the current window.
  If the vterm window is already open, it will be hidden.
  Otherwise, a new vterm will be opened in a split below, with the current directory set to the buffer's directory."
    (interactive)
    (let* ((vterm-buffer-name "*vterm*")
           (existing-window (get-buffer-window vterm-buffer-name))
           (target-dir (if (and (buffer-file-name)
                                (file-directory-p (file-name-directory (buffer-file-name))))
                           (file-name-directory (buffer-file-name))
                         default-directory)))
      (if existing-window
          ;; å¦‚æœ vterm çª—å£å·²ç»å­˜åœ¨ï¼Œåˆ™å…³é—­å®ƒ
          (delete-window existing-window)
        ;; å¦åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ vterm çª—å£
        (let ((default-directory target-dir))
          ;;(split-window-below)
          ;;(other-window 1)
          (vterm)
          ;;(vterm-other-window)
          ;; åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•
          (vterm-send-string (concat "cd " (shell-quote-argument target-dir)))
          (vterm-send-return)
          ))
      ;; ä¿æŒåŸçª—å£ç„¦ç‚¹
      ;;(other-window 1)
      ))

  ;; ç»‘å®šå¿«æ·é”®
  (global-set-key (kbd "C-x C-t") 'toggle-vterm)
#+end_src
#+begin_src emacs-lisp :tangle linux.el
  (when (display-graphic-p)
    ;; only graphic packages
    (lazy-load-global-keys
     '(
       ("C-x C-t" . toggle-vterm))
     "init-vterm"
     )

    )
#+end_src
** Windows
#+begin_src emacs-lisp :tangle windows.el
  ;; Your windows specific settings

  ;; For example, (w32-register-hot-key [M-tab]) lets you use M-TAB normally in Emacs;
  
  ;; make PC keyboard's Win key or other to type Super or Hyper, for emacs running on Windows.
  (setq w32-pass-lwindow-to-system nil)
  (setq w32-lwindow-modifier 'super) ; Left Windows key

  (setq w32-pass-rwindow-to-system nil)
  (setq w32-rwindow-modifier 'super) ; Right Windows key

  (setq w32-pass-apps-to-system nil)
  (setq w32-apps-modifier 'hyper) ; Menu key


  ;; on windows, make pwsh the default shell
  ;; 2023-09-09
  (setq
   explicit-shell-file-name
   (cond
    ((eq system-type 'windows-nt)
     (let ((xlist
            (list
             "~/AppData/Local/Microsoft/WindowsApps/pwsh.exe"
             "C:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe"
             )))
       (seq-some (lambda (x) (if (file-exists-p x) x nil)) xlist)))
    (t nil)))

  (run-with-idle-timer
   2
   nil
   #'(lambda()
       ;; Optimization
       (setq w32-get-true-file-attributes nil   ; decrease file IO workload
             w32-use-native-image-API t         ; use native w32 API
             w32-pipe-read-delay 0              ; faster IPC
             w32-pipe-buffer-size 65536)        ; read more at a time (64K, was 4K)
      ;;; Windows
       ;; spcial coding settings for Windows
       (unless (memq system-type '(cygwin windows-nt ms-dos))
         (setq selection-coding-system 'utf-8))
       )


   )


#+end_src
** MacOs
#+begin_src emacs-lisp :tangle mac.el
  ;; Your mac specific setting

  ;; set keys for Apple keyboard, for emacs in OS X
  (setq mac-command-modifier 'meta) ; make cmd key do Meta
  (setq mac-option-modifier 'super) ; make opt key do Super
  (setq mac-control-modifier 'control) ; make Control key do Control
  (setq ns-function-modifier 'hyper)  ; make Fn key do Hyper

  ;;(setenv "JAVA_HOME"  "path_to_java_folder/Contents/Home/")
  ;;(setq lsp-java-java-path "path_to_java_folder/Contents/Home/bin/java")

#+end_src
* å½’æ¡£å’Œä¾‹å­
:PROPERTIES:
:CUSTOM_ID: achrives-and-examples
:END:
#+begin_src emacs-lisp :tangle achrives-and-examples.el
  ;; =========================================================
  ;; é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶ä½¿å…¶å¯ä»¥è°ƒç”¨å¤–éƒ¨ç¨‹åºï¼Œæ¥ä¸ºå…¶æ·»åŠ åŠŸèƒ½ã€‚
  ;; å¢åŠ å‘½ä»¤
  ;;(defun lxr (names)
  ;;  (interactive "sæŸ¥æ‰¾è”ç³»äººï¼Œè¯·è¾“å…¥æ¡ä»¶ï¼š")
  ;;  (call-process-shell-command "lxr" nil t t "-s" names))
  ;;æ‰§è¡Œå‘½ä»¤
  ;;é¦–å…ˆæŒ‰åŠŸèƒ½é”®ï¼ŒAlt+xï¼Œç„¶åè¾“å…¥å‘½ä»¤ lxr ã€‚
  ;;ç³»ç»Ÿæç¤ºï¼šâ€œæŸ¥æ‰¾è”ç³»äººï¼Œè¯·è¾“å…¥æ¡ä»¶ï¼š"ã€‚
  ;;è¾“å…¥å®Œæˆåï¼Œemacs ä¼šæ‰§è¡Œå‘½ä»¤lxr -s namesï¼Œå¹¶è¾“å‡ºæ‰§è¡Œçš„ç»“æœã€‚
  ;; =========================================================
  ;; async-shell-command
#+end_src


